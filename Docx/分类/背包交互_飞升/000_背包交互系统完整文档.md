# èƒŒåŒ…äº¤äº’ç³»ç»Ÿ V4 - å®Œæ•´äº¤æ¥æ–‡æ¡£

**ç‰ˆæœ¬**: v4.1 (æ–¹æ¡ˆ D - é£å‡ç‰ˆ + ä¿®å¤)
**æ—¥æœŸ**: 2026-01-07
**çŠ¶æ€**: æ ¸å¿ƒåŠŸèƒ½å®Œæˆï¼Œå·²ä¿®å¤ä¸¢å¼ƒé€»è¾‘

---

## ç›®å½•

1. [ç³»ç»Ÿæ¦‚è¿°](#ç³»ç»Ÿæ¦‚è¿°)
2. [åœºæ™¯å±‚çº§ç»“æ„](#åœºæ™¯å±‚çº§ç»“æ„)
3. [æ ¸å¿ƒç»„ä»¶æ¶æ„](#æ ¸å¿ƒç»„ä»¶æ¶æ„)
4. [äº¤äº’çŠ¶æ€æœº](#äº¤äº’çŠ¶æ€æœº)
5. [è¯¦ç»†äº¤äº’çŸ©é˜µ](#è¯¦ç»†äº¤äº’çŸ©é˜µ)
6. [å¼€å‘å†ç¨‹ä¸é”™è¯¯è®°å½•](#å¼€å‘å†ç¨‹ä¸é”™è¯¯è®°å½•)
7. [ä»£ç æ–‡ä»¶æ¸…å•](#ä»£ç æ–‡ä»¶æ¸…å•)
8. [åœºæ™¯é…ç½®æŒ‡å—](#åœºæ™¯é…ç½®æŒ‡å—)
9. [å·²çŸ¥é—®é¢˜ä¸å¾…ä¼˜åŒ–](#å·²çŸ¥é—®é¢˜ä¸å¾…ä¼˜åŒ–)
10. [å…³é”®æ•™è®­æ€»ç»“](#å…³é”®æ•™è®­æ€»ç»“)
11. [2026-01-07 ä¿®å¤è®°å½•](#2026-01-07-ä¿®å¤è®°å½•)

---

## ç³»ç»Ÿæ¦‚è¿°

### åŠŸèƒ½åˆ—è¡¨

èƒŒåŒ…äº¤äº’ç³»ç»Ÿ V4 å®ç°äº†ä»¥ä¸‹æ ¸å¿ƒåŠŸèƒ½ï¼š

| åŠŸèƒ½ | è§¦å‘æ–¹å¼ | çŠ¶æ€ |
|------|----------|------|
| æ‹–æ‹½äº¤æ¢ | æ— ä¿®é¥°é”®é•¿æŒ‰ 0.15 ç§’ + ç§»åŠ¨ | âœ… å®Œæˆ |
| äºŒåˆ†æ‹¿å– | Shift + å·¦é”®å•å‡» | âœ… å®Œæˆ |
| è¿ç»­äºŒåˆ† | Shift + å·¦é”®å•å‡»æºæ§½ä½ | âœ… å®Œæˆ |
| å•ä¸ªæ‹¿å– | Ctrl + å·¦é”®å•å‡» | âœ… å®Œæˆ |
| æŒç»­æ‹¿å– | Ctrl + é•¿æŒ‰å·¦é”® | âœ… å®Œæˆ |
| å¿«é€Ÿè£…å¤‡ | Ctrl + å·¦é”®ï¼ˆè£…å¤‡ç±»ç‰©å“ï¼‰ | âœ… å®Œæˆ |
| ä¸¢å¼ƒç‰©å“ | é¢æ¿å¤–æ¾å¼€/åƒåœ¾æ¡¶ | âœ… å·²ä¿®å¤ |
| èƒŒåŒ…æ•´ç† | Sort æŒ‰é’® | âœ… å·²å®ç° |
| ESC å–æ¶ˆ | ESC é”® | âœ… å®Œæˆ |

### æ ¸å¿ƒè®¾è®¡åŸåˆ™

1. **ä¿æŒåŸæœ‰æ˜¾ç¤ºé€»è¾‘ä¸å˜** - `InventorySlotUI` çš„ Icon/Amount åˆ›å»ºå’Œåˆ·æ–°é€»è¾‘å®Œå…¨ä¸åŠ¨
2. **ä½¿ç”¨ç»„åˆè€Œéç»§æ‰¿** - äº¤äº’åŠŸèƒ½ä½œä¸ºç‹¬ç«‹ç»„ä»¶æ·»åŠ 
3. **ä½¿ç”¨ Unity åŸç”Ÿäº‹ä»¶æ¥å£** - ä¸ä½¿ç”¨ Update + Raycast
4. **çŠ¶æ€é©±åŠ¨çš„æ¥å£ç®¡ç†** - é€šè¿‡ `isDragEnabled` æ ‡å¿—æ§åˆ¶æ‹–æ‹½è¡Œä¸º
5. **èŒè´£åˆ†ç¦»** - æ˜¾ç¤º/äº¤äº’/é€»è¾‘å®Œå…¨åˆ†ç¦»

### ğŸ”´ ä¸¢å¼ƒåŒºåŸŸå®šä¹‰ï¼ˆé‡è¦ï¼ï¼‰

**èƒŒåŒ…åŒºåŸŸ = Main + Topï¼ˆä¸åŒ…æ‹¬ Backgroundï¼‰**

```
PackagePanel
â”œâ”€â”€ Background â† åªæ˜¯èƒŒæ™¯è£…é¥°ï¼Œä¸æ˜¯èƒŒåŒ…åŒºåŸŸï¼
â”œâ”€â”€ Main â† èƒŒåŒ…ä¸»åŒºåŸŸï¼ˆæ§½ä½æ‰€åœ¨ï¼‰
â””â”€â”€ Top â† Tab æ åŒºåŸŸ
```

**ä¸¢å¼ƒåˆ¤å®šé€»è¾‘**ï¼š
- é¼ æ ‡åœ¨ Main æˆ– Top å†… â†’ ä¸ä¸¢å¼ƒï¼ˆæ”¾ç½®æˆ–è¿”å›åŸä½ï¼‰
- é¼ æ ‡åœ¨ Main å’Œ Top å¤– â†’ ä¸¢å¼ƒ
- é¼ æ ‡åœ¨åƒåœ¾æ¡¶åŒºåŸŸ â†’ ä¸¢å¼ƒ

---

## åœºæ™¯å±‚çº§ç»“æ„

### PackagePanel å®Œæ•´å±‚çº§

```
UI (Canvas)
â”œâ”€â”€ Canvas
â”œâ”€â”€ CanvasScaler
â”œâ”€â”€ GraphicRaycaster â† å¿…é¡»å­˜åœ¨ï¼
â”‚
â”œâ”€â”€ State
â”œâ”€â”€ ToolBar
â”‚
â””â”€â”€ PackagePanel â† InventoryInteractionManager æŒ‚è½½åœ¨è¿™é‡Œ
    â”œâ”€â”€ Background â† åªæ˜¯èƒŒæ™¯ï¼Œä¸æ˜¯èƒŒåŒ…åŒºåŸŸ
    â”‚
    â”œâ”€â”€ Main â† èƒŒåŒ…ä¸»åŒºåŸŸï¼ˆä¸¢å¼ƒåˆ¤å®šåŒºåŸŸä¹‹ä¸€ï¼‰
    â”‚   â”œâ”€â”€ Background
    â”‚   â”œâ”€â”€ 0_Props
    â”‚   â”‚   â”œâ”€â”€ Up (èƒŒåŒ…ç‰©å“æ  - 36 æ ¼)
    â”‚   â”‚   â”‚   â”œâ”€â”€ Up_00 (Toggle + InventorySlotUI + InventorySlotInteraction)
    â”‚   â”‚   â”‚   â”œâ”€â”€ Up_01
    â”‚   â”‚   â”‚   â””â”€â”€ ... Up_35
    â”‚   â”‚   â”‚
    â”‚   â”‚   â””â”€â”€ Down (è£…å¤‡æ  - 6 æ ¼)
    â”‚   â”‚       â”œâ”€â”€ Down_00 (å¤´ç›”)
    â”‚   â”‚       â”œâ”€â”€ Down_01 (è£¤å­)
    â”‚   â”‚       â”œâ”€â”€ Down_02 (ç›”ç”²)
    â”‚   â”‚       â”œâ”€â”€ Down_03 (é‹å­)
    â”‚   â”‚       â”œâ”€â”€ Down_04 (æˆ’æŒ‡1)
    â”‚   â”‚       â””â”€â”€ Down_05 (æˆ’æŒ‡2)
    â”‚   â”‚
    â”‚   â”œâ”€â”€ 1_Recipes
    â”‚   â”œâ”€â”€ 2_Ex
    â”‚   â”œâ”€â”€ 3_Map
    â”‚   â”œâ”€â”€ 4_Relationship_NPC
    â”‚   â””â”€â”€ 5_Settings
    â”‚
    â”œâ”€â”€ Top â† Tab æ ï¼ˆä¸¢å¼ƒåˆ¤å®šåŒºåŸŸä¹‹ä¸€ï¼‰
    â”‚   â”œâ”€â”€ Top_0 (Props Tab)
    â”‚   â”œâ”€â”€ Top_1 (Recipes Tab)
    â”‚   â”œâ”€â”€ Top_2 (Ex Tab)
    â”‚   â”œâ”€â”€ Top_3 (Map Tab)
    â”‚   â”œâ”€â”€ Top_4 (Relationship Tab)
    â”‚   â””â”€â”€ Top_5 (Settings Tab)
    â”‚
    â””â”€â”€ HeldItemDisplay â† è·Ÿéšé¼ æ ‡æ˜¾ç¤ºæ‹¿èµ·çš„ç‰©å“
        â”œâ”€â”€ Icon (Image, Raycast Target = false)
        â””â”€â”€ Amount (Text, Raycast Target = false)
```

### æ§½ä½ç»„ä»¶ç»“æ„

æ¯ä¸ªèƒŒåŒ…æ§½ä½ï¼ˆUp_00 ~ Up_35ï¼‰çš„ç»„ä»¶ï¼š

```
Up_00 (GameObject)
â”œâ”€â”€ Image (èƒŒæ™¯å›¾ï¼ŒRaycast Target = true)
â”œâ”€â”€ Toggle (é€‰ä¸­çŠ¶æ€ç®¡ç†)
â”‚   â”œâ”€â”€ Target Graphic = Up_00 (Image)
â”‚   â”œâ”€â”€ Graphic = Selected (Image)
â”‚   â””â”€â”€ Group = Up (Toggle Group)
â”œâ”€â”€ InventorySlotUI (æ˜¾ç¤ºç»„ä»¶)
â”‚   â”œâ”€â”€ Toggle å¼•ç”¨
â”‚   â”œâ”€â”€ Icon Image å¼•ç”¨
â”‚   â”œâ”€â”€ Amount Text å¼•ç”¨
â”‚   â””â”€â”€ Selected Overlay å¼•ç”¨
â””â”€â”€ InventorySlotInteraction (äº¤äº’ç»„ä»¶ - è‡ªåŠ¨æ·»åŠ )
    â””â”€â”€ ç»‘å®šåˆ° InventorySlotUI
```

### è£…å¤‡æ§½ä½ç»„ä»¶ç»“æ„

æ¯ä¸ªè£…å¤‡æ§½ä½ï¼ˆDown_00 ~ Down_05ï¼‰çš„ç»„ä»¶ï¼š

```
Down_00 (GameObject)
â”œâ”€â”€ Image (èƒŒæ™¯å›¾ï¼ŒRaycast Target = true)
â”œâ”€â”€ EquipmentSlotUI (æ˜¾ç¤ºç»„ä»¶)
â”‚   â”œâ”€â”€ Icon Image å¼•ç”¨
â”‚   â””â”€â”€ Amount Text å¼•ç”¨
â””â”€â”€ InventorySlotInteraction (äº¤äº’ç»„ä»¶ - è‡ªåŠ¨æ·»åŠ )
    â””â”€â”€ ç»‘å®šåˆ° EquipmentSlotUI
```

---

## æ ¸å¿ƒç»„ä»¶æ¶æ„

### æ¶æ„å›¾

```
Unity EventSystem
    â†“
InventorySlotInteraction (ä¼ æ„Ÿå™¨ + çŠ¶æ€æ§åˆ¶)
    â†“
InventoryInteractionManager (å¤§è„‘ - å•ä¾‹)
    â†“
æ•°æ®å±‚ (InventoryService / EquipmentService)
    â†“
InventorySlotUI / EquipmentSlotUI (æ˜¾ç¤º) â† ç›‘å¬æ•°æ®å˜åŒ–è‡ªåŠ¨åˆ·æ–°
```

### ç»„ä»¶èŒè´£

| ç»„ä»¶ | èŒè´£ | æ–‡ä»¶è·¯å¾„ |
|------|------|----------|
| **InventorySlotUI** | æ˜¾ç¤ºç‰©å“å›¾æ ‡å’Œæ•°é‡ï¼Œç›‘å¬æ•°æ®å˜åŒ– | `Assets/YYY_Scripts/UI/Inventory/InventorySlotUI.cs` |
| **EquipmentSlotUI** | æ˜¾ç¤ºè£…å¤‡å›¾æ ‡å’Œæ•°é‡ï¼Œç›‘å¬æ•°æ®å˜åŒ– | `Assets/YYY_Scripts/UI/Inventory/EquipmentSlotUI.cs` |
| **InventorySlotInteraction** | å®ç° Unity äº‹ä»¶æ¥å£ï¼Œè½¬å‘äº‹ä»¶ç»™ Manager | `Assets/YYY_Scripts/UI/Inventory/InventorySlotInteraction.cs` |
| **InventoryInteractionManager** | å¤„ç†æ‰€æœ‰äº¤äº’é€»è¾‘ï¼ŒçŠ¶æ€æœºç®¡ç† | `Assets/YYY_Scripts/UI/Inventory/InventoryInteractionManager.cs` |
| **HeldItemDisplay** | è·Ÿéšé¼ æ ‡æ˜¾ç¤ºæ‹¿èµ·çš„ç‰©å“ | `Assets/YYY_Scripts/UI/Inventory/HeldItemDisplay.cs` |

### InventorySlotInteraction å®ç°çš„æ¥å£

```csharp
public class InventorySlotInteraction : MonoBehaviour,
    IPointerDownHandler,   // æŒ‰ä¸‹ï¼šè½¬å‘ç»™ Manager
    IPointerUpHandler,     // æŠ¬èµ·ï¼šä¸åšä»»ä½•äº‹ï¼ˆå…³é”®ï¼ï¼‰
    IBeginDragHandler,     // å¼€å§‹æ‹–æ‹½ï¼šæ£€æŸ¥æ¡ä»¶åè½¬å‘
    IDragHandler,          // æ‹–æ‹½ä¸­ï¼šHeldItemDisplay è‡ªå·±è·Ÿéš
    IEndDragHandler,       // ç»“æŸæ‹–æ‹½ï¼šè½¬å‘ç»™ Manager
    IDropHandler           // æ¥æ”¶æ”¾ç½®ï¼šè®°å½•ç›®æ ‡æ§½ä½
```

### InventoryInteractionManager å…¬å…±æ–¹æ³•

```csharp
// æ§½ä½è¢«ç‚¹å‡»ï¼ˆPointerDownï¼‰- æ‰€æœ‰ç‚¹å‡»é€»è¾‘çš„å…¥å£
public void OnSlotPointerDown(int index, bool isEquip);

// å¼€å§‹æ‹–æ‹½
public void OnSlotBeginDrag(int index, bool isEquip, PointerEventData eventData);

// ç»“æŸæ‹–æ‹½
public void OnSlotEndDrag(PointerEventData eventData);

// æ‹–æ‹½ç»è¿‡æ§½ä½
public void OnSlotDrop(int index, bool isEquip);

// å–æ¶ˆå½“å‰æ“ä½œ
public void Cancel();

// æ˜¯å¦æ­£åœ¨æ‹¿å–ç‰©å“
public bool IsHolding { get; }
```

---

## äº¤äº’çŠ¶æ€æœº

### çŠ¶æ€å®šä¹‰

| çŠ¶æ€ | è¯´æ˜ | è¿›å…¥æ¡ä»¶ | é€€å‡ºæ¡ä»¶ |
|------|------|----------|----------|
| **Idle** | ç©ºé—²ï¼Œæ‰‹ä¸Šæ²¡æœ‰ç‰©å“ | åˆå§‹çŠ¶æ€ / æ”¾ç½®æˆåŠŸ / è¿”å›åŸä½ | æ‹¿èµ·ç‰©å“ |
| **HeldByShift** | é€šè¿‡ Shift+å·¦é”® æ‹¿èµ·ç‰©å“ | Shift+å·¦é”®æŒ‰ä¸‹åœ¨æœ‰ç‰©å“æ§½ä½ | æ”¾ç½® / è¿”å›åŸä½ / ESC |
| **HeldByCtrl** | é€šè¿‡ Ctrl+å·¦é”® æ‹¿èµ·ç‰©å“ | Ctrl+å·¦é”®æŒ‰ä¸‹åœ¨æœ‰ç‰©å“æ§½ä½ | æ”¾ç½® / è¿”å›åŸä½ / ESC |
| **Dragging** | é€šè¿‡é•¿æŒ‰æ‹–æ‹½æ‹¿èµ·ç‰©å“ | æ— ä¿®é¥°é”®é•¿æŒ‰0.15ç§’+ç§»åŠ¨5åƒç´  | æ¾å¼€å·¦é”® |

### çŠ¶æ€è½¬æ¢å›¾

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                                         â”‚
                    â–¼                                         â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚
              â”‚   Idle   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
              â”‚ (ç©ºé—²)   â”‚                                    â”‚
              â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                    â”‚
                   â”‚                                          â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
     â”‚             â”‚             â”‚                    â”‚       â”‚
     â–¼             â–¼             â–¼                    â”‚       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚       â”‚
â”‚HeldBy   â”‚  â”‚HeldBy   â”‚  â”‚ Dragging â”‚               â”‚       â”‚
â”‚Shift    â”‚  â”‚Ctrl     â”‚  â”‚ (æ‹–æ‹½)   â”‚               â”‚       â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜               â”‚       â”‚
     â”‚            â”‚            â”‚                      â”‚       â”‚
     â”‚            â”‚            â”‚                      â”‚       â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
                   â”‚                                          â”‚
                   â”‚ æ”¾ç½®æˆåŠŸ/è¿”å›åŸä½/ESC                     â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒåŒºåˆ«

| ç‰¹æ€§ | Shift/Ctrl æ‹¿èµ· | æ‹–æ‹½ |
|------|-----------------|------|
| è§¦å‘æ–¹å¼ | ä¿®é¥°é”®+å·¦é”®**æŒ‰ä¸‹** | æ— ä¿®é¥°é”®é•¿æŒ‰+ç§»åŠ¨ |
| ç‰©å“è·Ÿéš | è·Ÿéšé¼ æ ‡ | è·Ÿéšé¼ æ ‡ |
| æ”¾ç½®è§¦å‘ | **å†æ¬¡ç‚¹å‡»** | **æ¾å¼€å·¦é”®** |
| é‡åˆ°ä¸åŒç‰©å“ | **è¿”å›åŸä½** | **äº¤æ¢** |
| åŸæ§½ä½çŠ¶æ€ | ä¿ç•™å‰©ä½™æ•°é‡ | æ¸…ç©º |

---

## è¯¦ç»†äº¤äº’çŸ©é˜µ

### Idle çŠ¶æ€ï¼ˆæ‰‹ä¸Šæ²¡æœ‰ç‰©å“ï¼‰

| è¾“å…¥ | ç›®æ ‡æ§½ä½ | æ“ä½œç»“æœ | æ–°çŠ¶æ€ |
|------|----------|----------|--------|
| å·¦é”®å•å‡» | ç©ºæ§½ä½ | æ— æ“ä½œï¼ˆToggle é€‰ä¸­æ•ˆæœï¼‰ | Idle |
| å·¦é”®å•å‡» | æœ‰ç‰©å“ | æ— æ“ä½œï¼ˆToggle é€‰ä¸­æ•ˆæœï¼‰ | Idle |
| Shift+å·¦é”®æŒ‰ä¸‹ | ç©ºæ§½ä½ | æ— æ“ä½œ | Idle |
| Shift+å·¦é”®æŒ‰ä¸‹ | æœ‰ç‰©å“ | æ‹¿èµ·ä¸€åŠï¼ˆå‘ä¸‹å–æ•´ï¼‰ | HeldByShift |
| Ctrl+å·¦é”®æŒ‰ä¸‹ | ç©ºæ§½ä½ | æ— æ“ä½œ | Idle |
| Ctrl+å·¦é”®æŒ‰ä¸‹ | æœ‰ç‰©å“ï¼ˆéè£…å¤‡ç±»ï¼‰ | æ‹¿èµ· 1 ä¸ª | HeldByCtrl |
| Ctrl+å·¦é”®æŒ‰ä¸‹ | æœ‰ç‰©å“ï¼ˆè£…å¤‡ç±»ï¼‰ | å¿«é€Ÿè£…å¤‡ | Idle |
| Ctrl+é•¿æŒ‰ | æœ‰ç‰©å“ | æŒç»­æ‹¿å–ï¼ˆ3.5ä¸ª/ç§’ï¼‰ | HeldByCtrl |
| é•¿æŒ‰0.15ç§’+ç§»åŠ¨5åƒç´  | æœ‰ç‰©å“ | æ‹¿èµ·å…¨éƒ¨ï¼Œè¿›å…¥æ‹–æ‹½ | Dragging |
| Shift+Ctrl+å·¦é”® | ä»»æ„ | æ— æ“ä½œï¼ˆå†²çªå¿½ç•¥ï¼‰ | Idle |

### HeldByShift/HeldByCtrl çŠ¶æ€ï¼ˆæ‰‹ä¸Šæœ‰ç‰©å“ï¼‰

| è¾“å…¥ | ç›®æ ‡æ§½ä½ | æ“ä½œç»“æœ | æ–°çŠ¶æ€ |
|------|----------|----------|--------|
| å·¦é”®å•å‡» | ç©ºæ§½ä½ | æ”¾ç½®ç‰©å“ | Idle |
| å·¦é”®å•å‡» | æœ‰ç›¸åŒç‰©å“ | å †å  | Idle æˆ–ä¿æŒ |
| å·¦é”®å•å‡» | æœ‰ä¸åŒç‰©å“ | **è¿”å›åŸä½** | Idle |
| Shift+å·¦é”®å•å‡» | æºæ§½ä½ | è¿ç»­äºŒåˆ† | HeldByShift |
| å·¦é”®å•å‡» | é¢æ¿å¤– | ä¸¢å¼ƒç‰©å“ | Idle |
| ESC | - | è¿”å›åŸä½ | Idle |

### Dragging çŠ¶æ€ï¼ˆæ‹–æ‹½ä¸­ï¼‰

| è¾“å…¥ | ç›®æ ‡æ§½ä½ | æ“ä½œç»“æœ | æ–°çŠ¶æ€ |
|------|----------|----------|--------|
| æ¾å¼€å·¦é”® | ç©ºæ§½ä½ | æ”¾ç½®ç‰©å“ | Idle |
| æ¾å¼€å·¦é”® | æœ‰ç›¸åŒç‰©å“ | å †å  | Idle |
| æ¾å¼€å·¦é”® | æœ‰ä¸åŒç‰©å“ | **äº¤æ¢** | Idle |
| æ¾å¼€å·¦é”® | é¢æ¿å¤– | ä¸¢å¼ƒç‰©å“ | Idle |
| æ¾å¼€å·¦é”® | æºæ§½ä½ | è¿”å›åŸä½ | Idle |
| ESC | - | è¿”å›åŸä½ | Idle |

---

## å¼€å‘å†ç¨‹ä¸é”™è¯¯è®°å½•

### ç‰ˆæœ¬æ¼”è¿›

| ç‰ˆæœ¬ | æ—¥æœŸ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|------|
| V1 | 2026-01-04 | âŒ å¤±è´¥ | è¿‡åº¦é‡æ„ï¼Œç ´ååŸæœ‰æ˜¾ç¤ºé€»è¾‘ |
| V2 | 2026-01-05 | âŒ å¤±è´¥ | Update + Raycast æ–¹æ¡ˆï¼Œä¸ EventSystem å†²çª |
| V3 | 2026-01-06 | âŒ å¤±è´¥ | æ¥å£å†²çªï¼ŒOnPointerDown è¢«æ‹–æ‹½ç³»ç»ŸåŠ«æŒ |
| V4 | 2026-01-06 | âœ… æˆåŠŸ | æ–¹æ¡ˆ D - åˆ†ç¦»ç»„ä»¶æ¶æ„ + çŠ¶æ€é©±åŠ¨ |

### V1 å¤±è´¥åŸå› 

1. **æ··æ·† UI å­å¯¹è±¡ç”¨é€”** - æŠŠ `Target`ï¼ˆé€‰ä¸­æ ·å¼ï¼‰å½“æˆäº† `Icon`ï¼ˆç‰©å“å›¾æ ‡ï¼‰
2. **æ–‡ä»¶è¢«æˆªæ–­** - å¤šæ¬¡ä¿®æ”¹å¯¼è‡´æ–‡ä»¶ä¸å®Œæ•´
3. **ItemDatabase è·å–é”™è¯¯** - ä½¿ç”¨ `FindFirstObjectByType` æŸ¥æ‰¾ ScriptableObject
4. **è¿‡åº¦å¤æ‚çš„é‡æ„** - ç ´åäº†åŸæœ‰çš„ç®€å•è®¾è®¡

### V2 å¤±è´¥åŸå› 

1. **Update + Raycast ä¸ EventSystem å†²çª** - Toggle ç»„ä»¶ä¼š"åå™¬"ç‚¹å‡»äº‹ä»¶
2. **æ‰‹åŠ¨å°„çº¿æ£€æµ‹ä¸ç¨³å®š** - UI å…ƒç´ çš„ RaycastTarget ä¼šæ‹¦æˆªå°„çº¿
3. **é‡æ–°å‘æ˜è½®å­** - Unity å·²ç»æä¾›äº†å®Œå–„çš„äº‹ä»¶æ¥å£

### V3 å¤±è´¥åŸå› 

1. **æ¥å£å†²çª** - åŒæ—¶å®ç° `IPointerDownHandler` å’Œ `IBeginDragHandler` æ—¶ï¼Œç‚¹å‡»äº‹ä»¶è¢«åŠ«æŒ
2. **æ— æ³•æ£€æµ‹ä¿®é¥°é”®** - `OnPointerDown` è¢«å»¶è¿Ÿæˆ–è·³è¿‡
3. **æ— æ³•å®ç°é•¿æŒ‰æŒç»­æ‹¿å–** - éœ€è¦ `OnPointerDown` é…åˆè®¡æ—¶å™¨

### V4 æˆåŠŸå…³é”®

1. **åˆ†ç¦»ç»„ä»¶æ¶æ„** - æ˜¾ç¤º/äº¤äº’/é€»è¾‘å®Œå…¨åˆ†ç¦»
2. **çŠ¶æ€é©±åŠ¨çš„æ¥å£ç®¡ç†** - é€šè¿‡ `isDragEnabled` æ ‡å¿—æ§åˆ¶æ‹–æ‹½è¡Œä¸º
3. **PointerUp ä¸åšä»»ä½•äº‹** - Shift/Ctrl æ‹¿èµ·åç­‰å¾…å†æ¬¡ç‚¹å‡»
4. **åŠ¨æ€è·å– slotIndex** - ä¸åœ¨ Awake æ—¶ç»‘å®šï¼Œé¿å…æ—¶æœºé—®é¢˜

### å…³é”® Bug ä¿®å¤è®°å½•

| Bug | åŸå›  | ä¿®å¤æ–¹æ¡ˆ |
|-----|------|----------|
| slotIndex æ€»æ˜¯ 0 | Awake æ—¶ Index è¿˜æ²¡è®¾ç½® | æ”¹ä¸ºåŠ¨æ€è·å– `SlotIndex` å±æ€§ |
| Shift å•å‡»æ‰§è¡Œä¸¤æ¬¡äºŒåˆ† | PointerUp è§¦å‘äº†æ”¾ç½®é€»è¾‘ | PointerUp ä¸åšä»»ä½•äº‹ |
| Ctrl å•å‡»æ‹¿èµ·åˆæ”¾ä¸‹ | åŒä¸Š | åŒä¸Š |
| äº¤æ¢åç‰©å“ | ç›®æ ‡ç‰©å“æ”¾åˆ°æ‰‹ä¸Šè€Œä¸æ˜¯æºæ§½ä½ | ä¿®å¤äº¤æ¢é€»è¾‘ |
| Toggle å…¨çº¢ | ä»£ç ä¿®æ”¹äº† Toggle é…ç½® | å®Œå…¨ä¸ä¿®æ”¹ Toggle é…ç½® |
| ç‚¹å‡»æ— å“åº” | Canvas ç¼ºå°‘ GraphicRaycaster | æ·»åŠ  GraphicRaycaster ç»„ä»¶ |

---

## ä»£ç æ–‡ä»¶æ¸…å•

### æ ¸å¿ƒæ–‡ä»¶

| æ–‡ä»¶ | è¯´æ˜ | è¡Œæ•° |
|------|------|------|
| `InventoryInteractionManager.cs` | äº¤äº’ç®¡ç†å™¨ï¼ˆå¤§è„‘ï¼‰ | ~350 |
| `InventorySlotInteraction.cs` | äº¤äº’ç»„ä»¶ï¼ˆä¼ æ„Ÿå™¨ï¼‰ | ~120 |
| `InventorySlotUI.cs` | èƒŒåŒ…æ§½ä½æ˜¾ç¤º | ~150 |
| `EquipmentSlotUI.cs` | è£…å¤‡æ§½ä½æ˜¾ç¤º | ~130 |
| `HeldItemDisplay.cs` | è·Ÿéšé¼ æ ‡æ˜¾ç¤º | ~120 |

### ç›¸å…³æœåŠ¡

| æ–‡ä»¶ | è¯´æ˜ |
|------|------|
| `InventoryService.cs` | èƒŒåŒ…æ•°æ®æœåŠ¡ |
| `EquipmentService.cs` | è£…å¤‡æ•°æ®æœåŠ¡ |
| `InventorySortService.cs` | èƒŒåŒ…æ•´ç†æœåŠ¡ |
| `WorldItemPool.cs` | ä¸–ç•Œç‰©å“æ±  |
| `WorldItemPickup.cs` | å¯æ‹¾å–ç‰©å“ |

### æ–‡æ¡£æ–‡ä»¶

| æ–‡ä»¶ | è¯´æ˜ |
|------|------|
| `.kiro/specs/UIç³»ç»Ÿ/0_èƒŒåŒ…äº¤äº’ç³»ç»Ÿå‡çº§/requirements.md` | éœ€æ±‚æ–‡æ¡£ |
| `.kiro/specs/UIç³»ç»Ÿ/0_èƒŒåŒ…äº¤äº’ç³»ç»Ÿå‡çº§/äº¤äº’çŠ¶æ€è¡¨.md` | è¯¦ç»†çŠ¶æ€è¡¨ |
| `.kiro/specs/UIç³»ç»Ÿ/0_èƒŒåŒ…äº¤äº’ç³»ç»Ÿå‡çº§/design_v4_æ–¹æ¡ˆD.md` | V4 è®¾è®¡æ–‡æ¡£ |
| `.kiro/specs/UIç³»ç»Ÿ/0_èƒŒåŒ…äº¤äº’ç³»ç»Ÿå‡çº§/é”™è¯¯åçœ.md` | é”™è¯¯è®°å½• |
| `.kiro/specs/UIç³»ç»Ÿ/0_èƒŒåŒ…äº¤äº’ç³»ç»Ÿå‡çº§/å®¢è§‚è¯„ä»·.md` | å¤–éƒ¨è¯„ä»· |
| `.kiro/specs/UIç³»ç»Ÿ/1_èƒŒåŒ…V4é£å‡/memory.md` | å¼€å‘è®°å¿† |

---

## åœºæ™¯é…ç½®æŒ‡å—

### å¿…è¦ç»„ä»¶æ£€æŸ¥æ¸…å•

- [ ] UI Canvas æœ‰ `GraphicRaycaster` ç»„ä»¶
- [ ] PackagePanel æœ‰ `InventoryInteractionManager` ç»„ä»¶
- [ ] HeldItemDisplay åœ¨ Canvas æˆ– PackagePanel ä¸‹ï¼ˆä¸æ˜¯é¢„åˆ¶ä½“ï¼‰
- [ ] HeldItemDisplay æœ‰ `CanvasGroup`ï¼ˆAlpha=0, Block Raycasts=falseï¼‰
- [ ] Icon å’Œ Amount çš„ `Raycast Target` å–æ¶ˆå‹¾é€‰
- [ ] æ¯ä¸ªæ§½ä½çš„ Image çš„ `Raycast Target` å‹¾é€‰

### InventoryInteractionManager é…ç½®

| å­—æ®µ | è¯´æ˜ | å¿…å¡« |
|------|------|------|
| inventory | InventoryService å¼•ç”¨ | âœ… |
| equipment | EquipmentService å¼•ç”¨ | âœ… |
| database | ItemDatabase å¼•ç”¨ | âœ… |
| heldDisplay | HeldItemDisplay å¼•ç”¨ | âœ… |
| panelRect | PackagePanel çš„ RectTransform | âœ… |
| inventorySlots | 36 ä¸ª InventorySlotUI å¼•ç”¨ | å¯é€‰ï¼ˆç”¨äºé€‰ä¸­åŠŸèƒ½ï¼‰ |
| equipmentSlots | 6 ä¸ª EquipmentSlotUI å¼•ç”¨ | å¯é€‰ |
| ctrlPickupRate | Ctrl é•¿æŒ‰æ‹¿å–é€Ÿåº¦ï¼ˆé»˜è®¤ 3.5ï¼‰ | å¯é€‰ |
| dropCooldown | ä¸¢å¼ƒå†·å´æ—¶é—´ï¼ˆé»˜è®¤ 5 ç§’ï¼‰ | å¯é€‰ |

### HeldItemDisplay é…ç½®

```
HeldItemDisplay (GameObject)
â”œâ”€â”€ HeldItemDisplay (Component)
â”‚   â”œâ”€â”€ iconImage â†’ Icon å­ç‰©ä½“çš„ Image
â”‚   â”œâ”€â”€ amountText â†’ Amount å­ç‰©ä½“çš„ Text
â”‚   â””â”€â”€ canvasGroup â†’ è‡ªèº«çš„ CanvasGroup
â”œâ”€â”€ CanvasGroup (Component)
â”‚   â”œâ”€â”€ Alpha = 0
â”‚   â””â”€â”€ Block Raycasts = false
â”œâ”€â”€ Icon (å­ç‰©ä½“)
â”‚   â””â”€â”€ Image (Raycast Target = false)
â””â”€â”€ Amount (å­ç‰©ä½“)
    â””â”€â”€ Text (Raycast Target = false)
```

---

## å·²çŸ¥é—®é¢˜ä¸å¾…ä¼˜åŒ–

### é—®é¢˜ 1ï¼šä¸¢å¼ƒåŒºåŸŸåˆ¤å®šä¸å‡†ç¡®

**ç°è±¡**ï¼šæ— è®ºç”¨ä»€ä¹ˆæ–¹å¼æ‹¿èµ·ç‰©å“ï¼Œåœ¨èƒŒåŒ…å¤–æ¾å¼€éƒ½ä¼šè¿”å›åŸä½ï¼Œä¸ä¼šä¸¢å¼ƒ

**åŸå› **ï¼š`panelRect` å¼•ç”¨çš„æ˜¯æ•´ä¸ª PackagePanelï¼ŒåŒ…æ‹¬ Background

**æ­£ç¡®é€»è¾‘**ï¼š
- èƒŒåŒ…åŒºåŸŸ = Main + Topï¼ˆä¸åŒ…æ‹¬ Backgroundï¼‰
- åœ¨ Main æˆ– Top å†…ä½†ä¸åœ¨æ§½ä½ä¸Š â†’ è¿”å›åŸä½
- åœ¨ Main å’Œ Top å¤– â†’ ä¸¢å¼ƒ

**ä¿®å¤æ–¹æ¡ˆ**ï¼šéœ€è¦ä¿®æ”¹ `IsInsidePanel` æ–¹æ³•ï¼Œæ£€æŸ¥ Main å’Œ Top åŒºåŸŸ

### é—®é¢˜ 2ï¼šShift/Ctrl æ‹¿èµ·åç‚¹å‡»éæ§½ä½åŒºåŸŸ

**ç°è±¡**ï¼šæ‹¿èµ·ç‰©å“åç‚¹å‡» Top åŒºåŸŸï¼ˆTab æ ï¼‰æ²¡æœ‰ååº”

**æ­£ç¡®é€»è¾‘**ï¼š
- ç‚¹å‡»éæ§½ä½åŒºåŸŸï¼ˆå¦‚ Topï¼‰åº”è¯¥è§†ä¸º"æ”¾ç½®å¤±è´¥"
- æ”¾ç½®å¤±è´¥ â†’ è¿”å›åŸä½

**ä¿®å¤æ–¹æ¡ˆ**ï¼šéœ€è¦æ·»åŠ å…¨å±€ç‚¹å‡»æ£€æµ‹ï¼Œåœ¨éæ§½ä½åŒºåŸŸç‚¹å‡»æ—¶è¿”å›åŸä½

### é—®é¢˜ 3ï¼šSort å’Œ TrashCan æŒ‰é’®æœªç»‘å®š

**ç°è±¡**ï¼šç‚¹å‡» Sort å’Œ TrashCan æŒ‰é’®æ²¡æœ‰ååº”

**åŸå› **ï¼šæŒ‰é’®çš„ OnClick äº‹ä»¶æœªç»‘å®šåˆ°å¯¹åº”æ–¹æ³•

**ä¿®å¤æ–¹æ¡ˆ**ï¼š
- Sort æŒ‰é’®éœ€è¦ç»‘å®šåˆ° `InventorySortService.SortInventory()`
- TrashCan éœ€è¦ä½œä¸ºä¸¢å¼ƒç›®æ ‡åŒºåŸŸï¼Œæˆ–è€…ç»‘å®šä¸¢å¼ƒæ–¹æ³•

---

## å…³é”®æ•™è®­æ€»ç»“

### ğŸ”´ ç»å¯¹ç¦æ­¢

1. **ä¸è¦ä¿®æ”¹ç”¨æˆ·çš„ Toggle é…ç½®** - graphicã€targetGraphicã€transitionã€isOn éƒ½æ˜¯ç”¨æˆ·ç²¾å¿ƒé…ç½®çš„
2. **ä¸è¦ä½¿ç”¨ Update + Raycast æ£€æµ‹ UI** - ä¸ Unity EventSystem å†²çª
3. **ä¸è¦æŠŠ Target/Selected å½“æˆ Icon** - å®ƒä»¬æ˜¯é€‰ä¸­æ ·å¼ï¼Œä¸æ˜¯ç‰©å“å›¾æ ‡
4. **ä¸è¦ç”¨ FindFirstObjectByType æŸ¥æ‰¾ ScriptableObject** - æ°¸è¿œè¿”å› null
5. **ä¸è¦åœ¨ Awake æ—¶ç»‘å®š slotIndex** - æ­¤æ—¶ Index è¿˜æ²¡è®¾ç½®

### ğŸŸ¢ æ­£ç¡®åšæ³•

1. **ä½¿ç”¨ Unity åŸç”Ÿäº‹ä»¶æ¥å£** - IPointerDownHandlerã€IBeginDragHandler ç­‰
2. **ä¿æŒåŸæœ‰æ˜¾ç¤ºé€»è¾‘ä¸å˜** - åªæ·»åŠ äº¤äº’ç»„ä»¶ï¼Œä¸ä¿®æ”¹æ˜¾ç¤ºé€»è¾‘
3. **ä½¿ç”¨ç»„åˆè€Œéç»§æ‰¿** - äº¤äº’åŠŸèƒ½ä½œä¸ºç‹¬ç«‹ç»„ä»¶
4. **åŠ¨æ€è·å– slotIndex** - é€šè¿‡å±æ€§ä» SlotUI è·å–
5. **PointerUp ä¸è§¦å‘ Shift/Ctrl æ”¾ç½®** - ç­‰å¾…å†æ¬¡ç‚¹å‡»
6. **å…ˆå†™äº¤äº’çŠ¶æ€è¡¨å†å†™ä»£ç ** - æ˜ç¡®æ¯ç§çŠ¶æ€ä¸‹çš„è¡Œä¸º

### ğŸŸ¡ è°ƒè¯•æŠ€å·§

1. **æŸ¥çœ‹å½©è‰²æ—¥å¿—** - é’è‰²=äº‹ä»¶ï¼Œç»¿è‰²=æˆåŠŸï¼Œé»„è‰²=è­¦å‘Šï¼Œçº¢è‰²=é”™è¯¯
2. **æ£€æŸ¥ Manager.Instance** - ç¡®ä¿ä¸ä¸º null
3. **æ£€æŸ¥ GraphicRaycaster** - Canvas å¿…é¡»æœ‰è¿™ä¸ªç»„ä»¶
4. **æ£€æŸ¥ Raycast Target** - æ§½ä½ Image å¿…é¡»å‹¾é€‰ï¼ŒHeldItemDisplay å­ç‰©ä½“å¿…é¡»å–æ¶ˆ

---

## é™„å½•ï¼šè¾“å…¥åœºæ™¯çŸ©é˜µ

### åœºæ™¯ 1ï¼šä¸–ç•Œï¼ˆæ—  UI æ‰“å¼€ï¼‰

| è¾“å…¥ | è¡Œä¸º |
|------|------|
| WASD | ç©å®¶ç§»åŠ¨ |
| Shift | ç–¾è·‘ |
| å·¦é”®ï¼ˆä¸–ç•Œï¼‰ | ä½¿ç”¨å½“å‰å·¥å…· |
| å·¦é”®ï¼ˆToolbarï¼‰ | é€‰ä¸­æ§½ä½ |
| å³é”®ï¼ˆä¸–ç•Œï¼‰ | è‡ªåŠ¨å¯¼èˆª |
| æ»šè½® | åˆ‡æ¢ Toolbar æ§½ä½ |
| 1-5 | é€‰ä¸­ Toolbar æ§½ä½ |
| Tab/B/M/L/O | æ‰“å¼€èƒŒåŒ…å¯¹åº”é¡µ |
| ESC | æ‰“å¼€è®¾ç½®é¡µ |

### åœºæ™¯ 2ï¼šèƒŒåŒ…é¢æ¿æ‰“å¼€

| è¾“å…¥ | è¡Œä¸º |
|------|------|
| WASD | âŒ ç¦ç”¨ |
| å·¦é”®ï¼ˆæ§½ä½ï¼‰ | å¼€å§‹æ‹–æ‹½æ£€æµ‹ |
| å·¦é”®ï¼ˆToolbarï¼‰ | âŒ ç¦ç”¨ï¼ˆè¢«é®æŒ¡ï¼‰ |
| å³é”®ï¼ˆä¸–ç•Œï¼‰ | âŒ ç¦ç”¨ |
| Shift+å·¦é”®ï¼ˆæ§½ä½ï¼‰ | äºŒåˆ†æ‹¿å– |
| Ctrl+å·¦é”®ï¼ˆæ§½ä½ï¼‰ | å•ä¸ªæ‹¿å–/å¿«é€Ÿè£…å¤‡ |
| æ»šè½® | âŒ ç¦ç”¨ |
| 1-5 | âŒ ç¦ç”¨ |
| Tab/B/M/L/O | åˆ‡æ¢é¡µé¢ï¼ˆå–æ¶ˆæ‹¿å–ï¼‰ |
| ESC | å…³é—­èƒŒåŒ…ï¼ˆå–æ¶ˆæ‹¿å–ï¼‰ |

### åœºæ™¯ 2.1ï¼šèƒŒåŒ…æ‰“å¼€ + æ‹¿èµ·ç‰©å“çŠ¶æ€

| è¾“å…¥ | è¡Œä¸º |
|------|------|
| å·¦é”®ï¼ˆç©ºæ§½ä½ï¼‰ | æ”¾ç½®ç‰©å“ |
| å·¦é”®ï¼ˆæœ‰ç‰©å“æ§½ä½ï¼‰ | è¿”å›åŸä½ï¼ˆShift/Ctrlï¼‰/ äº¤æ¢ï¼ˆæ‹–æ‹½ï¼‰ |
| å·¦é”®ï¼ˆé¢æ¿å¤–ï¼‰ | ä¸¢å¼ƒç‰©å“ |
| Shift+å·¦é”®ï¼ˆæºæ§½ä½ï¼‰ | è¿ç»­äºŒåˆ† |
| ESC | è¿”å›åŸä½ |
| Tab/B/M/L/O | å–æ¶ˆæ‹¿å–å¹¶åˆ‡æ¢é¡µé¢ |

---

*æ–‡æ¡£ç»“æŸ*


---

## 2026-01-07 ä¿®å¤è®°å½•

### ä¿®å¤ 1ï¼šä¸¢å¼ƒåŒºåŸŸåˆ¤å®š

**é—®é¢˜**ï¼šæ— è®ºç”¨ä»€ä¹ˆæ–¹å¼æ‹¿èµ·ç‰©å“ï¼Œåœ¨èƒŒåŒ…å¤–æ¾å¼€éƒ½ä¼šè¿”å›åŸä½ï¼Œä¸ä¼šä¸¢å¼ƒ

**åŸå› **ï¼š`panelRect` å¼•ç”¨çš„æ˜¯æ•´ä¸ª PackagePanelï¼ŒåŒ…æ‹¬ Background

**ä¿®å¤æ–¹æ¡ˆ**ï¼š
1. æ·»åŠ  `mainRect` å’Œ `topRect` å¼•ç”¨
2. ä¿®æ”¹ `IsInsidePanel` æ–¹æ³•ï¼Œåªæ£€æŸ¥ Main å’Œ Top åŒºåŸŸ
3. åœ¨ Main å’Œ Top å¤–æ¾å¼€ â†’ ä¸¢å¼ƒ

**ä¿®æ”¹æ–‡ä»¶**ï¼š`InventoryInteractionManager.cs`

**æ–°å¢å­—æ®µ**ï¼š
```csharp
[SerializeField] private RectTransform mainRect;         // Main åŒºåŸŸ
[SerializeField] private RectTransform topRect;          // Top åŒºåŸŸ
[SerializeField] private RectTransform trashCanRect;     // åƒåœ¾æ¡¶åŒºåŸŸ
```

**ä¿®æ”¹æ–¹æ³•**ï¼š
```csharp
private bool IsInsidePanel(Vector2 pos)
{
    bool insideMain = mainRect != null && RectTransformUtility.RectangleContainsScreenPoint(mainRect, pos);
    bool insideTop = topRect != null && RectTransformUtility.RectangleContainsScreenPoint(topRect, pos);
    
    if (mainRect == null && topRect == null)
    {
        return panelRect != null && RectTransformUtility.RectangleContainsScreenPoint(panelRect, pos);
    }
    
    return insideMain || insideTop;
}
```

### ä¿®å¤ 2ï¼šShift/Ctrl æ‹¿èµ·åç‚¹å‡»éæ§½ä½åŒºåŸŸ

**é—®é¢˜**ï¼šæ‹¿èµ·ç‰©å“åç‚¹å‡» Top åŒºåŸŸï¼ˆTab æ ï¼‰æ²¡æœ‰ååº”

**ä¿®å¤æ–¹æ¡ˆ**ï¼š
1. åˆ›å»º `InventoryPanelClickHandler` ç»„ä»¶
2. æŒ‚è½½åœ¨ Main å’Œ Top åŒºåŸŸä¸Š
3. æ£€æµ‹éæ§½ä½åŒºåŸŸçš„ç‚¹å‡»ï¼Œè§¦å‘è¿”å›åŸä½

**æ–°å»ºæ–‡ä»¶**ï¼š`InventoryPanelClickHandler.cs`

**ä½¿ç”¨æ–¹æ³•**ï¼š
- åœ¨ Main ç‰©ä½“ä¸Šæ·»åŠ  `InventoryPanelClickHandler` ç»„ä»¶
- åœ¨ Top ç‰©ä½“ä¸Šæ·»åŠ  `InventoryPanelClickHandler` ç»„ä»¶
- åœ¨åƒåœ¾æ¡¶ç‰©ä½“ä¸Šæ·»åŠ  `InventoryPanelClickHandler` ç»„ä»¶ï¼Œå‹¾é€‰ `isDropZone`

### ä¿®å¤ 3ï¼šSort å’Œ TrashCan æŒ‰é’®

**é—®é¢˜**ï¼šç‚¹å‡» Sort å’Œ TrashCan æŒ‰é’®æ²¡æœ‰ååº”

**ä¿®å¤æ–¹æ¡ˆ**ï¼š
1. åœ¨ `InventoryInteractionManager` ä¸­æ·»åŠ æŒ‰é’®å¼•ç”¨å’Œç»‘å®š
2. æ·»åŠ  `OnSortButtonClick` æ–¹æ³•
3. æ·»åŠ  `OnTrashCanClick` å…¬å…±æ–¹æ³•

**æ–°å¢å­—æ®µ**ï¼š
```csharp
[SerializeField] private Button sortButton;              // æ•´ç†æŒ‰é’®
[SerializeField] private InventorySortService sortService; // æ•´ç†æœåŠ¡
```

**æ–°å¢æ–¹æ³•**ï¼š
```csharp
private void OnSortButtonClick()
{
    if (IsHolding) Cancel();
    if (sortService != null) sortService.SortInventory();
}

public void OnTrashCanClick()
{
    if (!IsHolding) return;
    DropItem();
    ResetState();
}
```

### åœºæ™¯é…ç½®æ›´æ–°

**InventoryInteractionManager æ–°å¢é…ç½®**ï¼š

| å­—æ®µ | è¯´æ˜ | å¿…å¡« |
|------|------|------|
| mainRect | Main åŒºåŸŸçš„ RectTransform | âœ… |
| topRect | Top åŒºåŸŸçš„ RectTransform | âœ… |
| trashCanRect | åƒåœ¾æ¡¶çš„ RectTransform | å¯é€‰ |
| sortButton | æ•´ç†æŒ‰é’® | å¯é€‰ |
| sortService | InventorySortService å¼•ç”¨ | å¯é€‰ |

**æ–°å¢ç»„ä»¶é…ç½®**ï¼š

1. **Main ç‰©ä½“**ï¼šæ·»åŠ  `InventoryPanelClickHandler` ç»„ä»¶
2. **Top ç‰©ä½“**ï¼šæ·»åŠ  `InventoryPanelClickHandler` ç»„ä»¶
3. **åƒåœ¾æ¡¶ç‰©ä½“**ï¼šæ·»åŠ  `InventoryPanelClickHandler` ç»„ä»¶ï¼Œå‹¾é€‰ `isDropZone = true`

### éªŒæ”¶æµ‹è¯•

| æµ‹è¯•é¡¹ | æ“ä½œ | é¢„æœŸç»“æœ |
|--------|------|----------|
| æ‹–æ‹½ä¸¢å¼ƒ | æ‹–æ‹½ç‰©å“åˆ° Main/Top å¤–æ¾å¼€ | ç‰©å“ä¸¢å¼ƒåˆ°ç©å®¶ä½ç½® |
| æ‹–æ‹½åˆ°åƒåœ¾æ¡¶ | æ‹–æ‹½ç‰©å“åˆ°åƒåœ¾æ¡¶æ¾å¼€ | ç‰©å“ä¸¢å¼ƒ |
| Shift æ‹¿èµ·åä¸¢å¼ƒ | Shift+å·¦é”®æ‹¿èµ·ï¼Œç‚¹å‡» Main/Top å¤– | ç‰©å“ä¸¢å¼ƒ |
| Shift æ‹¿èµ·åç‚¹å‡» Top | Shift+å·¦é”®æ‹¿èµ·ï¼Œç‚¹å‡» Tab æ  | è¿”å›åŸä½ |
| æ•´ç†æŒ‰é’® | ç‚¹å‡» Sort æŒ‰é’® | èƒŒåŒ…ç‰©å“åˆå¹¶å¹¶æ’åº |
| åƒåœ¾æ¡¶æŒ‰é’® | æ‹¿èµ·ç‰©å“åç‚¹å‡»åƒåœ¾æ¡¶ | ç‰©å“ä¸¢å¼ƒ |

---

## é™„å½•ï¼šå®Œæ•´ä»£ç æ–‡ä»¶æ¸…å•

### æ ¸å¿ƒäº¤äº’æ–‡ä»¶

| æ–‡ä»¶ | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| InventoryInteractionManager.cs | `Assets/YYY_Scripts/UI/Inventory/` | äº¤äº’ç®¡ç†å™¨ï¼ˆå¤§è„‘ï¼‰ |
| InventorySlotInteraction.cs | `Assets/YYY_Scripts/UI/Inventory/` | æ§½ä½äº¤äº’ç»„ä»¶ï¼ˆä¼ æ„Ÿå™¨ï¼‰ |
| InventoryPanelClickHandler.cs | `Assets/YYY_Scripts/UI/Inventory/` | é¢æ¿ç‚¹å‡»å¤„ç†å™¨ï¼ˆæ–°å¢ï¼‰ |
| HeldItemDisplay.cs | `Assets/YYY_Scripts/UI/Inventory/` | è·Ÿéšé¼ æ ‡æ˜¾ç¤º |

### æ˜¾ç¤ºæ–‡ä»¶

| æ–‡ä»¶ | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| InventorySlotUI.cs | `Assets/YYY_Scripts/UI/Inventory/` | èƒŒåŒ…æ§½ä½æ˜¾ç¤º |
| EquipmentSlotUI.cs | `Assets/YYY_Scripts/UI/Inventory/` | è£…å¤‡æ§½ä½æ˜¾ç¤º |
| InventoryPanelUI.cs | `Assets/YYY_Scripts/UI/Inventory/` | èƒŒåŒ…é¢æ¿ |

### æœåŠ¡æ–‡ä»¶

| æ–‡ä»¶ | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| InventoryService.cs | `Assets/YYY_Scripts/Service/Inventory/` | èƒŒåŒ…æ•°æ®æœåŠ¡ |
| EquipmentService.cs | `Assets/YYY_Scripts/Service/Equipment/` | è£…å¤‡æ•°æ®æœåŠ¡ |
| InventorySortService.cs | `Assets/YYY_Scripts/Service/Inventory/` | èƒŒåŒ…æ•´ç†æœåŠ¡ |

### æ–‡æ¡£æ–‡ä»¶

| æ–‡ä»¶ | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| äº¤äº’çŠ¶æ€è¡¨.md | `.kiro/specs/UIç³»ç»Ÿ/0_èƒŒåŒ…äº¤äº’ç³»ç»Ÿå‡çº§/` | è¯¦ç»†çŠ¶æ€è½¬æ¢è¡¨ |
| è¾“å…¥åœºæ™¯çŸ©é˜µ.md | `.kiro/specs/UIç³»ç»Ÿ/1_èƒŒåŒ…V4é£å‡/` | è¾“å…¥åœºæ™¯å®šä¹‰ |
| memory.md | `.kiro/specs/UIç³»ç»Ÿ/1_èƒŒåŒ…V4é£å‡/` | å¼€å‘è®°å¿† |
| é”™è¯¯åçœ.md | `.kiro/specs/UIç³»ç»Ÿ/0_èƒŒåŒ…äº¤äº’ç³»ç»Ÿå‡çº§/` | é”™è¯¯è®°å½• |
| å®¢è§‚è¯„ä»·.md | `.kiro/specs/UIç³»ç»Ÿ/0_èƒŒåŒ…äº¤äº’ç³»ç»Ÿå‡çº§/` | å¤–éƒ¨è¯„ä»· |

---

*æ–‡æ¡£æ›´æ–°äº 2026-01-07*
