# 材料等级系统设计

**版本**: v1.0  
**日期**: 2025-12-20  
**状态**: 设计中

---

## 概述

世界材料分为六大类，按等级从低到高排列：
- **木 (Wood)** - 等级 0
- **石 (Stone)** - 等级 1
- **生铁 (Iron)** - 等级 2
- **黄铜 (Brass)** - 等级 3
- **钢 (Steel)** - 等级 4
- **金 (Gold)** - 等级 5

材料等级影响工具的采集能力和武器的攻击效果。

---

## 材料等级枚举

```csharp
/// <summary>
/// 材料等级（工具/武器材质）
/// </summary>
public enum MaterialTier
{
    Wood = 0,    // 木
    Stone = 1,   // 石
    Iron = 2,    // 生铁
    Brass = 3,   // 黄铜
    Steel = 4,   // 钢
    Gold = 5     // 金
}
```

---

## 工具材料等级

### 斧头采集限制

| 斧头材质 | 可砍伐树木阶段 | 说明 |
|---------|---------------|------|
| 木斧 (0) | 阶段 0-3 | 无法砍伐阶段 4-5 |
| 石斧 (1) | 阶段 0-3 | 无法砍伐阶段 4-5 |
| 生铁斧 (2) | 阶段 0-4 | 无法砍伐阶段 5 |
| 黄铜斧 (3) | 阶段 0-5 | 可砍伐所有阶段 |
| 钢斧 (4) | 阶段 0-5 | 可砍伐所有阶段 |
| 金斧 (5) | 阶段 0-5 | 可砍伐所有阶段 |

**重要规则**：
- 阶段 4 树木需要 **生铁斧或更高** 才能砍动
- 阶段 5 树木需要 **黄铜斧或更高** 才能砍动
- 低等级斧头砍高阶段树木：**无法造成伤害，但消耗精力和耐久**

### 镐子采集限制

| 镐子材质 | 材料等级 | 可获取矿物 | 说明 |
|---------|---------|-----------|------|
| 木镐 | 0 | 无 | 只能获得石料，无法获得任何矿物 |
| 石镐 | 1 | 铁矿(C2) | 铜矿/金矿只能获得石料 |
| 生铁镐 | 2 | 铁矿(C2)、铜矿(C1) | 金矿只能获得石料 |
| 黄铜镐 | 3 | 铁矿(C2)、铜矿(C1) | 金矿只能获得石料 |
| 钢镐 | 4 | 所有矿物 | 可采集金矿(C3) |
| 金镐 | 5 | 所有矿物 | 可采集金矿(C3) |

**重要规则**：
- **所有镐子都能获得石料**，这是最基础的
- 木镐只能获得石料，无法获得任何矿物
- 石镐可以获得铁矿（C2）的矿物，但铜矿（C1）和金矿（C3）只能获得石料
- 生铁镐/黄铜镐可以获得铁矿和铜矿的矿物，但金矿只能获得石料
- 只有 **钢镐或金镐** 才能获得金矿的矿物
- 低等级镐子挖高等级矿：**可以造成伤害，可以获得石料，但无法获得矿物**

---

## 矿石类型与等级

| 矿石类型 | 代码 | 所需镐子等级 | 说明 |
|---------|------|-------------|------|
| 纯石头 | - | 木镐 (0) | 任何镐子都能获得石料 |
| 铁矿 | C2 | 石镐 (1) | 最基础的矿石 |
| 铜矿 | C1 | 生铁镐 (2) | 中级矿石 |
| 金矿 | C3 | 钢镐 (4) | 高级矿石 |

**注意**：所有镐子都能获得石料，上表的"所需镐子等级"指的是获得矿物所需的最低等级。

---

## 树木阶段与等级

| 树木阶段 | 所需斧头等级 | 说明 |
|---------|-------------|------|
| 阶段 0-3 | 木斧 (0) | 任何斧头都能砍 |
| 阶段 4 | 生铁斧 (2) | 需要生铁或更高 |
| 阶段 5 | 黄铜斧 (3) | 需要黄铜或更高 |

---

## ToolData/WeaponData 扩展

### 新增字段

在 `ToolData` 和 `WeaponData` 中添加材料等级字段：

```csharp
[Header("材料等级")]
[Tooltip("工具/武器的材料等级（0=木, 1=石, 2=生铁, 3=黄铜, 4=钢, 5=金）")]
[SerializeField] private MaterialTier materialTier = MaterialTier.Wood;

/// <summary>
/// 获取材料等级
/// </summary>
public MaterialTier MaterialTier => materialTier;

/// <summary>
/// 获取材料等级数值（用于比较）
/// </summary>
public int GetMaterialTierValue() => (int)materialTier;
```

### 命名规范

工具/武器 SO 文件命名后缀对应材料等级：
- `_0` = 木
- `_1` = 石
- `_2` = 生铁
- `_3` = 黄铜
- `_4` = 钢
- `_5` = 金

示例：
- `Tool_0_Axe_0.asset` = 木斧
- `Tool_1_Axe_1.asset` = 石斧
- `Tool_2_Axe_2.asset` = 生铁斧

---

## 采集判定逻辑

### 树木采集判定

```csharp
/// <summary>
/// 检查斧头是否能砍伐指定阶段的树木
/// </summary>
public static bool CanChopTree(int axeMaterialTier, int treeStage)
{
    // 阶段 0-3：任何斧头都能砍
    if (treeStage <= 3) return true;
    
    // 阶段 4：需要生铁斧（等级2）或更高
    if (treeStage == 4) return axeMaterialTier >= 2;
    
    // 阶段 5：需要黄铜斧（等级3）或更高
    if (treeStage == 5) return axeMaterialTier >= 3;
    
    return false;
}
```

### 矿石采集判定

```csharp
/// <summary>
/// 检查镐子是否能获取指定矿石的矿物
/// 注意：所有镐子都能获得石料，此方法只判断是否能获得矿物
/// </summary>
/// <param name="pickaxeTier">镐子材料等级</param>
/// <param name="oreType">矿石类型（C1=铜, C2=铁, C3=金, null=纯石头）</param>
/// <returns>true=可获得矿物, false=只能获得石料</returns>
public static bool CanMineOre(int pickaxeTier, string oreType)
{
    // 纯石头（无矿物）：返回 true（虽然没有矿物可获得）
    if (string.IsNullOrEmpty(oreType)) return true;
    
    switch (oreType)
    {
        case "C2": // 铁矿
            return pickaxeTier >= 1; // 石镐或更高
            
        case "C1": // 铜矿
            return pickaxeTier >= 2; // 生铁镐或更高
            
        case "C3": // 金矿
            return pickaxeTier >= 4; // 钢镐或更高
            
        default:
            return true;
    }
}

/// <summary>
/// 所有镐子都能获得石料
/// </summary>
public static bool CanGetStone(int pickaxeTier)
{
    return true; // 任何镐子都能获得石料
}
```

---

## 交互反馈

### 等级不足时的反馈

**砍树（完全无法砍动）**：
- 播放"叮"的金属碰撞音效
- 显示 UI 提示："斧头等级不足"
- 消耗精力和耐久
- 不造成任何伤害

**采矿（可以挖但无法获得矿物）**：
- 正常播放挖掘音效和粒子
- 正常造成伤害
- 消耗精力和耐久
- 只掉落石料，不掉落矿物
- 只获得石料经验，不获得矿物经验

---

## 相关文件

| 文件 | 说明 |
|------|------|
| `Assets/Scripts/Data/Enums/MaterialTier.cs` | 材料等级枚举（待创建） |
| `Assets/Scripts/Data/Items/ToolData.cs` | 工具数据（需更新） |
| `Assets/Scripts/Data/Items/WeaponData.cs` | 武器数据（需更新） |
| `Assets/Scripts/Controller/TreeControllerV2.cs` | 树木控制器（需更新） |
| `Assets/Scripts/Controller/StoneController.cs` | 石头控制器（待创建） |

---

*文