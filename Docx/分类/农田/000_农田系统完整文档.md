# å†œç”°ç³»ç»Ÿå®Œæ•´æ–‡æ¡£

**ç‰ˆæœ¬**: v1.0  
**æ—¥æœŸ**: 2025-12-16  
**çŠ¶æ€**: ğŸš§ è¿›è¡Œä¸­ï¼ˆçº¦30%å®Œæˆï¼‰  
**åˆå¹¶æ¥æº**: å†œç”°ç³»ç»Ÿç¼–è¯‘é”™è¯¯ä¿®å¤è®°å½•.md

---

## ç¬¬ä¸€éƒ¨åˆ†ï¼šç³»ç»Ÿæ¦‚è¿°

### æ ¸å¿ƒåŠŸèƒ½
- è€•åœ°çŠ¶æ€ç®¡ç†ï¼ˆæœªå¼€å¦/å·²å¼€å¦/å·²æµ‡æ°´ï¼‰
- ä½œç‰©ç”Ÿé•¿å‘¨æœŸï¼ˆæ’­ç§â†’ç”Ÿé•¿â†’æˆç†Ÿâ†’æ”¶è·ï¼‰
- æ°´åˆ†ç³»ç»Ÿï¼ˆ3ç§è§†è§‰çŠ¶æ€ï¼‰
- å­£èŠ‚é€‚åº”æ€§

---

## ç¬¬äºŒéƒ¨åˆ†ï¼šæ•°æ®ç»“æ„

### FarmTileData

```csharp
public class FarmTileData
{
    public bool isTilled;              // æ˜¯å¦å·²è€•ä½œ
    public bool wateredToday;          // ä»Šå¤©æ˜¯å¦æµ‡æ°´
    public bool wateredYesterday;      // æ˜¨å¤©æ˜¯å¦æµ‡æ°´
    public float waterTime;            // æµ‡æ°´æ—¶é—´ï¼ˆå°æ—¶ï¼‰
    public SoilMoistureState moistureState;  // å½“å‰æ¹¿åº¦çŠ¶æ€
    public CropInstance crop;          // ä½œç‰©å®ä¾‹
}
```

### SoilMoistureState

```csharp
public enum SoilMoistureState
{
    Dry,           // å¹²ç‡¥
    WetWithPuddle, // æ¹¿æ¶¦å¸¦æ°´æ´¼ï¼ˆæµ‡æ°´å2å°æ—¶å†…ï¼‰
    WetDark        // æ¹¿æ¶¦æ·±è‰²ï¼ˆæµ‡æ°´2å°æ—¶åï¼‰
}
```

### CropInstance

```csharp
public class CropInstance
{
    public int cropDataId;
    public int currentGrowthDay;
    public DateTime plantedTime;
    
    public int GetCurrentGrowthStage()
    {
        if (currentGrowthDay >= seedData.growthDays) 
            return seedData.growthStageSprites.Length - 1;
            
        float growthPercent = (float)currentGrowthDay / seedData.growthDays;
        return Mathf.FloorToInt(growthPercent * (seedData.growthStageSprites.Length - 1));
    }

    public bool IsMature()
    {
        return currentGrowthDay >= seedData.growthDays;
    }
}
```

---

## ç¬¬ä¸‰éƒ¨åˆ†ï¼šæ—¶é—´ç³»ç»Ÿé›†æˆ

### äº‹ä»¶è®¢é˜…ï¼ˆé‡è¦ï¼ï¼‰

```csharp
// âœ… æ­£ç¡®ï¼šä½¿ç”¨é™æ€äº‹ä»¶è®¿é—®
TimeManager.OnDayChanged += OnDayChanged;
TimeManager.OnHourChanged += OnHourChanged;

// âŒ é”™è¯¯ï¼šä½¿ç”¨å®ä¾‹æ–¹æ³•è®¿é—®
// timeManager.OnDayChanged += OnDayChanged;
```

### äº‹ä»¶ç­¾å

```csharp
// âœ… æ­£ç¡®ç­¾å
void OnDayChanged(int year, int day, int totalDays) { }
void OnHourChanged(int hour) { }

// âŒ é”™è¯¯ç­¾å
// void OnDayChanged(int day, Season season) { }
```

### æ¯æ—¥æ›´æ–°é€»è¾‘

```csharp
private void OnDayChanged(int year, int day, int totalDays)
{
    foreach (var tileData in farmTiles.Values)
    {
        // ä½œç‰©ç”Ÿé•¿ï¼ˆå¦‚æœæ˜¨å¤©æµ‡æ°´ï¼‰
        if (tileData.crop != null && tileData.wateredYesterday)
        {
            tileData.crop.currentGrowthDay++;
        }
        
        // é‡ç½®æµ‡æ°´çŠ¶æ€
        tileData.wateredYesterday = tileData.wateredToday;
        tileData.wateredToday = false;
        tileData.moistureState = SoilMoistureState.Dry;
    }
}
```

---

## ç¬¬å››éƒ¨åˆ†ï¼šç¼–è¯‘é”™è¯¯ä¿®å¤è®°å½•

### é—®é¢˜1ï¼šTimeManager APIä¸åŒ¹é…

| é”™è¯¯å‡è®¾ | å®é™…API |
|----------|---------|
| `timeManager.OnDayChanged` | `TimeManager.OnDayChanged` (é™æ€) |
| `timeManager.CurrentDay` | `timeManager.GetDay()` |
| `timeManager.CurrentHour` | `timeManager.GetHour()` |
| `timeManager.CurrentSeason` | `timeManager.GetSeason()` |

### é—®é¢˜2ï¼šæ–‡ä»¶å†²çª

- åŒæ—¶å­˜åœ¨ `FarmingManager.cs`ï¼ˆæ—§ç‰ˆï¼‰å’Œ `FarmingManager_v2.cs`ï¼ˆæ–°ç‰ˆï¼‰
- è§£å†³ï¼šåˆ é™¤æ—§ç‰ˆæ–‡ä»¶

### é—®é¢˜3ï¼šItemDatabaseè®¿é—®

```csharp
// âŒ é”™è¯¯ï¼šæ°¸è¿œè¿”å› null
database = FindFirstObjectByType<ItemDatabase>();

// âœ… æ­£ç¡®ï¼šä»å·²æœ‰å¼•ç”¨è·å–
database = inventory.Database;
```

---

## ç¬¬äº”éƒ¨åˆ†ï¼šæ•°æ®æµç¨‹

```
ç¬¬Nå¤©æ™šä¸Šï¼š
  ç©å®¶æµ‡æ°´ â†’ wateredToday = true
            waterTime = å½“å‰æ—¶é—´
            è§†è§‰ç«‹å³å˜ä¸ºæ°´æ¸

ç¬¬Nå¤©+2å°æ—¶ï¼š
  OnHourChanged â†’ æ£€æµ‹æ—¶é—´å·® â‰¥ 2å°æ—¶
                â†’ è§†è§‰å˜ä¸ºæ·±è‰²ï¼ˆæ— æ°´æ¸ï¼‰

ç¬¬N+1å¤©å¼€å§‹ï¼š
  OnDayChanged â†’ wateredYesterday = wateredToday (true)
              â†’ wateredToday = false
              â†’ è§†è§‰å˜ä¸ºå¹²ç‡¥
              
  CropGrowthSystem.OnDayChangedï¼š
    if (wateredYesterday == true)
      â†’ ä½œç‰©ç”Ÿé•¿ +1
    else
      â†’ è¿ç»­æœªæµ‡æ°´å¤©æ•° +1
      â†’ æ£€æŸ¥æ˜¯å¦æ¯è
```

---

## ç¬¬å…­éƒ¨åˆ†ï¼šå­£èŠ‚åˆ¤æ–­

### æšä¸¾å¯¹åº”
- ItemEnums.Season: Spring=0, Summer=1, Fall=2, Winter=3
- SeasonManager.Season: Spring=0, Summer=1, Autumn=2, Winter=3

### åˆ¤æ–­é€»è¾‘

```csharp
private bool IsCorrectSeason(SeedData seedData)
{
    // å…¨å­£èŠ‚ç§å­å¯ä»¥åœ¨ä»»ä½•å­£èŠ‚ç§æ¤
    if (seedData.season == Season.AllSeason)
        return true;

    // è½¬æ¢ä¸ºæ•´æ•°æ¯”è¾ƒ
    SeasonManager.Season currentSeason = timeManager.GetSeason();
    return (int)seedData.season == (int)currentSeason;
}
```

---

## ç¬¬ä¸ƒéƒ¨åˆ†ï¼šç²¾åŠ›æ¶ˆè€—é…ç½®

```csharp
[Header("ç²¾åŠ›æ¶ˆè€—")]
[SerializeField] private float tillingStaminaCost = 3f;   // é”„åœ°
[SerializeField] private float wateringStaminaCost = 2f;  // æµ‡æ°´
```

---

## ç¬¬å…«éƒ¨åˆ†ï¼šå½“å‰æ–‡ä»¶çŠ¶æ€

### æœ‰æ•ˆæ–‡ä»¶

```
Assets/Scripts/Farm/
â”œâ”€â”€ FarmingManager.cs âœ… (æ–°ç‰ˆæœ¬)
â”œâ”€â”€ CropGrowthSystem.cs âœ…
â”œâ”€â”€ FarmTileData.cs âœ…
â”œâ”€â”€ CropInstance.cs âœ…
â”œâ”€â”€ CropController.cs âœ…
â””â”€â”€ SoilMoistureState.cs âœ…
```

### å·²åˆ é™¤æ–‡ä»¶

```
âŒ FarmingManager.cs (æ—§ç‰ˆæœ¬)
âŒ WaterEvaporationSystem.cs (ä¸å†éœ€è¦)
```

---

## ç¬¬ä¹éƒ¨åˆ†ï¼šå¾…å®ŒæˆåŠŸèƒ½

### é«˜ä¼˜å…ˆçº§
- [ ] å®ç° ItemDatabase è®¿é—®
- [ ] æ·»åŠ ç²¾åŠ›å€¼æ¶ˆè€—é€»è¾‘
- [ ] å®Œå–„æ”¶è·åŠŸèƒ½ï¼ˆç‰©å“æ‰è½ã€ç»éªŒå€¼ï¼‰

### ä¸­ä¼˜å…ˆçº§
- [ ] æ·»åŠ æ›´å¤šä½œç‰©ç±»å‹
- [ ] å®ç°å­£èŠ‚å˜åŒ–æ•ˆæœ
- [ ] æ·»åŠ éŸ³æ•ˆå’Œç²’å­æ•ˆæœ

### ä½ä¼˜å…ˆçº§
- [ ] ä¼˜åŒ–æ€§èƒ½
- [ ] æ·»åŠ æˆå°±ç³»ç»Ÿé›†æˆ
- [ ] æ·»åŠ æ•™ç¨‹å¼•å¯¼

---

## ç¬¬åéƒ¨åˆ†ï¼šç›¸å…³æ–‡ä»¶

| æ–‡ä»¶ | èŒè´£ |
|------|------|
| `Assets/Scripts/Farm/FarmingManager.cs` | å†œç”°ç®¡ç†å™¨ |
| `Assets/Scripts/Farm/FarmTileData.cs` | å†œç”°æ ¼å­æ•°æ® |
| `Assets/Scripts/Farm/CropInstance.cs` | ä½œç‰©å®ä¾‹ |
| `Assets/Scripts/Farm/CropGrowthSystem.cs` | ä½œç‰©ç”Ÿé•¿ç³»ç»Ÿ |
| `Assets/Scripts/Farm/SoilMoistureState.cs` | åœŸå£¤æ¹¿åº¦çŠ¶æ€ |

---

*æ–‡æ¡£ç»“æŸ - æœ¬æ–‡æ¡£åˆå¹¶äº†å†œç”°æ–‡ä»¶å¤¹çš„æ‰€æœ‰å†…å®¹*
