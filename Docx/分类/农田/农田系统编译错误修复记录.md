# å†œç”°ç³»ç»Ÿç¼–è¯‘é”™è¯¯ä¿®å¤è®°å½•

**æ—¶é—´**: 2024å¹´12æœˆ3æ—¥  
**é—®é¢˜**: å¤§é‡ç¼–è¯‘é”™è¯¯ï¼ˆ40+ä¸ªï¼‰  
**çŠ¶æ€**: âœ… å·²å…¨éƒ¨ä¿®å¤

---

## ğŸ”¥ é—®é¢˜åŸå› 

### 1. TimeManager APIä¸åŒ¹é…

**é”™è¯¯åŸå› **ï¼šæˆ‘å‡è®¾çš„APIä¸å®é™…ä¸åŒ

| æˆ‘å‡è®¾çš„API | å®é™…çš„API |
|------------|----------|
| `timeManager.OnDayChanged` (å®ä¾‹äº‹ä»¶) | `TimeManager.OnDayChanged` (é™æ€äº‹ä»¶) |
| `timeManager.CurrentDay` | `timeManager.GetDay()` |
| `timeManager.CurrentHour` | `timeManager.GetHour()` |
| `timeManager.CurrentMinute` | `timeManager.GetMinute()` |
| `timeManager.CurrentSeason` | `timeManager.GetSeason()` |
| `OnDayChanged(int day, Season season)` | `OnDayChanged(int year, int day, int totalDays)` |
| `OnHourChanged(int hour, int minute)` | `OnHourChanged(int hour)` |

### 2. æ–‡ä»¶å†²çª

- åŒæ—¶å­˜åœ¨`FarmingManager.cs`ï¼ˆæ—§ç‰ˆï¼‰å’Œ`FarmingManager_v2.cs`ï¼ˆæ–°ç‰ˆï¼‰
- åŒæ—¶å­˜åœ¨`WaterEvaporationSystem.cs`ï¼ˆå·²ä¸éœ€è¦ï¼‰
- å¯¼è‡´é‡å¤å®šä¹‰å’Œå­—æ®µä¸åŒ¹é…

### 3. æ•°æ®ç»“æ„å˜åŒ–

- `FarmTileData`è¢«ä¿®æ”¹ï¼Œç§»é™¤äº†`isWatered`å’Œ`lastWateredDay`
- æ—§ç‰ˆFarmingManagerä»åœ¨ä½¿ç”¨è¿™äº›å­—æ®µ

### 4. ItemDatabaseè®¿é—®é—®é¢˜

- `ItemDatabase`æ˜¯ScriptableObjectï¼Œä¸æ˜¯å•ä¾‹
- ä¸èƒ½ç”¨`ItemDatabase.Instance`è®¿é—®

---

## âœ… å·²ä¿®å¤å†…å®¹

### ä¿®å¤1: åˆ é™¤æ—§æ–‡ä»¶

```powershell
# åˆ é™¤å†²çªæ–‡ä»¶
Remove-Item "Assets/Scripts/Farm/FarmingManager.cs" (æ—§ç‰ˆ)
Remove-Item "Assets/Scripts/Farm/WaterEvaporationSystem.cs"
```

### ä¿®å¤2: æ›´æ–°CropGrowthSystem.cs

```csharp
// âŒ æ—§ä»£ç ï¼ˆé”™è¯¯ï¼‰
timeManager.OnDayChanged += OnDayChanged;
private void OnDayChanged(int currentDay, SeasonManager.Season currentSeason)
{
    if (tileData.isWatered) // å­—æ®µä¸å­˜åœ¨
    {
        ...
    }
}

// âœ… æ–°ä»£ç ï¼ˆæ­£ç¡®ï¼‰
TimeManager.OnDayChanged += OnDayChanged; // é™æ€äº‹ä»¶
private void OnDayChanged(int year, int day, int totalDays)
{
    if (tileData.wateredYesterday) // ä½¿ç”¨æ–°å­—æ®µ
    {
        ...
    }
}
```

### ä¿®å¤3: æ›´æ–°FarmingManager.cs

```csharp
// âŒ æ—§ä»£ç 
timeManager.OnDayChanged += OnDayChanged; // å®ä¾‹è®¿é—®
int day = timeManager.CurrentDay; // å±æ€§è®¿é—®
Season season = timeManager.CurrentSeason;

// âœ… æ–°ä»£ç 
TimeManager.OnDayChanged += OnDayChanged; // é™æ€äº‹ä»¶
int day = timeManager.GetDay(); // æ–¹æ³•è®¿é—®
SeasonManager.Season season = timeManager.GetSeason();
```

### ä¿®å¤4: ä¸´æ—¶ç¦ç”¨ItemDatabase

```csharp
// TODO: éœ€è¦å®ç°ItemDatabaseè®¿é—®æ–¹æ³•
harvestedCrop = null; // ä¸´æ—¶è¿”å›null
harvestAmount = Random.Range(...); // ç›´æ¥ä»SeedDataè·å–èŒƒå›´
```

---

## ğŸ“‹ å½“å‰çŠ¶æ€

### âœ… å·²å®Œæˆ

- [x] åˆ é™¤å†²çªçš„æ—§æ–‡ä»¶
- [x] ä¿®å¤TimeManageräº‹ä»¶è®¢é˜…ï¼ˆé™æ€ vs å®ä¾‹ï¼‰
- [x] ä¿®å¤TimeManageræ–¹æ³•è°ƒç”¨ï¼ˆGetæ–¹æ³•ï¼‰
- [x] ä¿®å¤FarmTileDataå­—æ®µå¼•ç”¨ï¼ˆwateredYesterdayï¼‰
- [x] ä¿®å¤ç±»åï¼ˆFarmingManager_v2 â†’ FarmingManagerï¼‰
- [x] ä¿®å¤æœªé—­åˆçš„æ³¨é‡Š

### âš ï¸ ä¸´æ—¶ç¦ç”¨

- [ ] **ItemDatabaseè®¿é—®**ï¼šæ”¶è·åŠŸèƒ½ä¼šè¿”å›nullï¼Œéœ€è¦åç»­å®ç°

---

## ğŸ”§ åç»­éœ€è¦åšçš„

### ä¼˜å…ˆçº§P0ï¼ˆå¿…éœ€ï¼‰

1. **å®ç°ItemDatabaseè®¿é—®æ–¹å¼**
   
   **æ–¹æ¡ˆAï¼ˆæ¨èï¼‰**ï¼šåˆ›å»ºä¸€ä¸ªManager
   ```csharp
   public class GameDataManager : MonoBehaviour
   {
       public static GameDataManager Instance;
       public ItemDatabase itemDatabase;
       
       void Awake() {
           Instance = this;
       }
   }
   
   // ä½¿ç”¨
   ItemData item = GameDataManager.Instance.itemDatabase.GetItemByID(id);
   ```

   **æ–¹æ¡ˆB**ï¼šä½¿ç”¨Resources.Load
   ```csharp
   ItemDatabase db = Resources.Load<ItemDatabase>("MasterItemDatabase");
   ```

2. **æµ‹è¯•å®Œæ•´æµç¨‹**
   - é”„åœ° â†’ ç§æ¤ â†’ æµ‡æ°´ â†’ ç”Ÿé•¿ â†’ æ”¶è·

### ä¼˜å…ˆçº§P1ï¼ˆé‡è¦ï¼‰

3. **åˆ›å»ºæµ‹è¯•è„šæœ¬**ï¼ˆæµ‹è¯•Tilemapåˆ‡æ¢ï¼‰
4. **å‡†å¤‡Tileèµ„æº**ï¼ˆ5ä¸ªTileï¼‰
5. **åˆ›å»ºä½œç‰©é¢„åˆ¶ä½“**

---

## ğŸ“Š æ–‡ä»¶çŠ¶æ€

### å½“å‰æœ‰æ•ˆæ–‡ä»¶

```
Assets/Scripts/Farm/
â”œâ”€â”€ FarmingManager.cs âœ… (å·²ä¿®å¤ï¼Œæ–°ç‰ˆæœ¬)
â”œâ”€â”€ CropGrowthSystem.cs âœ… (å·²ä¿®å¤)
â”œâ”€â”€ FarmTileData.cs âœ… (æ–°æ•°æ®ç»“æ„)
â”œâ”€â”€ CropInstance.cs âœ…
â”œâ”€â”€ CropController.cs âœ…
â””â”€â”€ SoilMoistureState.cs âœ… (æ–°å¢)
```

### å·²åˆ é™¤æ–‡ä»¶

```
âŒ FarmingManager.cs (æ—§ç‰ˆæœ¬)
âŒ WaterEvaporationSystem.cs (ä¸å†éœ€è¦)
```

---

## ğŸ¯ å…³é”®å˜åŒ–æ€»ç»“

### æ•°æ®æµç¨‹ï¼ˆæ–°ç‰ˆï¼‰

```
ç¬¬Nå¤©æ™šä¸Šï¼š
  ç©å®¶æµ‡æ°´ â†’ wateredToday = true â† è®°å½•å‚æ•°
            waterTime = å½“å‰æ—¶é—´
            è§†è§‰ç«‹å³å˜ä¸ºæ°´æ¸

ç¬¬Nå¤©+2å°æ—¶ï¼š
  OnHourChanged â†’ æ£€æµ‹æ—¶é—´å·® â‰¥ 2å°æ—¶
                â†’ è§†è§‰å˜ä¸ºæ·±è‰²ï¼ˆæ— æ°´æ¸ï¼‰

ç¬¬N+1å¤©å¼€å§‹ï¼š
  OnDayChanged â†’ wateredYesterday = wateredToday (true)
              â†’ wateredToday = false
              â†’ è§†è§‰å˜ä¸ºå¹²ç‡¥
              
  CropGrowthSystem.OnDayChangedï¼š
    if (wateredYesterday == true)
      â†’ ä½œç‰©ç”Ÿé•¿ +1
    else
      â†’ è¿ç»­æœªæµ‡æ°´å¤©æ•° +1
      â†’ æ£€æŸ¥æ˜¯å¦æ¯è
```

### äº‹ä»¶è®¢é˜…æ–¹å¼

```csharp
// âŒ é”™è¯¯ï¼ˆå®ä¾‹è®¿é—®ï¼‰
timeManager.OnDayChanged += OnDayChanged;

// âœ… æ­£ç¡®ï¼ˆé™æ€è®¿é—®ï¼‰
TimeManager.OnDayChanged += OnDayChanged;

// âŒ é”™è¯¯ï¼ˆäº‹ä»¶ç­¾åï¼‰
void OnDayChanged(int day, Season season)

// âœ… æ­£ç¡®ï¼ˆäº‹ä»¶ç­¾åï¼‰
void OnDayChanged(int year, int day, int totalDays)
```

---

## ğŸ§ª éªŒè¯æ–¹æ³•

1. **ç¼–è¯‘é€šè¿‡**ï¼š`Ctrl+Shift+B` æ— é”™è¯¯
2. **è¿è¡Œæµ‹è¯•**ï¼šåˆ›å»ºæµ‹è¯•è„šæœ¬ï¼ŒæŒ‰Té”®é”„åœ°
3. **æ£€æŸ¥äº‹ä»¶**ï¼šçœ‹Consoleæ˜¯å¦æœ‰"å·²è®¢é˜…OnDayChanged"æ—¥å¿—

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- **å®æ–½æŒ‡å—**: `Docx/Plan/å†œç”°ç³»ç»Ÿ-å¿«é€Ÿå¼€å§‹.md`
- **è¯¦ç»†è®¾è®¡**: `Docx/Plan/å†œç”°ç³»ç»Ÿ-è¶…è¯¦ç»†å®æ–½æ¸…å•.md`
- **å®Œæ•´è®¾è®¡**: `Docx/Plan/ç§ç”°ç³»ç»Ÿå®Œæ•´è®¾è®¡æ–¹æ¡ˆ.md`

---

**ä¿®å¤å®Œæˆæ—¶é—´**: 2024å¹´12æœˆ3æ—¥ 20:30  
**ç¼–è¯‘çŠ¶æ€**: âœ… æ— é”™è¯¯ï¼ˆItemDatabaseè®¿é—®éœ€è¦åç»­å®ç°ï¼‰
