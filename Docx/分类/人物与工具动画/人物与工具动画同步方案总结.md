# äººç‰©ä¸å·¥å…·åŠ¨ç”»åŒæ­¥æ–¹æ¡ˆæ€»ç»“

ç‰ˆæœ¬: v3.0  
æ—¥æœŸ: 2025-12-16  
çŠ¶æ€: **å·²å®Œæˆ**

> ğŸ“Œ è¯¦ç»†å¼€å‘å†ç¨‹è¯·å‚é˜…ï¼š`Docx/Solutions/æ‰‹æŒå·¥å…·åŒæ­¥åŠŸèƒ½.md`

---

## ä¸€ã€å½“å‰æ¶æ„

```
Player
â””â”€â”€ Tool    â† å•ä¸€å·¥å…·å­å¯¹è±¡
```

æ—©æœŸè§„åˆ’çš„å¤æ‚åˆ†ç»„æ¶æ„ï¼ˆSliceGroup/CrushGroup/PierceGroupï¼‰å·²åºŸå¼ƒã€‚

---

## äºŒã€æ ¸å¿ƒåŒæ­¥æœºåˆ¶ï¼šMode A++ï¼ˆå¸§ç´¢å¼•ç¡¬é”ï¼‰

ç”¨"å¸§å·"è€Œé"æ—¶é—´"åšåŒæ­¥åŸºå‡†ï¼š

```csharp
if (TryGetPlayerFrameIndex(out int frameIndex)) {
    int mappedToolIndex = Mathf.RoundToInt(frameIndex * (toolCount - 1f) / (playerCount - 1f));
    float toolNorm = (mappedToolIndex / (float)(toolCount - 1)) + EPSILON;
    toolAnimator.Play(targetHash, 0, toolNorm);
    toolAnimator.Update(0);
}
```

---

## ä¸‰ã€å·¥å…·åŠ¨ä½œé”å®šç³»ç»Ÿ

### ä¸‰ä¸ªæ ¸å¿ƒçªç ´

| é—®é¢˜ | è§£å†³æ–¹æ¡ˆ |
|------|----------|
| é•¿æŒ‰æœŸé—´é¬¼ç•œ | æ—¶é—´è®¡æ—¶å™¨æ›¿ä»£ normalizedTime |
| æ–¹å‘åˆ‡æ¢æŠ½æ | ForcePlayAnimation æ™ºèƒ½æ–¹å‘æ£€æµ‹ |
| åŠ¨ç”»ç»“æŸé—ªçƒ | ForceHideTool / AllowToolShow æœºåˆ¶ |

### å…³é”®ä»£ç 

**æ—¶é—´è®¡æ—¶å™¨**ï¼ˆæ›¿ä»£ä¸ç¨³å®šçš„ normalizedTimeï¼‰ï¼š
```csharp
private float toolAnimationDuration = 0.8f;
public bool IsAnimationFinished() {
    return Time.time - _actionStartTime >= toolAnimationDuration;
}
```

**æ™ºèƒ½æ–¹å‘æ£€æµ‹**ï¼ˆæ–¹å‘ä¸å˜æ—¶ä¸é‡ç½®åŠ¨ç”»ï¼‰ï¼š
```csharp
public void ForcePlayAnimation(...) {
    if (directionChanged) PlayAnimationInternal(...);
    // æ–¹å‘ä¸å˜ï¼šè®©åŠ¨ç”»è‡ªç„¶å¾ªç¯
}
```

**å¼ºåˆ¶éšè—æœºåˆ¶**ï¼ˆé˜²æ­¢ç»“æŸé—ªçƒï¼‰ï¼š
```csharp
public void ForceHideTool() {
    _forceHideUntilNextAction = true;
    toolSpriteRenderer.enabled = false;
}
```

---

## å››ã€åŠ¨ç”»çŠ¶æ€æ˜ å°„

| å·¥å…· | AnimState | å€¼ |
|------|-----------|-----|
| æ–§å¤´/é•°åˆ€ | Slice | 6 |
| é•å­/é”„å¤´ | Crush | 8 |
| é•¿å‰‘ | Pierce | 7 |
| é±¼ç«¿ | Fish | 9 |
| æ´’æ°´å£¶ | Watering | 10 |

---

## äº”ã€é…ç½®è¦ç‚¹

| å‚æ•° | è¯´æ˜ |
|------|------|
| toolAnimationDuration | â˜… å¿…é¡»ä¸åŠ¨ç”»å‰ªè¾‘æ—¶é•¿åŒ¹é… |
| lastFrameLockThreshold | æœ€åä¸€å¸§é”å®šé˜ˆå€¼ |

---

## å…­ã€ç»éªŒæ•™è®­

1. ä¸è¦ä¾èµ– normalizedTime
2. æ–¹å‘ä¸å˜æ—¶ä¸é‡ç½®åŠ¨ç”»
3. ä¸»åŠ¨æ§åˆ¶å·¥å…·æ˜¾éš
4. ç¼“å­˜åœ¨åŠ¨ç”»ç»“æŸæ—¶åº”ç”¨
5. æ¶æ„ä»ç®€

---

## ä¸ƒã€ç›¸å…³æ–‡ä»¶

- `Assets/Scripts/Service/Player/PlayerInteraction.cs`
- `Assets/Scripts/Anim/Player/PlayerAnimController.cs`
- `Assets/Scripts/Anim/_...._/LayerAnimSync.cs`
- `Assets/Scripts/Service/Player/ToolActionLockManager.cs`
- `Docx/Solutions/æ‰‹æŒå·¥å…·åŒæ­¥åŠŸèƒ½.md`ï¼ˆè¯¦ç»†å†ç¨‹ï¼‰

---

*æ–‡æ¡£ç»“æŸ*
