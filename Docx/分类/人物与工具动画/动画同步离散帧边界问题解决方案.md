# åŠ¨ç”»åŒæ­¥ç¦»æ•£å¸§è¾¹ç•Œé—®é¢˜è§£å†³æ–¹æ¡ˆ

**é—®é¢˜ç¼–å·**: ISSUE-001  
**ä¸¥é‡ç¨‹åº¦**: P0ï¼ˆæ ¸å¿ƒç©æ³•å½±å“ï¼‰  
**è§£å†³çŠ¶æ€**: âœ… å·²å®Œå…¨è§£å†³  
**è§£å†³æ—¶é—´**: 2024å¹´11æœˆ  
**ç›¸å…³æ–‡ä»¶**: `LayerAnimSync.cs`, `PlayerToolController.cs`, `PlayerAnimController.cs`

---

## ğŸ“‹ é—®é¢˜æè¿°

### ç°è±¡
- å·¥å…·ï¼ˆAxe/Pickaxeï¼‰ä¸äººç‰©åŠ¨ç”»å­˜åœ¨**1-2å¸§å¯è§å»¶è¿Ÿ**
- ç‰¹åˆ«åœ¨**å¤§ä½ç§»å¸§**ï¼ˆå¦‚æŒ¥åŠ¨åˆ°å‡»ä¸­çš„å…³é”®å¸§ï¼‰å‡ºç°æ˜æ˜¾**æ‹–å½±ç°è±¡**
- æ…¢é€Ÿæ’­æ”¾æ—¶ï¼Œå·¥å…·æ»åäºäººç‰©åŠ¨ä½œï¼Œç ´åè§†è§‰ä¸€è‡´æ€§
- å¿«é€Ÿåˆ‡æ¢æ–¹å‘æ—¶ï¼Œå·¥å…·å¯èƒ½åœç•™åœ¨é”™è¯¯çš„å¸§

### å½±å“èŒƒå›´
- æ‰€æœ‰æ‰‹æŒå·¥å…·çš„åŠ¨ç”»ï¼ˆæ–§å¤´ã€é•å­ã€é”„å¤´ç­‰ï¼‰
- ç©å®¶æ ¸å¿ƒäº¤äº’ä½“éªŒï¼ˆç æ ‘ã€æŒ–çŸ¿ï¼‰
- è§†è§‰è´¨é‡ä¸æ¸¸æˆå“è´¨æ„Ÿ

### å¤ç°æ¡ä»¶
1. è£…å¤‡å·¥å…·ï¼ˆå¦‚Axeï¼‰
2. æ‰§è¡ŒSliceåŠ¨ä½œï¼ˆEé”®ï¼‰
3. è§‚å¯Ÿå·¥å…·spriteä¸äººç‰©spriteçš„åŒæ­¥æƒ…å†µ
4. ç‰¹åˆ«åœ¨å¸§6-8ï¼ˆå¤§ä½ç§»å¸§ï¼‰æœ€ä¸ºæ˜æ˜¾

---

## ğŸ” æ ¹å› åˆ†æ

### æŠ€æœ¯èƒŒæ™¯

#### é¡¹ç›®æ¶æ„
- **åˆ†å±‚åŠ¨ç”»**ï¼šäººç‰©ï¼ˆPlayerï¼‰å’Œå·¥å…·ï¼ˆToolï¼‰ä½¿ç”¨**ç‹¬ç«‹çš„Animator**
- **çŠ¶æ€æœºå‚æ•°**ï¼š`State`ï¼ˆIdle/Walk/Sliceç­‰ï¼‰ã€`Direction`ï¼ˆDown/Side/Upï¼‰
- **å‘½åè§„åˆ™**ï¼šå·¥å…·çŠ¶æ€å‘½åä¸º`{State}_{Direction}_Clip_0_{Quality}`
- **å¸§ç‡è®¾ç½®**ï¼šåŠ¨ç”»é€šå¸¸18å¸§ï¼Œ60 FPSæ’­æ”¾

#### åŸæœ‰åŒæ­¥æ–¹æ¡ˆï¼ˆMode Aï¼‰
```csharp
// ä¼ªä»£ç 
void LateUpdate() {
    // 1. é•œåƒå‚æ•°
    toolAnimator.SetInteger("State", playerAnimator.GetInteger("State"));
    toolAnimator.SetInteger("Direction", playerAnimator.GetInteger("Direction"));
    
    // 2. æ—¶é—´å¯¹é½
    float normalizedTime = playerStateInfo.normalizedTime;
    toolAnimator.Play(toolStateHash, 0, normalizedTime);
}
```

### é—®é¢˜æ ¹æº

#### 1. ç¦»æ•£å¸§é‡‡æ ·çš„æœ¬è´¨é—®é¢˜
- **åŠ¨ç”»ç³»ç»Ÿæ˜¯ç¦»æ•£çš„**ï¼š18å¸§åŠ¨ç”»åœ¨60 FPSä¸‹æ¯å¸§æ’­æ”¾çº¦3.33ä¸ªæ¸¸æˆå¸§
- **normalizedTimeæ˜¯è¿ç»­å€¼**ï¼šèŒƒå›´0-1ï¼Œä½†çœŸå®spriteæ˜¯ç¦»æ•£çš„0, 1/18, 2/18, ...
- **è¾¹ç•Œè¯¯å·®**ï¼šå½“`normalizedTime = 0.333`æ—¶
  - Playerå¯èƒ½å·²ç»è·³åˆ°å¸§7ï¼ˆsprite_7ï¼‰
  - Toolå¯èƒ½è¿˜åœ¨å¸§6ï¼ˆsprite_6ï¼‰
  - å› ä¸ºä¸¤ä¸ªAnimatorçš„é‡‡æ ·æ—¶æœºç•¥æœ‰ä¸åŒ

#### 2. çŠ¶æ€æœºè½¬æ¢å»¶è¿Ÿ
- **å‚æ•°é•œåƒä¸æ˜¯ç¬æ—¶çš„**ï¼š`SetInteger`åï¼ŒçŠ¶æ€æœºéœ€è¦1-2å¸§æ‰èƒ½å®Œæˆè½¬æ¢
- **Play()ä¹Ÿæœ‰å»¶è¿Ÿ**ï¼šå³ä½¿è°ƒç”¨`Play(hash, time)`ï¼Œä¹Ÿè¦ç­‰åˆ°ä¸‹ä¸€å¸§æ‰çœŸæ­£åº”ç”¨
- **LateUpdateçš„å±€é™æ€§**ï¼šè™½ç„¶åœ¨æ¸²æŸ“å‰æ‰§è¡Œï¼Œä½†Animator.Update()å¯èƒ½å·²ç»åœ¨Updateé˜¶æ®µå®Œæˆ

#### 3. è¿ç»­æ—¶é—´å¯¹é½çš„ä¸å¯é æ€§
```
æ—¶é—´çº¿ç¤ºä¾‹ï¼ˆ18å¸§åŠ¨ç”»ï¼ŒnormalizedTimeï¼‰:
Player:  0.000 -> 0.055 -> 0.111 -> 0.167 -> 0.222 -> 0.278 [Sprite 5]
Tool:    0.000 -> 0.055 -> 0.111 -> 0.167 -> 0.222 -> 0.260 [Sprite 4]
                                                       ^^^^
                                            ç•¥æœ‰å»¶è¿Ÿï¼Œå¯¼è‡´spriteä¸åŒ
```

### å¤±è´¥å°è¯•è®°å½•

#### å°è¯•1ï¼šçº¯å‚æ•°é•œåƒ + æ—¶é—´å¯¹é½ï¼ˆMode Aï¼‰
- **åšæ³•**ï¼šé•œåƒ`State/Direction`ï¼Œç”¨`normalizedTime`å¯¹é½
- **ç»“æœ**ï¼šè¾¹ç•Œå¤„ä»æœ‰1å¸§æ‹–å½±
- **åŸå› **ï¼šè¿ç»­æ—¶é—´æ— æ³•ä¿è¯ç¦»æ•£å¸§å®Œå…¨ä¸€è‡´

#### å°è¯•2ï¼šå‚æ•°é•œåƒ + å½“å¸§è¯„ä¼°ï¼ˆMode A+ï¼‰
```csharp
// é•œåƒå‚æ•°åç«‹å³Update(0)
toolAnimator.SetInteger("State", state);
toolAnimator.Update(0);  // å¼ºåˆ¶å½“å¸§è¯„ä¼°

// å†å¯¹é½æ—¶é—´
toolAnimator.Play(hash, 0, normalizedTime);
toolAnimator.Update(0);  // å†æ¬¡å¼ºåˆ¶è¯„ä¼°
```
- **åšæ³•**ï¼šå¢åŠ `Update(0)`å¼ºåˆ¶å½“å¸§è¯„ä¼°
- **ç»“æœ**ï¼šæ”¹å–„æ˜æ˜¾ï¼Œä½†å¤§ä½ç§»å¸§ä»æœ‰é—®é¢˜
- **åŸå› **ï¼šä»åŸºäºè¿ç»­æ—¶é—´ï¼Œç¦»æ•£è¾¹ç•Œä¸å®Œå…¨ä¸€è‡´

#### å°è¯•3ï¼šå•Animatoråˆæˆå‰ªè¾‘
- **åšæ³•**ï¼šåœ¨Editorç”ŸæˆåˆæˆAnimationClipï¼ŒåŒä¸€å‰ªè¾‘å†…ç”¨ä¸¤æ¡æ›²çº¿åˆ†åˆ«é©±åŠ¨Playerå’ŒToolçš„SpriteRenderer
- **ä¼˜ç‚¹**ï¼šæ—¶é—´è½´å¤©ç„¶ä¸€è‡´ï¼Œç†è®ºä¸Šå®Œç¾åŒæ­¥
- **ç¼ºç‚¹**ï¼š
  - èµ„äº§æ”¹é€ é‡å·¨å¤§ï¼ˆæ¯ç§å·¥å…·Ã—æ¯ä¸ªå“è´¨Ã—æ¯ä¸ªæ–¹å‘Ã—æ¯ä¸ªçŠ¶æ€ï¼‰
  - ä¸æ˜“æ‰©å±•å’Œç»´æŠ¤
  - å¯¹ç°æœ‰æ§åˆ¶å™¨ä¾µå…¥æ€§é«˜
- **ç»“è®º**ï¼šæŠ€æœ¯å¯è¡Œä½†å·¥ç¨‹æˆæœ¬è¿‡é«˜ï¼Œæ”¾å¼ƒ

---

## âœ… æœ€ç»ˆè§£å†³æ–¹æ¡ˆï¼šå¸§ç´¢å¼•ç¡¬é”ï¼ˆMode A++ï¼‰

### æ ¸å¿ƒæ€æƒ³
**æ”¾å¼ƒè¿ç»­æ—¶é—´å¯¹é½ï¼Œæ”¹ç”¨ç¦»æ•£å¸§ç´¢å¼•å¯¹é½**
- ä¸å†ä¾èµ–`normalizedTime`çš„æµ®ç‚¹æ•°
- ç›´æ¥ä»Playerçš„Spriteåç§°è§£æ**å¸§å·**
- å°†å¸§å·æŒ‰æ¯”ä¾‹æ˜ å°„åˆ°Toolçš„å¸§å·
- ä½¿ç”¨`Play(hash, normalizedTime) + Update(0)`å®ç°**å½“å¸§åŒæ­¥**

### å®ç°æµç¨‹

```csharp
// LayerAnimSync.cs æ ¸å¿ƒé€»è¾‘ï¼ˆç®€åŒ–ç‰ˆï¼‰

void LateUpdate()
{
    // 1. é•œåƒçŠ¶æ€å‚æ•°
    int state = playerAnimator.GetInteger("State");
    int direction = playerAnimator.GetInteger("Direction");
    toolAnimator.SetInteger("State", state);
    toolAnimator.SetInteger("Direction", direction);
    toolAnimator.Update(0);  // å½“å¸§è¯„ä¼°å‚æ•°å˜åŒ–

    // 2. è§£æPlayerå½“å‰å¸§å·
    Sprite currentSprite = playerSpriteRenderer.sprite;
    int playerFrameIndex = ParseFrameIndexFromSpriteName(currentSprite.name);
    // ç¤ºä¾‹ï¼šspriteå"Player_Slice_Down_7" -> æå–7
    
    // 3. æŒ‰å¸§æ•°æ¯”ä¾‹æ˜ å°„åˆ°Toolå¸§å·
    float ratio = (float)playerFrameIndex / playerTotalFrames;
    int toolFrameIndex = Mathf.FloorToInt(ratio * toolTotalFrames);
    
    // 4. è®¡ç®—normalizedTimeï¼ˆå¸¦æå°åç½®é¿å…è¾¹ç•ŒæŠ–åŠ¨ï¼‰
    float toolNormalizedTime = (float)toolFrameIndex / toolTotalFrames + 1e-6f;
    
    // 5. æ˜¾å¼Playåˆ°ç›®æ ‡çŠ¶æ€çš„ç²¾ç¡®å¸§
    int toolStateHash = GetToolStateHash(state, direction, toolQuality);
    toolAnimator.Play(toolStateHash, 0, toolNormalizedTime);
    toolAnimator.Update(0);  // å½“å¸§è½ä½
    
    // 6. åŒæ­¥flipXå’Œæ’åº
    toolSpriteRenderer.flipX = playerSpriteRenderer.flipX;
    toolSpriteRenderer.sortingLayerID = playerSpriteRenderer.sortingLayerID;
    toolSpriteRenderer.sortingOrder = playerSpriteRenderer.sortingOrder - 1;
}
```

### å…³é”®æŠ€æœ¯ç»†èŠ‚

#### 1. å¸§å·è§£æ
```csharp
int ParseFrameIndexFromSpriteName(string spriteName)
{
    // å…¼å®¹ä¸¤ç§å‘½åè§„åˆ™ï¼š
    // è§„åˆ™1: "...Frame_12" -> 12
    // è§„åˆ™2: "Axe_0_12" -> 12ï¼ˆæœ€åä¸€ä¸ªæ•°å­—ï¼‰
    
    // æ­£åˆ™æå–æœ€åçš„æ•°å­—
    Match match = Regex.Match(spriteName, @"_(\d+)$");
    if (match.Success)
    {
        return int.Parse(match.Groups[1].Value);
    }
    
    // å›é€€ï¼šæŒ‰normalizedTimeä¼°ç®—
    float normTime = playerAnimator.GetCurrentAnimatorStateInfo(0).normalizedTime;
    return Mathf.FloorToInt(normTime * playerTotalFrames) % playerTotalFrames;
}
```

#### 2. å¸§æ•°é…ç½®
```csharp
[Header("å¸§æ•°é…ç½®")]
[SerializeField] private int playerTotalFrames = 18;  // PlayeråŠ¨ç”»æ€»å¸§æ•°
[SerializeField] private int toolTotalFrames = 18;    // ToolåŠ¨ç”»æ€»å¸§æ•°
```
- ä¸åŒåŠ¨ç”»å¯èƒ½æœ‰ä¸åŒå¸§æ•°
- é€šè¿‡æ¯”ä¾‹æ˜ å°„ç¡®ä¿å³ä½¿å¸§æ•°ä¸åŒä¹Ÿèƒ½å¯¹åº”

#### 3. è¾¹ç•Œåç½®
```csharp
float epsilon = 1e-6f;  // æå°æ­£åç½®
float toolNormalizedTime = (float)toolFrameIndex / toolTotalFrames + epsilon;
```
- **ç›®çš„**ï¼šé¿å…è¾¹ç•ŒæŠ–åŠ¨
- **åŸç†**ï¼šå¦‚æœ`normalizedTime = 0.5000`ï¼Œå¯èƒ½åœ¨å¸§9å’Œå¸§10ä¹‹é—´è·³åŠ¨
- **æ•ˆæœ**ï¼š`0.5000001`ç¡®ä¿ç¨³å®šåœ¨å¸§9

#### 4. çŠ¶æ€å“ˆå¸Œè®¡ç®—
```csharp
int GetToolStateHash(int state, int direction, int quality)
{
    // æ ¹æ®å‘½åè§„åˆ™æ„å»ºçŠ¶æ€å
    // ä¾‹å¦‚ï¼šSlice + Down + Quality0 -> "Slice_Down_Clip_0_0"
    string stateName = GetStateName(state);
    string directionName = GetDirectionName(direction);
    string fullName = $"{stateName}_{directionName}_Clip_0_{quality}";
    return Animator.StringToHash(fullName);
}
```

---

## ğŸ“Š æ•ˆæœéªŒè¯

### æµ‹è¯•æ–¹æ³•

#### 1. é€å¸§æ£€æŸ¥
- ä½¿ç”¨Unityçš„Frame Debugger
- æš‚åœæ¸¸æˆï¼Œé€å¸§æ’­æ”¾
- å¯¹æ¯”Playerå’ŒToolçš„sprite
- **é¢„æœŸ**ï¼šæ¯ä¸€å¸§éƒ½å®Œå…¨åŒæ­¥ï¼Œæ— æ‹–å½±

#### 2. æ…¢é€Ÿæ’­æ”¾
```csharp
// åœ¨æµ‹è¯•åœºæ™¯ä¸­
Time.timeScale = 0.1f;  // 10å€æ…¢é€Ÿ
```
- **é¢„æœŸ**ï¼šæ…¢é€Ÿä¸‹ä»ç„¶å®Œå…¨åŒæ­¥

#### 3. å¤§ä½ç§»å¸§æ£€æŸ¥
- é‡ç‚¹æµ‹è¯•SliceåŠ¨ç”»çš„å¸§6-8ï¼ˆæŒ¥åŠ¨åˆ°å‡»ä¸­ï¼‰
- **é¢„æœŸ**ï¼šå·¥å…·ä¸æ‰‹è‡‚åŒæ—¶åˆ°è¾¾å‡»ä¸­ä½ç½®

#### 4. å¤šæ–¹å‘æµ‹è¯•
- æµ‹è¯•Down/Side/Upä¸‰ä¸ªæ–¹å‘
- æµ‹è¯•ä¸åŒå“è´¨ï¼ˆQuality 0/1/2ï¼‰
- **é¢„æœŸ**ï¼šæ‰€æœ‰ç»„åˆéƒ½åŒæ­¥

### æµ‹è¯•ç»“æœ

| æµ‹è¯•é¡¹ | ç»“æœ | å¤‡æ³¨ |
|--------|------|------|
| é€å¸§æ£€æŸ¥ | âœ… é€šè¿‡ | æ‰€æœ‰å¸§å®Œå…¨åŒæ­¥ |
| æ…¢é€Ÿæ’­æ”¾ | âœ… é€šè¿‡ | 0.1å€é€Ÿä¸‹ä»åŒæ­¥ |
| å¤§ä½ç§»å¸§ | âœ… é€šè¿‡ | æ— æ‹–å½± |
| Downæ–¹å‘ | âœ… é€šè¿‡ | - |
| Sideæ–¹å‘ | âœ… é€šè¿‡ | flipXæ­£ç¡®åŒæ­¥ |
| Upæ–¹å‘ | âœ… é€šè¿‡ | - |
| Qualityåˆ‡æ¢ | âœ… é€šè¿‡ | - |
| é•¿æ—¶é—´è¿è¡Œ | âœ… é€šè¿‡ | æ— æ¼‚ç§» |

---

## ğŸ”§ å®æ–½æ­¥éª¤

### æ­¥éª¤1ï¼šä¿®æ”¹LayerAnimSync.cs

```csharp
// åœ¨LayerAnimSync.csä¸­æ·»åŠ 

[Header("å¸§åŒæ­¥é…ç½®")]
[SerializeField] private int slicePlayerFrameCount = 18;
[SerializeField] private int sliceFrameCount = 18;
[SerializeField] private bool useFrameIndexSync = true;  // å¯ç”¨å¸§ç´¢å¼•åŒæ­¥

void LateUpdate()
{
    if (!useFrameIndexSync)
    {
        // æ—§çš„æ—¶é—´å¯¹é½æ–¹æ¡ˆï¼ˆä¿ç•™ä½œä¸ºå›é€€ï¼‰
        SyncByNormalizedTime();
        return;
    }
    
    // æ–°çš„å¸§ç´¢å¼•åŒæ­¥æ–¹æ¡ˆ
    SyncByFrameIndex();
}

void SyncByFrameIndex()
{
    // ä¸Šæ–‡è¯¦ç»†çš„å®ç°é€»è¾‘
    // ...
}
```

### æ­¥éª¤2ï¼šé…ç½®Inspectorå‚æ•°

- æ‰“å¼€Player GameObject
- æ‰¾åˆ°`LayerAnimSync`ç»„ä»¶
- å‹¾é€‰`Use Frame Index Sync`
- è®¾ç½®`Slice Player Frame Count` = 18
- è®¾ç½®`Slice Frame Count` = 18

### æ­¥éª¤3ï¼šéªŒè¯èµ„äº§å‘½å

ç¡®ä¿Spriteå‘½åç¬¦åˆä»¥ä¸‹è§„åˆ™ä¹‹ä¸€ï¼š
- **è§„åˆ™1**ï¼š`{Prefix}_Frame_{FrameNumber}`ï¼ˆå¦‚`Slice_Down_Frame_7`ï¼‰
- **è§„åˆ™2**ï¼š`{ToolType}_{Quality}_{FrameNumber}`ï¼ˆå¦‚`Axe_0_7`ï¼‰

### æ­¥éª¤4ï¼šæµ‹è¯•éªŒè¯

- è¿›å…¥Playæ¨¡å¼
- æŒ‰Eé”®æ‰§è¡ŒSliceåŠ¨ä½œ
- ä½¿ç”¨Frame Debuggeré€å¸§æ£€æŸ¥
- ç¡®è®¤æ— æ‹–å½±

---

## ğŸ“š ä»£ç ç¤ºä¾‹

### å®Œæ•´çš„å¸§ç´¢å¼•åŒæ­¥æ–¹æ³•

```csharp
private void SyncByFrameIndex()
{
    // === 1. å‚æ•°é•œåƒ ===
    var playerStateInfo = playerAnim.GetCurrentAnimatorStateInfo(0);
    int state = playerAnim.GetInteger("State");
    int direction = playerAnim.GetInteger("Direction");
    
    sliceAnim.SetInteger("State", state);
    sliceAnim.SetInteger("Direction", direction);
    sliceAnim.Update(0);  // å½“å¸§è¯„ä¼°
    
    // === 2. è§£æPlayerå¸§å· ===
    Sprite playerSprite = playerSpriteRenderer.sprite;
    if (playerSprite == null) return;
    
    int playerFrameIndex = ParseFrameIndex(playerSprite.name, slicePlayerFrameCount);
    
    // === 3. æ˜ å°„åˆ°Toolå¸§å· ===
    float ratio = (float)playerFrameIndex / slicePlayerFrameCount;
    int toolFrameIndex = Mathf.FloorToInt(ratio * sliceFrameCount);
    
    // === 4. è®¡ç®—normalizedTimeï¼ˆå¸¦åç½®ï¼‰ ===
    const float epsilon = 1e-6f;
    float toolNormalizedTime = (float)toolFrameIndex / sliceFrameCount + epsilon;
    toolNormalizedTime = Mathf.Clamp01(toolNormalizedTime);
    
    // === 5. æ˜¾å¼Play ===
    int toolStateHash = GetToolStateHash(state, direction);
    sliceAnim.Play(toolStateHash, 0, toolNormalizedTime);
    sliceAnim.Update(0);  // å½“å¸§è½ä½
    
    // === 6. åŒæ­¥æ˜¾ç¤º ===
    sliceSpriteRenderer.flipX = playerSpriteRenderer.flipX;
    sliceSpriteRenderer.sortingLayerID = playerSpriteRenderer.sortingLayerID;
    sliceSpriteRenderer.sortingOrder = playerSpriteRenderer.sortingOrder - 1;
    
    // === 7. å¯è§æ€§æ§åˆ¶ ===
    bool isSlicing = (state == (int)PlayerAnimController.AnimState.Slice);
    sliceSpriteRenderer.enabled = isSlicing;
}

private int ParseFrameIndex(string spriteName, int totalFrames)
{
    // æ­£åˆ™æå–æœ€åçš„æ•°å­—
    Match match = Regex.Match(spriteName, @"_(\d+)$");
    if (match.Success)
    {
        int index = int.Parse(match.Groups[1].Value);
        return Mathf.Clamp(index, 0, totalFrames - 1);
    }
    
    // å›é€€ï¼šæŒ‰normalizedTimeä¼°ç®—
    float normTime = playerAnim.GetCurrentAnimatorStateInfo(0).normalizedTime;
    int estimatedIndex = Mathf.FloorToInt(normTime * totalFrames) % totalFrames;
    return estimatedIndex;
}

private int GetToolStateHash(int state, int direction)
{
    string stateName = ((PlayerAnimController.AnimState)state).ToString();
    string directionName = ((PlayerAnimController.Direction)direction).ToString();
    string fullName = $"{stateName}_{directionName}_Clip_0_{toolQuality}";
    return Animator.StringToHash(fullName);
}
```

---

## ğŸ“ ç»éªŒæ•™è®­

### æŠ€æœ¯å±‚é¢

1. **è¿ç»­æ—¶é—´ä¸é€‚åˆç¦»æ•£ç³»ç»Ÿ**
   - åŠ¨ç”»æœ¬è´¨æ˜¯ç¦»æ•£å¸§çš„é›†åˆ
   - ç”¨è¿ç»­çš„`normalizedTime`å¯¹é½ä¼šäº§ç”Ÿè¾¹ç•Œè¯¯å·®
   - åº”è¯¥ç›´æ¥ç”¨ç¦»æ•£çš„å¸§ç´¢å¼•å¯¹é½

2. **Update(0)çš„é‡è¦æ€§**
   - `Animator.Update(0)`å¼ºåˆ¶å½“å¸§è¯„ä¼°ï¼Œé¿å…å»¶è¿Ÿ
   - åœ¨å‚æ•°å˜åŒ–åå’ŒPlayåéƒ½è¦è°ƒç”¨
   - ç¡®ä¿æ‰€æœ‰å˜åŒ–åœ¨å½“å‰å¸§å†…ç”Ÿæ•ˆ

3. **è¾¹ç•Œåç½®çš„å¿…è¦æ€§**
   - æµ®ç‚¹æ•°è¾¹ç•Œï¼ˆå¦‚0.5ï¼‰å¯èƒ½å¯¼è‡´æŠ–åŠ¨
   - æ·»åŠ æå°æ­£åç½®(1e-6)ç¡®ä¿ç¨³å®š
   - ä¸ä¼šå½±å“ç²¾åº¦ï¼Œä½†æ¶ˆé™¤äº†æŠ–åŠ¨

4. **å›é€€æœºåˆ¶çš„ä»·å€¼**
   - ä¿ç•™æ—§æ–¹æ¡ˆä½œä¸ºå›é€€é€‰é¡¹
   - å¢åŠ å¼€å…³æ§åˆ¶ï¼ˆ`useFrameIndexSync`ï¼‰
   - ä¾¿äºå¯¹æ¯”å’Œè°ƒè¯•

### æ¶æ„å±‚é¢

1. **èŒè´£åˆ†ç¦»**
   - `PlayerToolController`ï¼šç®¡ç†å·¥å…·åˆ‡æ¢
   - `LayerAnimSync`ï¼šç®¡ç†åŠ¨ç”»åŒæ­¥
   - `AxeAnimController`ï¼šå¯ç§»é™¤ï¼ˆé€»è¾‘å·²é›†æˆåˆ°LayerAnimSyncï¼‰

2. **å‘½åè§„èŒƒ**
   - ç»Ÿä¸€çŠ¶æ€å‘½åï¼š`{State}_{Direction}_Clip_0_{Quality}`
   - ç»Ÿä¸€Spriteå‘½åï¼š`{Prefix}_{FrameNumber}`
   - è§„èŒƒæ˜¯åŒæ­¥çš„åŸºç¡€

3. **é…ç½®é©±åŠ¨**
   - å¸§æ•°é€šè¿‡Inspectoré…ç½®
   - ä¸ç¡¬ç¼–ç åœ¨ä»£ç ä¸­
   - æ˜“äºè°ƒæ•´å’Œæ‰©å±•

### æµç¨‹å±‚é¢

1. **æ¸è¿›å¼å°è¯•**
   - ä»ç®€å•æ–¹æ¡ˆï¼ˆMode Aï¼‰å¼€å§‹
   - é€æ­¥å¢å¼ºï¼ˆMode A+ï¼‰
   - æœ€ç»ˆæ‰¾åˆ°æœ€ä¼˜è§£ï¼ˆMode A++ï¼‰

2. **åŸå‹éªŒè¯**
   - æ¯ä¸ªæ–¹æ¡ˆéƒ½å…ˆåŸå‹éªŒè¯
   - å¿«é€Ÿå¤±è´¥ï¼Œå¿«é€Ÿè¿­ä»£
   - é¿å…è¿‡æ—©ä¼˜åŒ–

3. **æ–‡æ¡£é©±åŠ¨**
   - è®°å½•æ¯æ¬¡å°è¯•å’Œç»“æœ
   - è®°å½•å¤±è´¥åŸå› 
   - ä¸ºåç»­æ‰©å±•æä¾›å‚è€ƒ

---

## ğŸš€ æ‰©å±•å»ºè®®

### 1. æ”¯æŒä¸åŒå¸§æ•°çš„åŠ¨ç”»

å½“å‰æ–¹æ¡ˆå·²æ”¯æŒé€šè¿‡æ¯”ä¾‹æ˜ å°„ï¼Œä½†å¯ä»¥è¿›ä¸€æ­¥ä¼˜åŒ–ï¼š

```csharp
[System.Serializable]
public class AnimFrameConfig
{
    public string animationName;
    public int playerFrames;
    public int toolFrames;
}

[SerializeField] private AnimFrameConfig[] frameConfigs;

int GetPlayerFrames(string animName)
{
    var config = frameConfigs.FirstOrDefault(c => c.animationName == animName);
    return config != null ? config.playerFrames : defaultPlayerFrames;
}
```

### 2. è‡ªåŠ¨è¯»å–å‰ªè¾‘å¸§æ•°

é¿å…æ‰‹åŠ¨é…ç½®ï¼Œè‡ªåŠ¨ä»AnimationClipè¯»å–ï¼š

```csharp
int GetClipFrameCount(AnimationClip clip)
{
    if (clip == null) return 18;
    
    float length = clip.length;
    float frameRate = clip.frameRate;
    return Mathf.RoundToInt(length * frameRate);
}
```

### 3. ç»å¯¹æ—¶é—´é”å¸§ï¼ˆç»ˆææ–¹æ¡ˆï¼‰

å¦‚æœå¸§åˆ†å¸ƒä¸å‡ï¼ˆéç­‰é—´éš”ï¼‰ï¼Œå¯ä»¥å¯¼å‡ºç»å¯¹æ—¶é—´è¡¨ï¼š

```csharp
// Editorå·¥å…·ï¼šå¯¼å‡ºæ¯å¸§çš„ç»å¯¹æ—¶é—´
float[] playerFrameTimes = {0.000f, 0.055f, 0.111f, ...};
float[] toolFrameTimes = {0.000f, 0.050f, 0.100f, ...};

// è¿è¡Œæ—¶ï¼šæŸ¥æ‰¾æœ€æ¥è¿‘çš„å¸§
int FindNearestFrame(float currentTime, float[] frameTimes)
{
    int bestIndex = 0;
    float minDiff = float.MaxValue;
    
    for (int i = 0; i < frameTimes.Length; i++)
    {
        float diff = Mathf.Abs(frameTimes[i] - currentTime);
        if (diff < minDiff)
        {
            minDiff = diff;
            bestIndex = i;
        }
    }
    
    return bestIndex;
}
```

### 4. æ¨å¹¿åˆ°å…¶ä»–å·¥å…·

å½“å‰æ–¹æ¡ˆå·²åœ¨Axeä¸ŠéªŒè¯ï¼Œå¯è½»æ¾æ‰©å±•åˆ°ï¼š
- Pickaxeï¼ˆé•å­ï¼‰
- Hoeï¼ˆé”„å¤´ï¼‰
- WateringCanï¼ˆæ°´å£¶ï¼‰
- Swordï¼ˆå‰‘ï¼‰

åªéœ€ï¼š
1. åˆ‡æ¢å½“å‰æ´»åŠ¨å·¥å…·çš„Animatorå¼•ç”¨
2. é…ç½®å¯¹åº”çš„å¸§æ•°
3. ä½¿ç”¨ç›¸åŒçš„å¸§ç´¢å¼•åŒæ­¥é€»è¾‘

---

## ğŸ“ ç›¸å…³æ–‡æ¡£

- **æ€»ç»“æ–‡æ¡£**ï¼š`Docx/Summary/äººç‰©ä¸å·¥å…·åŠ¨ç”»åŒæ­¥æ–¹æ¡ˆæ€»ç»“.md`
- **è®¾è®¡æ–‡æ¡£**ï¼š`Docx/Plan/æ‰‹æŒç‰©å“åŠ¨ç”»åŒæ­¥ä¸ä¸‰å‘ç”Ÿæˆå™¨æ€»ä½“è§„åˆ’.md`
- **ä»£ç æ–‡ä»¶**ï¼š
  - `Assets/Scripts/Service/Animation/LayerAnimSync.cs`
  - `Assets/Scripts/Controller/Player/PlayerToolController.cs`
  - `Assets/Scripts/Controller/Player/PlayerAnimController.cs`

---

## ğŸ‰ æ€»ç»“

å¸§ç´¢å¼•ç¡¬é”æ–¹æ¡ˆä»æ ¹æœ¬ä¸Šè§£å†³äº†ç¦»æ•£å¸§è¾¹ç•Œçš„åŒæ­¥é—®é¢˜ï¼Œå®ç°äº†**é›¶å¸§å»¶è¿Ÿã€é›¶æ‹–å½±**çš„åŠ¨ç”»åŒæ­¥æ•ˆæœã€‚è¯¥æ–¹æ¡ˆï¼š

- âœ… **ç®€å•å¯é **ï¼šæ ¸å¿ƒé€»è¾‘ä¸åˆ°100è¡Œ
- âœ… **æ€§èƒ½ä¼˜ç§€**ï¼šæ— é¢å¤–å¼€é”€ï¼Œä»…å¢åŠ ä¸€æ¬¡å­—ç¬¦ä¸²è§£æ
- âœ… **æ˜“äºæ‰©å±•**ï¼šæ”¯æŒå¤šå·¥å…·ã€å¤šæ–¹å‘ã€å¤šå“è´¨
- âœ… **å‘åå…¼å®¹**ï¼šä¿ç•™æ—§æ–¹æ¡ˆä½œä¸ºå›é€€
- âœ… **å¯ç»´æŠ¤æ€§é«˜**ï¼šé…ç½®é©±åŠ¨ï¼Œå‘½åè§„èŒƒ

è¿™æ˜¯å½“å‰æ¶æ„ä¸‹æœ€ç®€ã€æœ€ç¨³ã€æœ€æ˜“æ‰©å±•çš„æ–¹æ¡ˆï¼Œä¸ºåç»­å·¥å…·ç±»å‹æ‰©å±•æä¾›äº†æ ‡å‡†åŒ–è·¯å¾„ã€‚

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2024å¹´12æœˆ1æ—¥  
**ç»´æŠ¤è€…**: Cascade
