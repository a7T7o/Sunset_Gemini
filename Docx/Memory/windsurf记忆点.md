# Windsurf è®°å¿†ç‚¹

## ç›®å½•
- [æ ¸å¿ƒäº¤äº’åŸåˆ™](#æ ¸å¿ƒäº¤äº’åŸåˆ™)
- [Unity é¡¹ç›® "Sunset" é®æŒ¡é€æ˜ç³»ç»Ÿ](#unity-é¡¹ç›®-sunset-é®æŒ¡é€æ˜ç³»ç»Ÿ)
- [Unity 2D é¡¹ç›® "Sunset" äº¤æ¥è¦ç‚¹](#unity-2d-é¡¹ç›®-sunset-äº¤æ¥è¦ç‚¹)
- [é¢æ¿å¼€å…³é€»è¾‘](#é¢æ¿å¼€å…³é€»è¾‘)
- [ç‰©å“è®¾è®¡äº¤æ¥](#ç‰©å“è®¾è®¡äº¤æ¥)
- [Order è®¡ç®—ä¸è‡ªåŠ¨æ ¡å‡†ç³»ç»Ÿ](#order-è®¡ç®—ä¸è‡ªåŠ¨æ ¡å‡†ç³»ç»Ÿ)
- [æ··åˆå¯¼èˆªç³»ç»Ÿ](#æ··åˆå¯¼èˆªç³»ç»Ÿ)
- [äº‘æœµä¸å¤©æ°”ç³»ç»Ÿ](#äº‘æœµä¸å¤©æ°”ç³»ç»Ÿ)
- [æ‰‹æŒç‰©å“åŠ¨ç”»ç³»ç»Ÿ](#æ‰‹æŒç‰©å“åŠ¨ç”»ç³»ç»Ÿ)
- [ç»å¯¹ç¦æ­¢äº‹é¡¹](#ç»å¯¹ç¦æ­¢äº‹é¡¹)

## æ ¸å¿ƒäº¤äº’åŸåˆ™

**Tag/Layer é€‰æ‹©å™¨è§„èŒƒ**ï¼š

- ä½¿ç”¨ ReorderableList + Tag Popup ä¸‹æ‹‰æ¡†ï¼ˆUnity æ ‡å‡†ï¼‰
- ç¦æ­¢æ‰‹åŠ¨è¾“å…¥å­—ç¬¦ä¸²æ•°ç»„æˆ–ä½¿ç”¨å‹¾é€‰æ¡†åˆ—è¡¨
- ä½¿ç”¨ `InternalEditorUtility.tags` è·å–æ‰€æœ‰ Tags
- ä½¿ç”¨ `ReorderableList` å®ç°å¯æ’åºåˆ—è¡¨
- ä½¿ç”¨ `EditorGUI.Popup` å®ç°ä¸‹æ‹‰é€‰æ‹©

## Unity é¡¹ç›® "Sunset" é®æŒ¡é€æ˜ç³»ç»Ÿ

### æ ¸å¿ƒé€»è¾‘
- ç©å®¶åœ¨æ ‘ä¸‹æ–¹ï¼ˆY > TreeYï¼‰+ Sprite Bounds é‡å  â†’ æ ‘é€æ˜

### æ£€æµ‹æ–¹æ¡ˆ
- ä½¿ç”¨ `Bounds.Intersects` è¿›è¡Œç²¾ç¡®æ£€æµ‹
- åŒå±‚ç»“æ„ Order è®¡ç®—
- è‡ªåŠ¨æ ¡å‡†ç³»ç»Ÿï¼ˆ`StaticObjectOrderAutoCalibrator`ï¼‰

### æ€§èƒ½ä¼˜åŒ–
- ä½¿ç”¨ `Bounds.Intersects` æ›¿ä»£ `OverlapPoint`ï¼Œæ€§èƒ½æå‡ 20 å€
- è·ç¦»è¿‡æ»¤ä¼˜åŒ–
- æ ‡ç­¾è¿‡æ»¤

## Unity 2D é¡¹ç›® "Sunset" äº¤æ¥è¦ç‚¹

### ç›®æ ‡
- ç©å®¶ä¸å·¥å…·ï¼ˆæ–§å¤´ï¼‰åŠ¨ç”»å®Œç¾åŒæ­¥
- æ–§å¤´æ¸²æŸ“åœ¨ç©å®¶ä¸‹æ–¹
- ç²¾ç¡®çš„æ¯å¸§ Sprite Pivot è®¾ç½®
- åŠ¨ç”»å‰ªè¾‘æ—¶é•¿/å¸§åˆ†å¸ƒæ­£ç¡®
- ä¿®å¤ Editor Graphs é”™è¯¯

### é«˜ä¼˜å…ˆçº§é—®é¢˜
1. `NullReferenceException: UnityEditor.Graphs.Edge.WakeUp()` æŒç»­å‡ºç°
2. æ–§å¤´åŠ¨ç”»ä¸åŒæ­¥ï¼ˆç–‘ä¼¼å¼•ç”¨ä¸¢å¤±/å»¶è¿Ÿåˆå§‹åŒ–å†²çªï¼‰
3. æ–§å¤´æ¸²æŸ“å±‚çº§é”™è¯¯ï¼ˆå½“å‰ +1ï¼Œåº”ä¸º -1ï¼‰

### å…³é”®æ–‡ä»¶
- `LayerAnimSync.cs`
- `PlayerAnimController.cs`
- `AxeAnimController.cs`
- `AnimatorExtensions.cs`
- `Editor/SlicePivotCopyTool.cs`
- `Editor/LayerAnimSetupTool.cs`

## é¢æ¿å¼€å…³é€»è¾‘

### å¿«æ·é”®
- `J` é”®ï¼šä¿ç•™ç»™ä»»åŠ¡é¢æ¿ï¼ˆå½“å‰æ— åŠŸèƒ½ï¼‰
- `Tab`/`B`/`M`/`L`/`O`ï¼šæ‰“å¼€å¯¹åº”é¡µé¢ï¼›å·²æ‰“å¼€æ—¶å†æŒ‰åŒé”®å…³é—­ä¸»é¢æ¿
- `ESC`ï¼š
  - å·²æ‰“å¼€ä»»æ„é¢æ¿æ—¶ â†’ æ‰“å¼€è®¾ç½®é¡µ
  - æ²¡æ‰“å¼€æ—¶ â†’ æ‰“å¼€è®¾ç½®é¢æ¿
- é¼ æ ‡ç‚¹å‡» Top çš„ Toggle = æŒ‰å¿«æ·é”®
- åŒå‡»æŒ‰é’®é€€å‡ºç•Œé¢

### åˆå§‹çŠ¶æ€
- æ¸¸æˆå¼€å§‹æ—¶ï¼šUI æ ¹ç‰©ä½“ï¼ˆåä¸º"UI"ï¼‰å¯ç”¨/æ¿€æ´»
- `PackagePanel`ï¼šé»˜è®¤ä¸æ¿€æ´»ï¼Œè¿è¡Œæ—¶æŒ‰é”®æ‰æ¿€æ´»
- å±‚çº§ï¼š`UI > PackagePanel > Main > [0_Props, 1_Recipes, 2_Ex, 3_Map, 4_Relationship_NPC, 5_Settings] + Top`

## ç‰©å“è®¾è®¡äº¤æ¥

### æ‰¹é‡åˆ›å»ºå·¥å…·
- `ItemSOBatchCreator`ï¼šæ‰¹é‡åˆ›å»ºå·¥å…·
- æ”¯æŒå¤š Sprite é‡æ’ã€å¹¶è¡Œ ID/åç§°è¾“å…¥ã€é¦– ID è‡ªå¢ã€ç±»å‹ä¸“å±å­—æ®µã€è§„èŒƒå‘½åä¸ä¿å­˜è·¯å¾„
- èœå•ï¼š`Farm â†’ Items â†’ æ‰¹é‡åˆ›å»ºç‰©å“æ•°æ® (SO)`

### åŠ¨ç”» ID æ˜ å°„
- `ToolData/WeaponData` æ–°å¢ï¼š
  - `useQualityIdMapping`
  - `animationDefaultId`
  - `GetAnimationKeyId()`
- `PlayerToolController` è®¾ç½® `ToolItemId` æ”¹ä¸ºä½¿ç”¨ `GetAnimationKeyId()`
- ä¸ `LayerAnimSync` çš„å“è´¨å›é€€å…¼å®¹

## Order è®¡ç®—ä¸è‡ªåŠ¨æ ¡å‡†ç³»ç»Ÿ

### æ ¸å¿ƒåŸåˆ™
1. æ ‘æœ¨/æˆ¿å±‹ç­‰é™æ€ç‰©ä½“ä¸ä½¿ç”¨ `DynamicSortingOrder`
2. ä½¿ç”¨ `Tool_002_BatchHierarchy` å·¥å…·æ‰‹åŠ¨è°ƒæ•´ Orderï¼ˆç¼–è¾‘æ—¶ï¼‰
3. è¿è¡Œå‰è‡ªåŠ¨æ ¡å‡†æ‰€æœ‰é™æ€ç‰©ä½“ Orderï¼ˆ`StaticObjectOrderAutoCalibrator`ï¼‰

### ç»Ÿä¸€æ ‡å‡†
```
ä¼˜å…ˆçº§ï¼š
1. Collider2D.bounds.min.y + bottomOffset
2. Sprite.bounds.min.y + bottomOffset  
3. Transform.position.y + bottomOffset

Order è®¡ç®—ï¼š
Order = -Round(sortingY Ã— 100) + 0

é»˜è®¤å‚æ•°ï¼š
multiplier = 100
offset = 0
bottomOffset = 0
```

### è‡ªåŠ¨æ ¡å‡†ç³»ç»Ÿ
- æ–‡ä»¶ï¼š`StaticObjectOrderAutoCalibrator.cs`
- è§¦å‘æ—¶æœºï¼šè¿›å…¥ Play æ¨¡å¼å‰è‡ªåŠ¨æ‰§è¡Œ
- æ‰‹åŠ¨è§¦å‘ï¼š`Tools â†’ ğŸ”§ æ ¡å‡†æ‰€æœ‰é™æ€ç‰©ä½“Order`
- è·³è¿‡ï¼šæœ‰ `DynamicSortingOrder` çš„ç‰©ä½“ï¼ˆåŠ¨æ€è®¡ç®—ï¼‰
- è·³è¿‡ï¼š`Order < -9990` çš„ç‰¹æ®Šæ ‡è®°ç‰©ä½“
- Shadow å¤„ç†ï¼š`Order = çˆ¶Order + (-1)`
- Glow/Light/Effect å¤„ç†ï¼š`Order = çˆ¶Order + 0`

## æ··åˆå¯¼èˆªç³»ç»Ÿ

### æ ¸å¿ƒç‰¹æ€§
1. åŒæ¨¡å¼å¯¼èˆªï¼š
   - Grid æ¨¡å¼ï¼ˆç½‘æ ¼å¯»è·¯ï¼‰
   - Continuous æ¨¡å¼ï¼ˆè¿ç»­ç©ºé—´åŠ¿åœºå¯¼èˆªï¼‰
2. è‡ªåŠ¨æ¨¡å¼åˆ‡æ¢ï¼šæ ¹æ®å‘¨å›´éšœç¢ç‰©å¯†åº¦ï¼ˆ`complexAreaThreshold`ï¼‰åŠ¨æ€åˆ‡æ¢
3. åŠ¿åœºæ³•å¯¼èˆªï¼šç›®æ ‡å¸å¼•åŠ› + éšœç¢ç‰©æ’æ–¥åŠ›ï¼Œå¤„ç†æé™ç‹­çª„é€šé“
4. `CircleCast` ç²¾ç¡®ç¢°æ’æ£€æµ‹ï¼šå¯ä»¥æ£€æµ‹çº¢è‰²æ ¼å­å†…çš„ç©ºéš™å’Œç»¿è‰²æ ¼å­è¾¹ç¼˜çš„éšœç¢ç‰©
5. åŠ¨æ€è·¯å¾„æ¢ç´¢ï¼šå°è¯• Â±15Â°-Â±75Â° å¤šä¸ªè§’åº¦æ‰¾åˆ°å¯é€šè¿‡è·¯å¾„

### æ–‡ä»¶æ¸…å•
- `PlayerAutoNavigator.cs`ï¼šæ·»åŠ æ··åˆå¯¼èˆªåŠŸèƒ½ï¼ˆé»˜è®¤å…³é—­ï¼Œå®Œå…¨å‘åå…¼å®¹ï¼‰
- `INavigationUnit.cs`ï¼šNPC/æ€ªç‰©å¯¼èˆªæ¥å£
- `æ··åˆå¯¼èˆªç³»ç»Ÿä½¿ç”¨æŒ‡å—.md`ï¼šå®Œæ•´æ–‡æ¡£

### é…ç½®å‚æ•°
- `enableHybridNavigation`ï¼ˆé»˜è®¤ falseï¼‰ï¼šå¯ç”¨å¼€å…³
- `complexAreaThreshold`ï¼ˆé»˜è®¤ 3ï¼‰ï¼šå¤æ‚åŒºåŸŸé˜ˆå€¼
- `continuousNavRadius`ï¼ˆé»˜è®¤ 3.0ï¼‰ï¼šæ£€æµ‹åŠå¾„
- `obstacleRepulsionStrength`ï¼ˆé»˜è®¤ 2.0ï¼‰ï¼šæ’æ–¥åŠ›å¼ºåº¦

## äº‘æœµä¸å¤©æ°”ç³»ç»Ÿ

### äº‘æœµé˜´å½±å®ç°
- æ–¹æ¡ˆ Aï¼šç²¾çµäº‘å½± + Multiply æè´¨
- `CloudShadowManager` å‚æ•°ï¼š
  - `Intensity`
  - `Density`
  - `ScaleRange`
  - `Speed`
  - `Direction`
  - `Seed`
  - `SortingLayer`
  - `WeatherGate`
- ä¸ `WeatherManager` è”åŠ¨

### é®æŒ¡é€æ˜ç³»ç»Ÿ
- å•ä¸€çœŸç›¸æºäº `OcclusionManager`
- `OcclusionTransparency` ç»„ä»¶æ— å‚æ•°ï¼Œä»… `OnEnable` è¯»å–ä¸€æ¬¡è®¾ç½®
- ä½¿ç”¨ `GameObject.tag` è¿›è¡Œæ ‡ç­¾è¿‡æ»¤
- è®¡åˆ’ï¼šä½¿ç”¨ shader å®ç°éå‡åŒ€é€æ˜å’ŒåŠ¨æ€äº‘é˜´å½±

## æ‰‹æŒç‰©å“åŠ¨ç”»ç³»ç»Ÿ

### ä¸‰å‘åŠ¨ç”»ç”Ÿæˆå™¨
- ä¸­æ–‡ UI
- æ‹–æ”¾æ–‡ä»¶å¤¹æ”¯æŒ
- å•å“è´¨è®¡æ•°
- å¯é€‰çš„ Pivot åº”ç”¨
- å›ºå®š 8 å¸§
- æ—¶é—´è½´æ§åˆ¶ï¼š`totalFrames`/`lastFrame` æ§åˆ¶å…³é”®å¸§åˆ†å¸ƒ
- å‘½åï¼š`{Action}_{Dir}_Clip_{itemId}_{quality}`

### è¾“å‡ºç»“æ„
- Clips: `Assets/Animations/Clips/{Action}/{id}_{itemName}/{Down|Side|Up}/{Action}_{Dir}_Clip_{id}_{quality}.anim`
- Controllers: `Assets/Animations/Controllers/{Action}/{id}_{itemName}/{Action}_Controller_{id}_{itemName}.controller`

### æ§åˆ¶å™¨é…ç½®
- ä»…ä½¿ç”¨ Any State â†’ state è½¬æ¢ï¼ˆæ— çŠ¶æ€é—´è½¬æ¢ï¼‰
- å‚æ•°ï¼š
  - `State`
  - `Direction`
  - `ToolItemId`
  - `ToolQuality`

### è¿è¡Œæ—¶
- `LayerAnimSync` ä½¿ç”¨ `ToolItemId` + å“è´¨å›é€€
- `PlayerToolController` åœ¨è£…å¤‡æ—¶è®¾ç½® `ToolItemId`

### æ”»å‡»å‘½ä¸­æ£€æµ‹
- ç»Ÿä¸€ `ToolEvents.ToolStrike` äº‹ä»¶
- `PlayerToolHitEmitter` è®¡ç®— 60Â° æ‰‡å½¢æ”»å‡»èŒƒå›´ï¼ˆæ¥”å½¢ï¼‰
  - åŠå¾„æ¥è‡ªç¬¬ 4 å¸§çš„æ–§å¤´ Sprite èŒƒå›´ï¼ˆä½¿ç”¨ sprite bounds + pivot + å·¥å…·é™„ç€ç‚¹ï¼‰
  - å¹¿æ’­äº‹ä»¶å¹¶è°ƒç”¨ç›®æ ‡çš„ `IResourceNode` æ¥å£
  - å¦‚æœæ²¡æœ‰åŠ¨ç”»äº‹ä»¶ï¼Œä½¿ç”¨å¸§çª—å£å›é€€

## ç»å¯¹ç¦æ­¢äº‹é¡¹

1. ä¿®æ”¹ bug æ—¶ï¼šå¿…é¡»ä¿è¯ä¿®æ”¹åå’ŒåŸæœ‰ä¸šåŠ¡é€»è¾‘ä¿æŒä¸€è‡´ï¼Œä¸èƒ½åäº†åŠŸèƒ½
2. ä¿®æ”¹ä¸šåŠ¡é€»è¾‘æ—¶ï¼šå¿…é¡»ç¡®ä¿å’Œç°æœ‰æ¨¡å—ã€å…¶ä»–è„šæœ¬è”åŠ¨å’Œé€‚é…
3. **ä¿®æ”¹ä»»ä½•éƒ¨åˆ†å‰**ï¼šå…ˆè®°ä½è¦åšçš„åˆ°åº•æ˜¯ä»€ä¹ˆï¼Œä»å…¨å±€å¤§ä½“æ¥æ€è€ƒ
4. å¿…é¡»ç»“åˆé¡¹ç›®çš„æ•´ä½“è®¾è®¡ï¼ˆå¤šå±‚çº§+æ ‡ç­¾åˆ†ç±»ã€Sorting Layer ç­‰ï¼‰
5. æµ‹è¯•ç‚¹ï¼šå¦‚æœåŸåŠŸèƒ½æ˜¯"æ»šè½®åˆ‡æ¢æ˜¾ç¤ºçº¢æ¡†"ï¼Œä¿®æ”¹åå¿…é¡»ä»ç„¶æ˜¾ç¤ºçº¢æ¡†
6. ä¸­å¿ƒç‚¹é—®é¢˜ï¼šä½¿ç”¨ Player çš„ Collider ä¸­å¿ƒï¼Œä¸æ˜¯æ‘„åƒæœº/å±å¹•ä¸­å¿ƒ
7. å›¾å±‚é—®é¢˜ï¼šæ ¹æ®ç‚¹å‡»åŒºåŸŸçš„ Sorting Layer åˆ›å»ºç‰©ä½“ï¼Œä¸æ˜¯ Default
8. æ¨¡æ¿å¯¹è±¡ï¼šåˆ›å»ºåœ¨ UI ä¸­å¿ƒï¼ˆåœºæ™¯å¤–ï¼‰ï¼Œä¸æ˜¯ Systems ä¸‹ï¼ˆåœºæ™¯å†…å¯æ‹¾å–ä½ç½®ï¼‰

---

*æœ€åæ›´æ–°ï¼š2025-12-09*
