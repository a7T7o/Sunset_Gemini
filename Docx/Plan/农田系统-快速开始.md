# å†œç”°ç³»ç»Ÿ - å¿«é€Ÿå¼€å§‹æŒ‡å—

**æ–‡æ¡£ç‰ˆæœ¬**: v2.0  
**çŠ¶æ€**: âœ… ç¼–è¯‘é”™è¯¯å·²ä¿®å¤ï¼Œç³»ç»Ÿå·²æ ¹æ®ä½ çš„éœ€æ±‚è°ƒæ•´

---

## âœ… å·²å®Œæˆçš„ä¿®å¤

### 1. ç¼–è¯‘é”™è¯¯ä¿®å¤
- âœ… ä¿®å¤å‘½åç©ºé—´é”™è¯¯ï¼ˆ`FarmGame.Service` â†’ `TimeManager`åœ¨å…¨å±€ç©ºé—´ï¼‰
- âœ… ä¿®å¤`Season`ç±»å‹ï¼ˆä½¿ç”¨`SeasonManager.Season`ï¼‰
- âœ… ä¿®å¤`Quality`ç±»å‹ï¼ˆæ”¹ä¸º`ItemQuality`ï¼‰

### 2. ç³»ç»Ÿé€»è¾‘è°ƒæ•´ï¼ˆæŒ‰ä½ çš„éœ€æ±‚ï¼‰
- âœ… **æµ‡æ°´é€»è¾‘**ï¼šå½“å¤©æµ‡æ°´â†’è®°å½•å‚æ•°â†’ç¬¬äºŒå¤©æ‰ç”Ÿæ•ˆä½œç‰©ç”Ÿé•¿
- âœ… **3ç§åœŸå£¤è§†è§‰çŠ¶æ€**ï¼š
  - å¹²ç‡¥ï¼ˆæœªæµ‡æ°´ï¼‰
  - æ¹¿æ¶¦+æ°´æ¸ï¼ˆæµ‡æ°´å2å°æ—¶å†…ï¼‰
  - æ¹¿æ¶¦æ·±è‰²ï¼ˆæµ‡æ°´2å°æ—¶åï¼‰
- âœ… **ç¬¬äºŒå¤©æ›´æ–°**ï¼šæ‰€æœ‰ä½œç‰©çŠ¶æ€åœ¨ç¬¬äºŒå¤©å¼€å§‹æ—¶æ›´æ–°
- âœ… ç§»é™¤äº†`WaterEvaporationSystem`ï¼ˆæ”¹ä¸ºæ¯å¤©è‡ªåŠ¨å˜å¹²ï¼‰

---

## ğŸ“‹ ä½ ç°åœ¨éœ€è¦åšçš„ï¼ˆæŒ‰é¡ºåºï¼‰

### ç¬¬1æ­¥ï¼šå‡†å¤‡5å¼ Spriteå›¾ç‰‡ï¼ˆ30åˆ†é’Ÿï¼‰

æ ¹æ®ä½ çš„èµ„æºï¼ˆæˆªå›¾ä¸­çš„è€•åœ°spriteå’Œ3ä¸ªæ°´æ¸spriteï¼‰ï¼š

#### éœ€è¦åˆ¶ä½œçš„å›¾ç‰‡ï¼š

1. **Farmland_Dry.png**
   - ä½¿ç”¨ä½ çš„è€•åœ°spriteï¼ˆä¸Šé¢é‚£ä¸ªå¸¦åœ†å½¢è¾¹ç•Œçš„ï¼‰
   - å°ºå¯¸ï¼š32x32 æˆ– 48x48ï¼ˆçœ‹ä½ çš„æ ¼å­å¤§å°ï¼‰

2. **Farmland_Wet_Puddle1.png**
   - å›¾å±‚1ï¼šè€•åœ°sprite
   - å›¾å±‚2ï¼šæ°´æ¸sprite1ï¼ˆè“è‰²é‚£ä¸ªï¼‰
   - åˆå¹¶å¯¼å‡º

3. **Farmland_Wet_Puddle2.png**
   - è€•åœ°sprite + æ°´æ¸sprite2

4. **Farmland_Wet_Puddle3.png**
   - è€•åœ°sprite + æ°´æ¸sprite3

5. **Farmland_Wet_Dark.png**
   - è€•åœ°sprite
   - è°ƒæš—ï¼šåœ¨PSä¸­ Image â†’ Adjustments â†’ Brightness/Contrast
   - Brightness: -20
   - æˆ– HSV ä¸­ Vå€¼ -20%

#### å¿«é€Ÿæ–¹æ³•ï¼ˆå¦‚æœä¸æƒ³ç”¨PSï¼‰ï¼š

**åœ¨Unityä¸­ç›´æ¥ä½¿ç”¨ä½ çš„sprite**ï¼š
- Dry: ä½¿ç”¨åŸå§‹è€•åœ°sprite
- Puddle 1/2/3: ä½¿ç”¨ä½ çš„3ä¸ªæ°´æ¸spriteï¼ˆæˆ‘ä¼šæä¾›è„šæœ¬åŠ¨æ€å åŠ ï¼‰
- Dark: åœ¨Tileçš„Colorå±æ€§ä¸­è®¾ç½®ä¸º`(0.7, 0.5, 0.3, 1)`

---

### ç¬¬2æ­¥ï¼šåœ¨Unityä¸­åˆ›å»ºTileèµ„äº§ï¼ˆ10åˆ†é’Ÿï¼‰

1. **å¯¼å…¥ä½ çš„5å¼ sprite**ï¼ˆå¦‚æœç”¨PSåˆ¶ä½œäº†ï¼‰
   - æ”¾å…¥`Assets/Sprites/Farm/Tiles/`
   - Inspectorè®¾ç½®ï¼š
     - Texture Type: Sprite (2D and UI)
     - Pixels Per Unit: 16ï¼ˆæˆ–ä½ çš„é¡¹ç›®æ ‡å‡†ï¼‰
     - Filter Mode: Point
     - ç‚¹å‡»Apply

2. **åˆ›å»ºTileèµ„äº§**
   - åˆ›å»ºæ–‡ä»¶å¤¹ï¼š`Assets/Tiles/Farm/`
   - å³é”® â†’ Create â†’ 2D â†’ Tiles â†’ Tile
   - åˆ›å»º5ä¸ªTileï¼š
     - `Farmland_Dry`
     - `Farmland_Wet_Puddle1`
     - `Farmland_Wet_Puddle2`
     - `Farmland_Wet_Puddle3`
     - `Farmland_Wet_Dark`
   - åˆ†åˆ«åˆ†é…å¯¹åº”çš„Sprite

---

### ç¬¬3æ­¥ï¼šåœ¨åœºæ™¯ä¸­æ·»åŠ Farmland Tilemapï¼ˆ5åˆ†é’Ÿï¼‰

æ ¹æ®ä½ çš„å±‚çº§ç»“æ„ï¼š

```
LAYER 1
â”œâ”€â”€ Props
â””â”€â”€ Tilemap
    â”œâ”€â”€ Layer 1 - Wall
    â”œâ”€â”€ Layer 1 - Grass
    â”œâ”€â”€ Layer 1 - Base
    â””â”€â”€ Farmland  â† æ·»åŠ è¿™ä¸ª
```

**æ“ä½œ**ï¼š
1. é€‰ä¸­`LAYER 1`ä¸‹çš„`Tilemap`å¯¹è±¡
2. å³é”® â†’ 2D Object â†’ Tilemap â†’ Rectangular
3. é‡å‘½åä¸º`Farmland`
4. è®¾ç½®Tilemap Rendererï¼š
   - Sorting Layer: LAYER 1
   - Order in Layer: 2ï¼ˆæ¯”Baseå’ŒGrassé«˜ï¼‰

---

### ç¬¬4æ­¥ï¼šåˆ›å»ºFarmingSystemå¯¹è±¡ï¼ˆ5åˆ†é’Ÿï¼‰

1. **Hierarchy â†’ Create Empty â†’ å‘½å"FarmingSystem"**

2. **æ·»åŠ ç»„ä»¶**ï¼š
   - `FarmingManager_v2`ï¼ˆæ–°ç‰ˆæœ¬ï¼Œæ”¯æŒ3ç§çŠ¶æ€ï¼‰
   - `CropGrowthSystem`

3. **åœ¨FarmingManager_v2ä¸­è®¾ç½®å¼•ç”¨**ï¼š

```
Tilemapå¼•ç”¨ï¼š
- Farmland Tilemap: æ‹–å…¥ä½ çš„ Farmland
- Ground Tilemap: æ‹–å…¥ Layer 1 - Base

Tileèµ„æºï¼ˆ3ç§çŠ¶æ€ï¼‰ï¼š
- Dry Farmland Tile: Farmland_Dry.asset
- Wet With Puddle Tiles: 
    Element 0: Farmland_Wet_Puddle1
    Element 1: Farmland_Wet_Puddle2
    Element 2: Farmland_Wet_Puddle3
- Wet Dark Tile: Farmland_Wet_Dark.asset

è§†è§‰åˆ‡æ¢è®¾ç½®ï¼š
- Hours Until Puddle Dry: 2

ä½œç‰©è®¾ç½®ï¼š
- Crop Prefab: ï¼ˆç¨åè®¾ç½®ï¼‰
- Crops Container: ï¼ˆç•™ç©ºï¼‰

ç²¾åŠ›æ¶ˆè€—ï¼š
- Tilling Stamina Cost: 3
- Watering Stamina Cost: 2
```

---

### ç¬¬5æ­¥ï¼šå¿«é€Ÿæµ‹è¯•ï¼ˆ10åˆ†é’Ÿï¼‰

#### åˆ›å»ºæµ‹è¯•è„šæœ¬ï¼š

æ–‡ä»¶ï¼š`Assets/Scripts/Test/FarmingTestInput.cs`

```csharp
using UnityEngine;
using FarmGame.Farm;
using FarmGame.Data;

public class FarmingTestInput : MonoBehaviour
{
    public SeedData testSeed;
    
    void Update()
    {
        Vector3 mousePos = Camera.main.ScreenToWorldPoint(Input.mousePosition);
        
        // Té”® - é”„åœ°
        if (Input.GetKeyDown(KeyCode.T))
        {
            FarmingManager_v2.Instance?.TillSoil(mousePos);
        }
        
        // Yé”® - ç§æ¤
        if (Input.GetKeyDown(KeyCode.Y) && testSeed != null)
        {
            FarmingManager_v2.Instance?.PlantSeed(mousePos, testSeed);
        }
        
        // Ué”® - æµ‡æ°´
        if (Input.GetKeyDown(KeyCode.U))
        {
            FarmingManager_v2.Instance?.WaterTile(mousePos);
        }
        
        // Ié”® - æ”¶è·
        if (Input.GetKeyDown(KeyCode.I))
        {
            FarmingManager_v2.Instance?.HarvestCrop(
                mousePos, out var crop, out int amount);
            if (crop != null)
            {
                Debug.Log($"æ”¶è·: {crop.itemName} x{amount}");
            }
        }
    }
}
```

#### æµ‹è¯•æ­¥éª¤ï¼š

1. åˆ›å»ºç©ºå¯¹è±¡ â†’ æ·»åŠ `FarmingTestInput`è„šæœ¬
2. è¿è¡Œæ¸¸æˆ
3. æŒ‰é”®æµ‹è¯•ï¼š
   - **T** - é”„åœ°ï¼ˆåº”è¯¥å‡ºç°å¹²ç‡¥è€•åœ°Tileï¼‰
   - **U** - æµ‡æ°´ï¼ˆåº”è¯¥ç«‹å³å˜ä¸ºæ°´æ¸Tileï¼‰
   - **ç­‰å¾…2æ¸¸æˆå°æ—¶** - åº”è¯¥è‡ªåŠ¨å˜ä¸ºæ·±è‰²Tile
   - **ç¬¬äºŒå¤©** - åº”è¯¥è‡ªåŠ¨å˜å›å¹²ç‡¥Tile

---

## ğŸ¯ ç³»ç»Ÿå·¥ä½œæµç¨‹ï¼ˆå¸®åŠ©ç†è§£ï¼‰

### æµ‡æ°´æµç¨‹ï¼š

```
ç©å®¶æŒ‰Ué”®æµ‡æ°´
    â†“
ç«‹å³è®°å½•ï¼šwateredToday = true
         waterTime = å½“å‰æ¸¸æˆæ—¶é—´ï¼ˆä¾‹å¦‚ 8.5 = 8ç‚¹30åˆ†ï¼‰
    â†“
ç«‹å³è§†è§‰ï¼šmoistureState = WetWithPuddle
         Tilemapæ˜¾ç¤ºæ°´æ¸Tileï¼ˆéšæœºé€‰ä¸€ä¸ªï¼‰
    â†“
2å°æ—¶åï¼ˆä¾‹å¦‚10ç‚¹30åˆ†ï¼‰
OnHourChangedäº‹ä»¶è§¦å‘
    â†“
æ£€æŸ¥ï¼šhoursSinceWatering >= 2
    â†“
æ›´æ–°è§†è§‰ï¼šmoistureState = WetDark
         Tilemapæ˜¾ç¤ºæ·±è‰²Tile
    â†“
ç¬¬äºŒå¤©å¼€å§‹ï¼ˆOnDayChangedäº‹ä»¶ï¼‰
    â†“
æ›´æ–°å‚æ•°ï¼šwateredYesterday = wateredToday (true)
         wateredToday = false
         waterTime = -1
    â†“
æ›´æ–°è§†è§‰ï¼šmoistureState = Dry
         Tilemapæ˜¾ç¤ºå¹²ç‡¥Tile
    â†“
ä½œç‰©ç”Ÿé•¿æ£€æŸ¥ï¼š
    if (wateredYesterday == true)
        ä½œç‰©ç”Ÿé•¿ +1
    else
        è¿ç»­æœªæµ‡æ°´å¤©æ•° +1
```

### Tileåˆ‡æ¢åŸç†ï¼š

```
UpdateTileVisual(position, tileData)
    â†“
æ£€æŸ¥ moistureState
    â†“
    Dry â†’ ä½¿ç”¨ dryFarmlandTile
    WetWithPuddle â†’ éšæœºé€‰æ‹© wetWithPuddleTiles[0/1/2]
    WetDark â†’ ä½¿ç”¨ wetDarkTile
    â†“
farmlandTilemap.SetTile(position, targetTile)
    â†“
Unityå†…éƒ¨ï¼š
    1. æ‰¾åˆ°positionå¯¹åº”çš„ç½‘æ ¼æ ¼å­
    2. ç§»é™¤æ—§Tileçš„æ¸²æŸ“æ•°æ®
    3. æ’å…¥æ–°Tileçš„Sprite
    4. é‡æ–°æ¸²æŸ“è¯¥æ ¼å­
    â†“
å®Œæˆï¼å±å¹•ä¸Šçš„Tileå›¾ç‰‡ç«‹å³æ”¹å˜
```

---

## ğŸ“‚ æ–‡ä»¶ç»“æ„æ€»è§ˆ

```
Assets/
â”œâ”€â”€ Sprites/
â”‚   â””â”€â”€ Farm/
â”‚       â””â”€â”€ Tiles/
â”‚           â”œâ”€â”€ Farmland_Dry.png
â”‚           â”œâ”€â”€ Farmland_Wet_Puddle1.png
â”‚           â”œâ”€â”€ Farmland_Wet_Puddle2.png
â”‚           â”œâ”€â”€ Farmland_Wet_Puddle3.png
â”‚           â””â”€â”€ Farmland_Wet_Dark.png
â”‚
â”œâ”€â”€ Tiles/
â”‚   â””â”€â”€ Farm/
â”‚       â”œâ”€â”€ Farmland_Dry.asset
â”‚       â”œâ”€â”€ Farmland_Wet_Puddle1.asset
â”‚       â”œâ”€â”€ Farmland_Wet_Puddle2.asset
â”‚       â”œâ”€â”€ Farmland_Wet_Puddle3.asset
â”‚       â””â”€â”€ Farmland_Wet_Dark.asset
â”‚
â”œâ”€â”€ Scripts/
â”‚   â”œâ”€â”€ Farm/
â”‚   â”‚   â”œâ”€â”€ FarmingManager_v2.cs â† ä½¿ç”¨è¿™ä¸ª
â”‚   â”‚   â”œâ”€â”€ FarmingManager.cs â† æ—§ç‰ˆæœ¬ï¼ˆå¯åˆ é™¤ï¼‰
â”‚   â”‚   â”œâ”€â”€ CropGrowthSystem.cs
â”‚   â”‚   â”œâ”€â”€ FarmTileData.cs
â”‚   â”‚   â”œâ”€â”€ CropInstance.cs
â”‚   â”‚   â”œâ”€â”€ CropController.cs
â”‚   â”‚   â””â”€â”€ SoilMoistureState.cs
â”‚   â”‚
â”‚   â””â”€â”€ Test/
â”‚       â””â”€â”€ FarmingTestInput.cs
â”‚
â””â”€â”€ Scenes/
    â””â”€â”€ YourScene.unity
        â””â”€â”€ LAYER 1
            â””â”€â”€ Tilemap
                â””â”€â”€ Farmland â† ä½ çš„å†œç”°å±‚
```

---

## ğŸ¨ å…³äºä½ çš„Spriteèµ„æº

æ ¹æ®ä½ æä¾›çš„æˆªå›¾ï¼Œä½ æœ‰ï¼š

1. **å¤§çš„åœŸåœ°sprite**ï¼ˆå¸¦åœ†å½¢è¾¹ç•Œï¼‰
   - è¿™ä¸ªå¾ˆå®Œç¾ï¼ç›´æ¥ç”¨ä½œå¹²ç‡¥çŠ¶æ€

2. **3ä¸ªè“è‰²æ°´æ¸sprite**
   - å åŠ åˆ°åœŸåœ°ä¸Šï¼Œåˆ¶ä½œ3ä¸ªæ°´æ¸å˜ä½“
   - æˆ–è€…ï¼šæˆ‘å¯ä»¥æä¾›åŠ¨æ€å åŠ è„šæœ¬ï¼ˆä¸éœ€è¦æ‰‹åŠ¨åˆæˆï¼‰

3. **å°çš„åœŸåœ°sprite**ï¼ˆå·¦ä¸‹è§’ï¼‰
   - è¿™ä¸ªå¯ä»¥ç”¨äºRule Tileï¼ˆé«˜çº§åŠŸèƒ½ï¼Œåç»­å¯åšï¼‰
   - ç°åœ¨å…ˆä¸ç®¡å®ƒ

### æ¨èæ–¹æ¡ˆï¼š

**å¦‚æœä½ ä¼šç”¨PS/GIMP**ï¼š
- æ‰‹åŠ¨åˆæˆ5å¼ å›¾ï¼ˆ10åˆ†é’Ÿï¼‰
- æœ€ç¨³å®šï¼Œæœ€ç®€å•

**å¦‚æœä½ ä¸æƒ³ç”¨å›¾åƒç¼–è¾‘å™¨**ï¼š
- ä½¿ç”¨å•ç‹¬çš„sprite
- åœ¨Tileçš„Colorå±æ€§ä¸­è°ƒæ•´é¢œè‰²
- æˆ‘å¯ä»¥æä¾›è„šæœ¬åŠ¨æ€å åŠ æ°´æ¸

---

## â“ å¸¸è§é—®é¢˜

### Q1: æˆ‘çš„Tileä¸æ˜¾ç¤ºï¼Ÿ

æ£€æŸ¥ï¼š
- [ ] Spriteçš„Pixels Per Unitæ˜¯å¦æ­£ç¡®ï¼Ÿ
- [ ] Tilemapçš„Sorting Layeræ˜¯å¦æ­£ç¡®ï¼Ÿ
- [ ] Cameraèƒ½çœ‹åˆ°è¿™ä¸ªä½ç½®å—ï¼Ÿ

### Q2: Tileæ˜¾ç¤ºä½†æ˜¯å¯¹ä¸é½ï¼Ÿ

- Gridçš„Cell Sizeåº”è¯¥æ˜¯(1, 1, 0)
- Spriteçš„Pivotåº”è¯¥æ˜¯Center
- Tilemapçš„Anchoråº”è¯¥æ˜¯(0, 0, 0)

### Q3: æµ‡æ°´åTileæ²¡å˜åŒ–ï¼Ÿ

æ£€æŸ¥ï¼š
- [ ] Wet Puddle Tilesæ•°ç»„æ˜¯å¦å·²åˆ†é…ï¼Ÿ
- [ ] TimeManageræ˜¯å¦å­˜åœ¨å¹¶è¿è¡Œï¼Ÿ
- [ ] OnHourChangedäº‹ä»¶æ˜¯å¦è§¦å‘ï¼Ÿï¼ˆçœ‹Consoleæ—¥å¿—ï¼‰

---

## ğŸš€ ä¸‹ä¸€æ­¥

å®Œæˆä¸Šè¿°æ­¥éª¤åï¼š

1. **æµ‹è¯•Tilemapåˆ‡æ¢** - ç¡®è®¤3ç§çŠ¶æ€æ­£å¸¸æ˜¾ç¤º
2. **æµ‹è¯•æµ‡æ°´é€»è¾‘** - ç¡®è®¤æ—¶é—´åˆ‡æ¢æ­£å¸¸
3. **æ·»åŠ ä½œç‰©ç³»ç»Ÿ** - åˆ›å»ºä½œç‰©é¢„åˆ¶ä½“å’Œæ•°æ®
4. **å®Œæ•´æµ‹è¯•** - é”„åœ°â†’ç§æ¤â†’æµ‡æ°´â†’ç­‰å¾…ç”Ÿé•¿â†’æ”¶è·

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- **è¯¦ç»†è¯´æ˜**ï¼š`å†œç”°ç³»ç»Ÿ-è¶…è¯¦ç»†å®æ–½æ¸…å•.md`ï¼ˆåŒ…å«TilemapåŸç†è¯¦è§£ï¼‰
- **è®¾è®¡æ–¹æ¡ˆ**ï¼š`ç§ç”°ç³»ç»Ÿå®Œæ•´è®¾è®¡æ–¹æ¡ˆ.md`
- **åŸå®æ–½æŒ‡å—**ï¼š`ç§ç”°ç³»ç»Ÿå®æ–½æŒ‡å—.md`

---

**å¦‚æœä»»ä½•æ­¥éª¤ä¸æ¸…æ¥šï¼Œéšæ—¶é—®æˆ‘ï¼æˆ‘ä¼šç”¨æ›´ç®€å•çš„æ–¹å¼è§£é‡Šã€‚**

ç¥ä½ å®ç°é¡ºåˆ©ï¼ğŸŒ¾
