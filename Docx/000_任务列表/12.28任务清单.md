# 12.28 任务清单 - 全工作区汇总

**创建日期**: 2025-12-30  
**汇总范围**: 所有 .kiro/specs 工作区  
**状态**: 📋 待用户确认  
**基于**: 12.21 任务清单 + 各工作区 memory.md 最新状态

---

## 📊 工作区完成度总览

| 工作区 | 完成度 | 状态 | 最后更新 | 说明 |
|--------|--------|------|----------|------|
| 物品放置系统 | 100% | ✅ 已完成 | 12-29 | 代码完成，待场景配置 |
| 物品掉落拾取 | 100% | ✅ 已完成 | 12-24 | 全部功能完成 |
| 物品显示尺寸统一 | 100% | ✅ 已完成 | 12-25 | 全部功能完成 |
| 砍树系统优化 | 100% | ✅ 已完成 | 12-28 | 成长边距检测重构完成 |
| 树木系统 | 98% | ✅ 基本完成 | 12-24 | 待用户测试 |
| 矿石系统 | 95% | ✅ 基本完成 | 12-21 | 待用户配置和测试 |
| 技能等级系统 | 95% | ✅ 基本完成 | 12-21 | 核心功能完成 |
| 制作台系统 | 95% | ✅ 基本完成 | 12-21 | 待用户创建 UI 预制体 |
| 云朵遮挡系统 | 95% | ✅ 基本完成 | 12-17 | 待云影素材导入 |
| 遮挡与导航 | 95% | ✅ 基本完成 | 12-22 | v5.2 待用户测试 |
| SO设计系统 | 90% | ✅ 基本完成 | 12-24 | 批量工具已完成 |
| UI系统 | 95% | ✅ 基本完成 | 12-24 | 图标旋转已完成 |
| 工具动画重构 | 75% | 🚧 进行中 | 12-22 | 待场景配置 |
| 农田系统 | 30% | 🚧 待开始 | 12-30 | 核心功能待实现 |

---

## 🔴🔴🔴 重要架构决策 🔴🔴🔴

### 种子与树苗分离（2025-12-30 确认）

```
ItemData (基类)
├── SeedData (种子) ──────────→ 农田系统 (FarmingSystem)
│   └── 放置到耕地 Tilemap
│   └── FarmingSystem 管理生长
│
└── PlaceableItemData (可放置物品基类) ──→ 放置系统 (PlacementManager)
    ├── SaplingData (树苗)
    ├── WorkstationData (工作台)
    └── StorageData (存储容器)
```

详见：`.kiro/specs/物品放置系统/memory.md` 会话 7

---

## 📋 详细任务清单

### 一、农田系统（P0 - 即将开始）

#### 1.1 耕地系统
| 任务 | 状态 | 说明 |
|------|------|------|
| 创建耕地 Tilemap（Tilled、Watered 状态） | ⬜ 待开始 | 需要 Tile 资源 |
| FarmingManager 管理耕地状态 | ⬜ 待开始 | 核心管理器 |
| 锄头工具与耕地交互 | ⬜ 待开始 | 工具命中处理 |
| 耕地状态持久化 | ⬜ 待开始 | 存档系统 |

#### 1.2 种植系统
| 任务 | 状态 | 说明 |
|------|------|------|
| SeedData 放置到耕地 | ⬜ 待开始 | 种植逻辑 |
| 种植位置验证（必须是已耕作的土地） | ⬜ 待开始 | 验证逻辑 |
| 种植后创建作物实例 | ⬜ 待开始 | CropInstance |
| 季节检查（不同季节不同种子） | ⬜ 待开始 | 季节限制 |

#### 1.3 浇水系统
| 任务 | 状态 | 说明 |
|------|------|------|
| 水壶工具与耕地交互 | ⬜ 待开始 | 工具命中处理 |
| 土壤湿度状态管理 | ⬜ 待开始 | Dry → WetWithPuddle → WetDark |
| 每日湿度重置 | ⬜ 待开始 | 时间系统集成 |

#### 1.4 收获系统
| 任务 | 状态 | 说明 |
|------|------|------|
| 作物成熟检测 | ⬜ 待开始 | 生长天数判断 |
| 收获交互 | ⬜ 待开始 | 手动收获 |
| 掉落物品生成 | ⬜ 待开始 | 使用 WorldItemPool |
| 可重复收获作物处理 | ⬜ 待开始 | 草莓、蓝莓等 |

#### 1.5 作物生长
| 任务 | 状态 | 说明 |
|------|------|------|
| 每日生长检测 | ⬜ 待开始 | 时间系统集成 |
| 浇水状态影响生长 | ⬜ 待开始 | 未浇水不生长 |
| 生长阶段 Sprite 切换 | ⬜ 待开始 | 视觉更新 |
| 枯萎系统（长期不浇水） | ⬜ 待开始 | 可选功能 |

---

### 二、物品放置系统（P0 - 代码完成，待配置）

| 任务 | 状态 | 说明 |
|------|------|------|
| 场景中创建 PlacementManager 空对象 | ⬜ 待用户完成 | Unity 编辑器操作 |
| 添加 PlacementManager 脚本组件 | ⬜ 待用户完成 | Unity 编辑器操作 |
| 创建测试用树苗 SO | ⬜ 待用户完成 | 使用批量生成工具 |
| 测试树苗放置功能 | ⬜ 待用户完成 | 运行时测试 |
| 与 InventoryService 集成（扣除/返还物品） | ⬜ 待开始 | 代码实现 |

---

### 三、制作台系统（P1 - 代码完成，待 UI 预制体）

| 任务 | 状态 | 说明 |
|------|------|------|
| 创建 MaterialItem.prefab | ⬜ 待用户完成 | Unity 编辑器操作 |
| 创建 RecipeSlot.prefab | ⬜ 待用户完成 | Unity 编辑器操作 |
| 创建 CraftingPanel.prefab | ⬜ 待用户完成 | Unity 编辑器操作 |
| 配置现有配方 SO（工作台类型、解锁条件） | ⬜ 待用户完成 | SO 数据配置 |
| 测试制作功能 | ⬜ 待用户完成 | 运行时测试 |

---

### 四、矿石系统（P1 - 代码完成，待配置）

| 任务 | 状态 | 说明 |
|------|------|------|
| 配置 ToolData SO 的 materialTier 字段 | ⬜ 待用户完成 | SO 数据配置 |
| 创建石头 Sprite 资源 | ⬜ 待用户完成 | 美术资源 |
| 在场景中添加 StoneController 预制体 | ⬜ 待用户完成 | Unity 编辑器操作 |
| 测试挖矿功能 | ⬜ 待用户完成 | 运行时测试 |

---

### 五、工具动画重构（P1 - 待场景配置）

| 任务 | 状态 | 说明 |
|------|------|------|
| 在 Player 对象添加 EnergySystem 组件 | ⬜ 待用户完成 | Unity 编辑器操作 |
| 配置 EnergySystem 参数（Max Energy: 100） | ⬜ 待用户完成 | Unity 编辑器操作 |
| 将 EP Slider 引用拖拽到 EnergySystem | ⬜ 待用户完成 | Unity 编辑器操作 |
| 配置 ToolData SO 动画控制器 | ⬜ 待用户完成 | SO 数据配置 |

---

### 六、云朵遮挡系统（P2 - 待素材导入）

| 任务 | 状态 | 说明 |
|------|------|------|
| 准备 3-5 张云影 PNG 图片 | ⬜ 待用户完成 | 美术资源 |
| 导入到 Assets/Sprites/Effects/CloudShadow/ | ⬜ 待用户完成 | 资源导入 |
| 添加 Sorting Layer: CloudShadow | ⬜ 待用户完成 | Project Settings |
| 在场景中添加 CloudShadowManager 组件 | ⬜ 待用户完成 | Unity 编辑器操作 |
| 配置云影 Sprite 数组 | ⬜ 待用户完成 | Unity 编辑器操作 |

---

### 七、遮挡与导航系统（P2 - 待纹理配置）

| 任务 | 状态 | 说明 |
|------|------|------|
| 设置树木 Sprite 纹理 Read/Write Enabled | ⬜ 待用户完成 | 纹理导入设置 |
| 设置建筑 Sprite 纹理 Read/Write Enabled | ⬜ 待用户完成 | 纹理导入设置 |
| 测试遮挡透明效果 | ⬜ 待用户完成 | 运行时测试 |
| 测试导航系统 | ⬜ 待用户完成 | 运行时测试 |

---

### 八、树木系统（P2 - 待测试）

| 任务 | 状态 | 说明 |
|------|------|------|
| 测试成长空间检测功能 | ⬜ 待用户完成 | 运行时测试 |
| 测试冬季树苗死亡功能 | ⬜ 待用户完成 | 运行时测试 |
| 测试锄头挖树苗功能 | ⬜ 待用户完成 | 运行时测试 |

---

### 九、物品掉落拾取（P2 - 可选更新）

| 任务 | 状态 | 说明 |
|------|------|------|
| 使用 WorldPrefabGeneratorTool 重新生成所有 WorldPrefab | ⬜ 可选 | 应用新的显示尺寸配置 |

---

### 十、其他待完成任务

| 工作区 | 任务 | 状态 | 说明 |
|--------|------|------|------|
| SO设计系统 | 更新现有 Weapon SO 动画配置 | ⬜ 待用户完成 | SO 数据配置 |
| 技能等级系统 | UI 显示（可选） | ⬜ 可选 | 技能面板 |
| 技能等级系统 | 数据持久化（可选） | ⬜ 可选 | 存档系统 |

---

## ✅ 已完成的核心功能

### 代码实现（AI 完成）

| 系统 | 完成内容 |
|------|----------|
| 物品放置系统 | PlacementManager、PlacementValidator、PlacementPreview、SaplingData、WorkstationData 等 |
| 物品掉落拾取 | WorldItemDrop、WorldItemPickup、AutoPickupService、WorldItemPool、WorldPrefabGeneratorTool |
| 物品显示尺寸 | ItemData.displayPixelSize、UIItemIconScaler 旋转边界修复 |
| 砍树系统优化 | 成长边距检测 v5、伤害计算修复、树桩砍伐修复 |
| 树木系统 | TreeControllerV2Editor、成长空间检测、冬季树苗死亡 |
| 矿石系统 | StoneController、MaterialTierHelper、差值掉落 |
| 技能等级系统 | SkillType 5大类、SkillLevelService、经验获取 |
| 制作台系统 | CraftingService、CraftingPanel、RecipeSlotUI、MaterialItemUI |
| 遮挡与导航 | OcclusionManager v5.1、PlayerAutoNavigator v5.2 |
| SO设计系统 | Tool_BatchItemSOGenerator、Tool_BatchItemSOModifier、Tool_BatchRecipeCreator |
| UI系统 | 图标 45° 旋转显示、bagSprite 废弃 |

---

## 📊 任务统计

| 类型 | 数量 | 说明 |
|------|------|------|
| 🤖 AI 代码实现 | 已完成 | 所有核心代码已实现 |
| 👤 用户 Unity 配置 | ~20 项 | 场景配置、预制体创建 |
| 📝 用户 SO 数据配置 | ~5 项 | materialTier、配方工作台等 |
| 🎨 用户美术资源 | ~3 项 | 云影、石头 Sprite |
| 🧪 用户测试验证 | ~10 项 | 各系统功能测试 |
| 🚧 农田系统开发 | ~15 项 | 核心功能待实现 |

---

## 🎯 推荐执行顺序

### 第一阶段：农田系统开发（P0）
1. 耕地 Tilemap 设置
2. FarmingManager 核心逻辑
3. 种子种植流程
4. 浇水和生长系统
5. 收获系统

### 第二阶段：场景配置（P0-P1）
1. PlacementManager 场景配置
2. 测试树苗放置
3. EnergySystem 场景配置
4. ToolData SO 配置

### 第三阶段：UI 和测试（P1-P2）
1. 制作台 UI 预制体创建
2. 配方 SO 配置
3. 各系统功能测试

### 第四阶段：美术资源（P2）
1. 云影素材导入
2. 石头 Sprite 创建
3. WorldPrefab 重新生成

---

*请告诉我哪些任务你已经完成了，哪些还没做，我们一起确认后开始下一步工作*
