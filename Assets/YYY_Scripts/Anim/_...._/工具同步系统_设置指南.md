# å·¥å…·åŒæ­¥ç³»ç»Ÿ - å®Œæ•´è®¾ç½®æŒ‡å—

## ğŸ¯ æ ¸å¿ƒè®¾è®¡ç†å¿µ

1. **å·¥å…·ä¸å¸¸é©»æ˜¾ç¤º** - Toolåªåœ¨ä½¿ç”¨æ—¶å‡ºç°ï¼Œå¹³æ—¶éšè—
2. **ä¸¥æ ¼åŒæ­¥** - ToolåŠ¨ç”»ä¸PlayeråŠ¨ç”»å®Œå…¨åŒæ­¥ï¼ŒåŒæ—¶å¼€å§‹ã€åŒæ—¶ç»“æŸ
3. **è‡ªåŠ¨æ§åˆ¶** - LayerAnimSyncè‡ªåŠ¨å¤„ç†æ˜¾ç¤º/éšè—å’ŒåŒæ­¥

---

## ğŸ—ï¸ åœºæ™¯ç»“æ„è®¾ç½®

### 1. Hierarchyç»“æ„

```
Player (GameObject)
  â”œâ”€ SpriteRenderer (Playerçš„Body)
  â”œâ”€ Animator (Player.controller)
  â”œâ”€ PlayerAnimController (å·²æœ‰è„šæœ¬)
  â”œâ”€ PlayerToolController (å·¥å…·æ§åˆ¶è„šæœ¬)
  â”œâ”€ LayerAnimSync (åŒæ­¥è„šæœ¬) â­
  â”‚
  â””â”€ Hand (å­GameObject)
      â”œâ”€ SpriteRenderer âš ï¸ **é»˜è®¤ç¦ç”¨**
      â””â”€ Animator (Tool_Axe.controller)
```

### 2. å…³é”®é…ç½®

#### âš ï¸ **Handçš„SpriteRendererè®¾ç½®**

**å¿…é¡»æ‰‹åŠ¨ç¦ç”¨ï¼**

1. é€‰ä¸­ `Player/Hand` GameObject
2. åœ¨Inspectorä¸­æ‰¾åˆ° `Sprite Renderer` ç»„ä»¶
3. **å–æ¶ˆå‹¾é€‰** ç»„ä»¶å·¦ä¸Šè§’çš„å¤é€‰æ¡†ï¼ˆç¦ç”¨ç»„ä»¶ï¼‰

**ä¸ºä»€ä¹ˆï¼Ÿ**
- LayerAnimSyncä¼šåœ¨éœ€è¦æ—¶è‡ªåŠ¨å¯ç”¨
- é»˜è®¤ç¦ç”¨ç¡®ä¿å·¥å…·ä¸ä¼šä¸€ç›´æ˜¾ç¤º

#### ğŸ“Š **Sorting Layerè®¾ç½®ï¼ˆé‡è¦ï¼ï¼‰**

| GameObject | Sorting Layer | Order in Layer |
|-----------|---------------|----------------|
| Player | Player | 0ï¼ˆæˆ–ç”±åŠ¨æ€æ’åºè®¡ç®—ï¼‰ |
| Hand | Player | Playerçš„Order + 1 |

**âš ï¸ å…³é”®è§„åˆ™**ï¼šHandçš„Orderå¿…é¡»**å§‹ç»ˆæ¯”Playeré«˜è‡³å°‘1**ï¼

**å¦‚ä½•è®¾ç½®**ï¼š

**æ–¹æ³•1ï¼šæ‰‹åŠ¨è®¾ç½®ï¼ˆå›ºå®šåœºæ™¯ï¼‰**
- Player: Order = 0
- Hand: Order = 1

**æ–¹æ³•2ï¼šä½¿ç”¨002æ‰¹é‡å·¥å…·ï¼ˆåŠ¨æ€æ’åºï¼‰**
1. é€‰ä¸­Player â†’ ä½¿ç”¨002å·¥å…·è®¡ç®—Orderï¼ˆå¦‚ -1000ï¼‰
2. æ‰‹åŠ¨é€‰ä¸­Hand â†’ è®¾ç½®Order = Playerçš„Order + 1ï¼ˆå¦‚ -999ï¼‰

**æ–¹æ³•3ï¼šè¿è¡Œæ—¶åŠ¨æ€è°ƒæ•´ï¼ˆæ¨èï¼‰**
- åœ¨LayerAnimSyncä¸­æ·»åŠ è‡ªåŠ¨è°ƒæ•´é€»è¾‘
- æ¯æ¬¡æ˜¾ç¤ºHandæ—¶ï¼Œè‡ªåŠ¨è®¾ç½® `Hand.Order = Player.Order + 1`

**ä¸ºä»€ä¹ˆå¿…é¡»è¿™æ ·**ï¼š
- Orderé«˜çš„æ˜¾ç¤ºåœ¨å‰é¢
- Handï¼ˆå·¥å…·ï¼‰å¿…é¡»æ˜¾ç¤ºåœ¨Playerï¼ˆèº«ä½“ï¼‰å‰é¢
- å¦åˆ™å·¥å…·ä¼šè¢«èº«ä½“é®æŒ¡

---

## ğŸ”§ LayerAnimSync é…ç½®

### Inspectorè®¾ç½®

```
Layer Anim Sync (Script)
  â”Œâ”€ Playerç»„ä»¶ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Player Animator: æ‹–å…¥Playerçš„Animator
  â”‚ Player Sprite Renderer: æ‹–å…¥Playerçš„SpriteRenderer
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  
  â”Œâ”€ Toolç»„ä»¶ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Tool Animator: æ‹–å…¥Handçš„Animator
  â”‚ Tool Sprite Renderer: æ‹–å…¥Handçš„SpriteRenderer â­
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  
  â”Œâ”€ å·¥å…·åŠ¨ä½œState â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Tool Active States:
  â”‚   Size: 3
  â”‚   Element 0: 6  (Slice)
  â”‚   Element 1: 7  (Pierce)
  â”‚   Element 2: 8  (Crush)
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Tool Active States è¯´æ˜

è¿™ä¸ªæ•°ç»„å®šä¹‰äº†å“ªäº›åŠ¨ä½œéœ€è¦æ˜¾ç¤ºå·¥å…·ï¼š

| Stateå€¼ | åŠ¨ä½œåç§° | è¯´æ˜ |
|---------|---------|------|
| 6 | Slice | æŒ¥ç ï¼ˆæ–§å¤´ï¼‰ |
| 7 | Pierce | åˆºå‡»ï¼ˆå‰‘/çŸ›ï¼‰ |
| 8 | Crush | é‡å‡»ï¼ˆé”¤å­ï¼‰ |

**æ ¹æ®ä½ çš„é¡¹ç›®æ·»åŠ æˆ–åˆ é™¤Stateï¼**

---

## ğŸ® å·¥ä½œæµç¨‹

### æ‰§è¡Œæµç¨‹ï¼ˆè‡ªåŠ¨ï¼‰

```
1. ç©å®¶æ‰§è¡ŒSliceåŠ¨ä½œ
   â””â”€ PlayerAnimController.SetInteger("State", 6)

2. LayerAnimSyncæ£€æµ‹åˆ°State=6
   â””â”€ å¯ç”¨Handçš„SpriteRenderer
   â””â”€ å¼ºåˆ¶HandåŠ¨ç”»ä»0å¸§å¼€å§‹
   â””â”€ å®æ—¶åŒæ­¥å‚æ•°å’Œæ—¶é—´

3. Playerå’ŒHandåŒæ­¥æ’­æ”¾åŠ¨ç”»
   â””â”€ æ¯å¸§LateUpdateåŒæ­¥æ—¶é—´
   â””â”€ ç¡®ä¿ä¸¥æ ¼ä¸€è‡´

4. åŠ¨ç”»æ’­æ”¾å®Œæ¯•ï¼ŒStateæ”¹å˜
   â””â”€ LayerAnimSyncæ£€æµ‹åˆ°Stateâ‰ 6
   â””â”€ ç¦ç”¨Handçš„SpriteRenderer
   â””â”€ å·¥å…·æ¶ˆå¤±
```

### æµ‹è¯•æ–¹æ³•

**ç¼–è¾‘å™¨æ¨¡å¼ä¸‹ï¼ˆå·²å†…ç½®æµ‹è¯•ä»£ç ï¼‰**ï¼š

| æŒ‰é”® | åŠŸèƒ½ |
|------|------|
| Q | å¾ªç¯åˆ‡æ¢å·¥å…·å“è´¨ï¼ˆæœ¨â†’çŸ³â†’ç£¨çŸ³â†’é“œâ†’é“â†’é‡‘â†’æœ¨ï¼‰ |
| 2 | æ‰§è¡ŒSliceåŠ¨ä½œï¼ˆæµ‹è¯•å·¥å…·æ˜¾ç¤ºå’ŒåŒæ­¥ï¼‰ |

**ä¸ºä»€ä¹ˆç”¨Qé”®**ï¼š
- é¿å…ä¸ç°æœ‰æ“ä½œå†²çªï¼ˆW=è¡Œèµ°ï¼ŒE=æ‹¾å–ç­‰ï¼‰
- å¾ªç¯åˆ‡æ¢æ›´ç¬¦åˆæµ‹è¯•éœ€æ±‚
- ç”Ÿäº§ç¯å¢ƒè¯·é›†æˆåˆ°UIç³»ç»Ÿï¼Œåˆ é™¤æµ‹è¯•ä»£ç 

**è¿è¡Œæ¸¸æˆï¼ŒæŒ‰2é”®åº”è¯¥çœ‹åˆ°**ï¼š
1. å·¥å…·ä»éšè—å˜ä¸ºæ˜¾ç¤º
2. å·¥å…·ä¸è§’è‰²åŒæ­¥æŒ¥ç 
3. åŠ¨ç”»ç»“æŸåå·¥å…·æ¶ˆå¤±

---

## âš ï¸ å¸¸è§é—®é¢˜

### 1. å·¥å…·ä¸€ç›´æ˜¾ç¤ºä¸æ¶ˆå¤±

**åŸå› **ï¼šHandçš„SpriteRendereræ²¡æœ‰é»˜è®¤ç¦ç”¨

**è§£å†³**ï¼š
1. é€‰ä¸­Hand GameObject
2. ç¦ç”¨SpriteRendererç»„ä»¶
3. é‡æ–°è¿è¡Œ

### 2. å·¥å…·æ˜¾ç¤ºä½†ä¸åŠ¨

**åŸå› **ï¼šåŠ¨ç”»åŒæ­¥å¤±è´¥

**æ£€æŸ¥**ï¼š
1. LayerAnimSyncçš„æ‰€æœ‰å¼•ç”¨æ˜¯å¦æ­£ç¡®æ‹–å…¥
2. Handçš„Animatoræ˜¯å¦æœ‰æ­£ç¡®çš„Controller
3. Consoleæ˜¯å¦æœ‰æŠ¥é”™

### 3. å·¥å…·åœ¨è§’è‰²åé¢

**åŸå› **ï¼šSorting Orderä¸æ­£ç¡®

**è§£å†³**ï¼š
1. ç¡®ä¿Handçš„Order in Layer > Playerçš„Order in Layer
2. æˆ–è€…è®¾ç½®Handä¸ºæ›´é«˜çš„Sorting Layer

### 4. åŠ¨ç”»ä¸åŒæ­¥ï¼ˆå»¶è¿Ÿæ’­æ”¾ï¼‰

**åŸå› **ï¼šå‚æ•°åŒæ­¥æœ‰é—®é¢˜

**æ£€æŸ¥**ï¼š
1. ç¡®è®¤LayerAnimSyncåœ¨LateUpdateä¸­æ‰§è¡Œ
2. æ£€æŸ¥AnimatorExtensions.csæ˜¯å¦å­˜åœ¨
3. ç¡®è®¤Toolçš„Animatoræœ‰æ­£ç¡®çš„å‚æ•°

---

## ğŸš€ ç”Ÿäº§ç¯å¢ƒä½¿ç”¨

### ç§»é™¤æµ‹è¯•ä»£ç 

åœ¨`PlayerToolController.cs`çš„`Update`æ–¹æ³•ä¸­ï¼Œåˆ é™¤`#if UNITY_EDITOR`å—ï¼š

```csharp
void Update()
{
    // ç”Ÿäº§ç¯å¢ƒï¼šåˆ é™¤æµ‹è¯•ä»£ç 
}
```

### é›†æˆåˆ°UIç³»ç»Ÿ

```csharp
// ç©å®¶åœ¨UIä¸­é€‰æ‹©å·¥å…·
public void OnToolSelected(int toolType, int toolQuality)
{
    playerToolController.EquipTool(toolType, toolQuality);
}

// ç©å®¶æ‰§è¡ŒåŠ¨ä½œ
public void PerformSliceAction()
{
    playerAnimController.SetInteger("State", 6);  // Slice
    // LayerAnimSyncè‡ªåŠ¨å¤„ç†æ˜¾ç¤ºå’ŒåŒæ­¥
}
```

---

## âœ… æ£€æŸ¥æ¸…å•

åœ¨è¿è¡Œæ¸¸æˆå‰ï¼Œç¡®è®¤ï¼š

- [ ] Handçš„SpriteRendereré»˜è®¤æ˜¯**ç¦ç”¨**çš„
- [ ] Handçš„Sorting Order **é«˜äº** Player
- [ ] LayerAnimSyncçš„æ‰€æœ‰å¼•ç”¨éƒ½å·²æ­£ç¡®æ‹–å…¥
- [ ] Tool Active StatesåŒ…å«éœ€è¦æ˜¾ç¤ºå·¥å…·çš„Stateå€¼
- [ ] Handçš„Animatoræœ‰æ­£ç¡®çš„Controllerï¼ˆå¦‚Tool_Axe.controllerï¼‰
- [ ] PlayerToolControllerå·²è£…å¤‡é»˜è®¤å·¥å…·

**å…¨éƒ¨å‹¾é€‰åï¼Œè¿è¡Œæ¸¸æˆæµ‹è¯•ï¼** ğŸ‰

