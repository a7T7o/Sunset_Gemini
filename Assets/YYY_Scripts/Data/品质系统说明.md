# 🌟 物品品质系统设计文档

## 📋 概述

品质系统参考《星露谷物语》设计，用于区分作物、食物等物品的价值。

---

## ⭐ 品质等级

| 品质 | 枚举值 | 星星颜色 | 价格倍率 | 基础概率 |
|------|--------|---------|---------|---------|
| **普通** | Normal (0) | 无星星 | x1.0 | 25% |
| **铜星** | Copper (1) | 棕色 ★ | x1.25 | 20% |
| **银星** | Silver (2) | 银色 ★ | x1.5 | 25% |
| **金星** | Gold (3) | 金色 ★ | x2.0 | 20% |
| **彩星** | Iridium (4) | 紫色 ★ | x2.5 | 10% |

---

## 🎨 UI显示规则

### **物品栏显示：**

```
┌─────────────┐
│             │
│    [图标]   │
│             │
│ ★          │ ← 星星显示在左下角
└─────────────┘
```

### **显示细节：**
- **位置**：物品槽的左下角
- **大小**：约图标的15-20%
- **符号**：单个星星 ★
- **颜色**：根据品质显示不同颜色
- **普通品质**：不显示星星

### **颜色定义（HEX）：**
```csharp
铜星：#B87333 (RGB: 184, 115, 51)   - 棕铜色
银星：#C0C0C0 (RGB: 192, 192, 192)  - 银色
金星：#FFD700 (RGB: 255, 215, 0)    - 金色
彩星：#9966FF (RGB: 153, 102, 255)  - 紫色
```

---

## 🎯 品质判定机制

### **作物收获时的品质计算：**

```csharp
基础分数 = Random(0-1)
+ 种田等级加成 (每级 +0.02)
+ 肥料加成 (+0.1)

分数 ≥ 0.9  → 彩星
分数 ≥ 0.7  → 金星
分数 ≥ 0.45 → 银星
分数 ≥ 0.25 → 铜星
分数 < 0.25 → 普通
```

### **示例：**
```
玩家种田等级5，使用肥料：
基础分数 0.5 + (5×0.02) + 0.1 = 0.7
→ 判定为 金星品质
```

---

## 💰 价格影响

### **售价计算公式：**
```csharp
最终售价 = 基础售价 × 品质倍率

例如：
番茄基础价 = 80金币
- 普通番茄：80 × 1.0 = 80金币
- 铜星番茄：80 × 1.25 = 100金币
- 银星番茄：80 × 1.5 = 120金币
- 金星番茄：80 × 2.0 = 160金币
- 彩星番茄：80 × 2.5 = 200金币
```

---

## 🔧 代码使用示例

### **1. 收获作物时随机品质：**
```csharp
using FarmGame.Data;

// 收获时
int farmingLevel = playerStats.farmingLevel; // 玩家等级
bool usedFertilizer = farmTile.HasFertilizer(); // 是否用肥料

ItemQuality quality = QualityHelper.RandomCropQuality(farmingLevel, usedFertilizer);
// 将作物添加到背包时带上品质
```

### **2. UI显示星星：**
```csharp
using UnityEngine.UI;
using FarmGame.Data;

// 在物品槽UI脚本中
public Image qualityStarImage; // 星星图片组件

public void DisplayItem(ItemData item, ItemQuality quality)
{
    // 设置物品图标
    itemIcon.sprite = item.icon;
    
    // 显示品质星星
    if (quality == ItemQuality.Normal)
    {
        qualityStarImage.gameObject.SetActive(false); // 普通品质不显示
    }
    else
    {
        qualityStarImage.gameObject.SetActive(true);
        qualityStarImage.color = QualityHelper.GetQualityStarColor(quality);
    }
}
```

### **3. 计算售价：**
```csharp
// 卖东西时
int basePrice = cropData.sellPrice;
ItemQuality quality = itemInstance.quality;

int finalPrice = QualityHelper.CalculatePriceWithQuality(basePrice, quality);
Debug.Log($"出售 {cropData.itemName}（{QualityHelper.GetQualityName(quality)}）：{finalPrice}金币");
```

### **4. Tooltip显示：**
```csharp
public string GetItemTooltip(ItemData item, ItemQuality quality)
{
    string text = $"<b>{item.itemName}</b>";
    
    if (quality != ItemQuality.Normal)
    {
        Color starColor = QualityHelper.GetQualityStarColor(quality);
        string colorHex = ColorUtility.ToHtmlStringRGB(starColor);
        text += $" <color=#{colorHex}>★</color>";
    }
    
    text += $"\n\n{item.description}";
    text += $"\n\n售价: {QualityHelper.CalculatePriceWithQuality(item.sellPrice, quality)}金币";
    
    return text;
}
```

---

## 🎮 游戏平衡性

### **品质影响范围：**
- ✅ **作物**：收获时随机品质
- ✅ **食物**：制作时可能产生品质（高级配方）
- ❌ **工具**：无品质（永远是普通）
- ❌ **武器**：无品质（用等级区分）
- ❌ **材料**：无品质（除非特殊设计）

### **提升品质的方式：**
1. **提升种田等级** - 每级+2%品质分数
2. **使用肥料** - +10%品质分数
3. **使用高级肥料**（后期可扩展）- +20%
4. **职业技能**（后期可扩展）- 特定作物品质保底

---

## 📊 数据结构

### **背包中的物品实例需要包含：**
```csharp
public class InventoryItem
{
    public int itemID;           // 物品ID
    public int quantity;         // 数量
    public ItemQuality quality;  // 品质（新增）
}
```

### **注意事项：**
- 相同物品不同品质**不能堆叠**
- 例如：10个普通番茄 + 5个金星番茄 = 占用2个背包格子

---

## 🎨 美术资源需求

### **需要准备的UI资源：**
1. **星星图标** (star.png)
   - 单个实心五角星
   - 纯白色PNG（通过代码着色）
   - 推荐尺寸：32x32像素
   - 用于在物品槽左下角显示

2. **可选：边框装饰**
   - 不同品质的物品槽边框发光效果
   - 这个可以后期优化时添加

---

## ✅ 总结

**核心原则：**
1. 品质**不改变物品外观**，只改变价格
2. 品质通过**UI星星**展示（位置：左下角）
3. 星星用**不同颜色**区分品质
4. 品质分为5级：普通/铜/银/金/彩
5. 收获时**随机判定**，受等级和肥料影响

这套系统完全模仿星露谷物语，玩家体验熟悉且平衡性好！

