# 背包交互逻辑优化 - 验收指南

## 功能验收清单

### 1. Shift 二分拿取余数归手上

- [ ] **测试 1.1**：对有 10 个物品的槽位执行 Shift+左键
  - 预期：手上 5 个，源槽位 5 个
  
- [ ] **测试 1.2**：对有 5 个物品的槽位执行 Shift+左键
  - 预期：手上 3 个，源槽位 2 个
  
- [ ] **测试 1.3**：对有 3 个物品的槽位执行 Shift+左键
  - 预期：手上 2 个，源槽位 1 个
  
- [ ] **测试 1.4**：对有 1 个物品的槽位执行 Shift+左键
  - 预期：手上 1 个，源槽位清空

### 2. 连续二分终止

- [ ] **测试 2.1**：Shift 拿起 1 个物品后，再次 Shift+左键点击源槽位
  - 预期：不执行任何操作，手上保持 1 个

### 3. Shift/Ctrl 拿起后源槽位为空时允许交换

- [ ] **测试 3.1**：Shift 拿起全部物品（源槽位清空），点击空槽位
  - 预期：物品放置到目标槽位
  
- [ ] **测试 3.2**：Shift 拿起全部物品（源槽位清空），点击有相同物品的槽位
  - 预期：尝试堆叠，溢出部分保留在手上
  
- [ ] **测试 3.3**：Shift 拿起全部物品（源槽位清空），点击有不同物品的槽位
  - 预期：执行交换（手上物品放到目标，目标物品放到源槽位）
  
- [ ] **测试 3.4**：Shift 拿起部分物品（源槽位非空），点击有不同物品的槽位
  - 预期：返回原位（不执行交换）
  
- [ ] **测试 3.5**：Ctrl 长按拿取直到源槽位清空，点击有不同物品的槽位
  - 预期：执行交换

### 4. 交换后选中目标槽位

- [ ] **测试 4.1**：拖拽完成物品交换
  - 预期：目标槽位进入选中状态（Toggle.isOn = true）
  
- [ ] **测试 4.2**：Shift/Ctrl 拿起后点击完成放置或交换
  - 预期：目标槽位进入选中状态
  
- [ ] **测试 4.3**：完成物品堆叠
  - 预期：目标槽位进入选中状态

### 5. Sort 后清除选中状态

- [ ] **测试 5.1**：选中某个槽位后，点击整理按钮
  - 预期：整理完成后，所有槽位的选中状态被清除
  
- [ ] **测试 5.2**：整理完成后检查
  - 预期：没有任何槽位处于选中状态

## 边界情况测试

### 堆叠溢出

- [ ] **测试 B.1**：手上 5 个苹果，目标槽位 95 个苹果（最大 99）
  - 预期：目标变成 99 个，手上剩余 1 个，继续保持 Held 状态

### 装备槽位限制

- [ ] **测试 B.2**：Shift 拿起物品（源槽位清空），点击不匹配的装备槽位
  - 预期：返回原位（装备限制优先）

## 测试步骤说明

### 准备工作

1. 打开 Unity 编辑器
2. 加载测试场景（包含背包 UI）
3. 确保背包中有多种物品和不同数量

### 测试流程

1. 按照验收清单逐项测试
2. 记录每项测试的结果（通过/失败）
3. 如果测试失败，记录具体现象和预期差异
4. 检查控制台日志，确认调试信息正确输出

### 调试日志检查

测试时应该看到以下日志：

- `[Manager] ShiftPickup - 原=X, 手上=Y, 源=Z`
- `[Manager] ContinueShiftSplit - 原=X, 返回=Y, 手上=Z`
- `[Manager] 源槽位为空，执行交换`
- `[Manager] 源槽位非空，不同物品，返回原位`
- `[Manager] 已清除所有槽位选中状态`

## 已知限制

- 装备槽位的选中状态暂不处理（没有 Toggle 组件）
- 工具栏槽位不受 Sort 清除选中状态影响

## 注意事项

1. 测试时注意观察 Toggle 的选中状态（视觉反馈）
2. 确认物品数量计算正确
3. 确认交换逻辑符合预期
4. 确认整理后背包整洁（无选中状态）
