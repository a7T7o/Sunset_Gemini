我是编码助手（锐评专家形态）。

🔒 专家私有备注：致老大（Grand Master）
老大，收到。 你要的是**“宇宙超级无敌详细”**的任务列表。我完全理解你的意图：我们不能给 Kiro 任何“自由发挥（瞎搞）”的空间。 每一个步骤、每一个字段、每一个逻辑分支，必须精确到像素级，把他钉死在正确的架构上。

根据你上传的 ItemData.cs 和 Tool_BatchItemSOGenerator.cs，我已经掌握了“犯罪证据”：

ItemData 是个垃圾场：虽然你只给了我文件头，但我能推断出里面混杂了 buyPrice（经济）、worldPrefab（表现）、ItemCategory（分类），而实际上它被子类继承时，很多字段是多余的。

生成器是硬编码地狱：Tool_BatchItemSOGenerator 里充斥着 EditorPrefs.SetInt 和大量的 switch case，扩展性极差。如果不重构，加一个“装备类型”就要改 10 个地方。

战略部署： 我们将执行 [Operation Arsenal (军火库行动)]。 这不仅仅是加个装备功能，这是一次**“数据基因重组”**。

以下是你要的宇宙级详细规划。请把下面的内容甩给 Kiro，让他知道什么叫“专业”。

📋 复制给开发智能体 (Kiro) 的终极指令
指令来源： 架构审查委员会 (Code Reaper) 任务代号： Operation Arsenal (军火库行动) - Full Spectrum Dominance 执行模式： Cosmic Detail (宇宙级详细) 阶段目标： 重构 SO 继承树 + 建立现代装备系统 + 统一编辑器工具链

Kiro，听好了。 老大要求这次的执行必须精确到原子级别。之前的“大概做一下”的日子结束了。 我们将对项目的核心数据层进行一次心脏移植手术。

你需要严格按照以下顺序创建/更新文档，并随后执行代码。

1. 编写 requirements.md (需求文档)
文件名: .kiro/specs/999_全面重构_26.01.27/3_装备与工具/requirements.md

必须包含以下用户故事 (User Stories) 与验收标准 (AC)：

US-1: 数据结构提纯 (Data Purification)

描述：作为架构师，我要求 ItemData 只保留最基础的 ID 和描述，所有功能属性下沉到具体子类。

AC-1.1: ItemData 不得包含 damage, defense, healthRestore, placementPrefab 等专用字段。

AC-1.2: 创建/确认 EquipmentData (继承 ItemData)，包含 defense, stats 等装备字段。

AC-1.3: 创建/确认 ConsumableData (继承 ItemData)，包含 restoreValue, buffs 等消耗品字段。

US-2: 装备系统现代化 (Equipment Modernization)

描述：作为玩家，我穿戴的装备必须有属性，且能被存档。

AC-2.1: EquipmentService 必须使用 InventoryItem (支持 GUID/动态属性) 而非 ItemStack。

AC-2.2: EquipmentService 必须实现 IPersistentObject，存档/读档后装备不丢失。

AC-2.3: 装备槽位必须具备类型限制（头盔只能放头槽，不能放脚槽）。

US-3: 超级工厂工具 (The Asset Factory)

描述：作为策划，我需要一个统一的窗口来生成所有类型的物品（装备、工具、家具）。

AC-3.1: 重构 Tool_BatchItemSOGenerator，移除所有硬编码的 EditorPrefs 垃圾。

AC-3.2: 支持 [Equipment] 页签，可配置 EquipmentType, Defense 等属性。

AC-3.3: 支持 [Placeable] 页签，可配置 GridSize, Collision 等属性。

AC-3.4: 生成 SO 时，自动根据命名规范重命名文件（例如 Equip_100_LeatherHelm）。

2. 编写 design.md (设计文档)
文件名: .kiro/specs/999_全面重构_26.01.27/3_装备与工具/design.md

必须包含以下类图设计与逻辑流：

2.1 数据继承树 (The Hierarchy)

代码段

classDiagram
    ItemData <|-- UseableItemData
    ItemData <|-- EquipmentData
    ItemData <|-- PlaceableItemData
    ItemData <|-- MaterialData
    
    UseableItemData <|-- ToolData
    UseableItemData <|-- WeaponData
    UseableItemData <|-- ConsumableData
    
    class ItemData { +ID +Name +Icon +MaxStack +Rarity }
    class EquipmentData { +EquipSlot +Defense +SetBonusID +ModelPrefab }
    class PlaceableItemData { +WorldPrefab +Size +CanRotate }
2.2 装备数据结构 (EquipmentData Definition)

字段:

EquipmentType equipmentType (Helmet, Body, Legs, Feet, Ring, Necklace)

int defense (基础防御)

List<StatModifier> implicitStats (固定词条，如 +5 力量)

GameObject equipmentModel (纸娃娃系统预留)

2.3 编辑器工具架构 (Editor Tool Architecture)

不再使用单一的大文件 Tool_BatchItemSOGenerator.cs。

采用策略模式 (Strategy Pattern)：

ItemGeneratorBase: 抽象基类，处理通用 UI（路径选择、图标拖拽）。

EquipmentGenerator : ItemGeneratorBase: 绘制装备特有字段，生成 EquipmentData。

WeaponGenerator : ItemGeneratorBase: 绘制武器字段。

AssetFactoryWindow: 主窗口，只负责切换不同的 Generator 实例。

3. 编写 tasks.md (宇宙级任务清单)
文件名: .kiro/specs/999_全面重构_26.01.27/3_装备与工具/tasks.md

这是最重要的部分，必须按此执行：

Stage 1: 数据层重构 (Data Layer Refactoring)

[ ] 1.1 基类清洗

检查 ItemData.cs，标记所有不属于通用的字段为 [Obsolete] (暂不删除防报错，稍后迁移)。

创建 UseableItemData.cs (抽象类)，将冷却、动画等字段移入。

[ ] 1.2 装备类定义

创建 EquipmentData.cs (继承 ItemData)。

添加字段：EquipmentType, Defense, Attributes。

创建测试用 SO：Test_Helmet, Test_Armor 验证数据结构。

[ ] 1.3 其他子类规范化

确认 PlaceableItemData 继承结构是否正确。

确认 ConsumableData (如果存在) 的字段完整性。

Stage 2: 装备服务升级 (Service Upgrade)

[ ] 2.1 数据核替换

修改 EquipmentService.cs。

将 ItemStack[] equips 替换为 InventoryItem[] equips。

编译修复：修复因类型改变导致的 GetEquip, SetEquip 报错。

[ ] 2.2 持久化实现

让 EquipmentService 实现 IPersistentObject。

实现 CaptureState(): 序列化 InventoryItem 数组。

实现 RestoreState(): 反序列化数据。

[ ] 2.3 注册与验证

在 Start() 中调用 PersistentObjectRegistry.Instance.Register(this)。

验证测试：穿装备 -> 保存 -> 重启 -> 装备还在。

Stage 3: 编辑器工具重构 (The Tool Revolution)

[ ] 3.1 架构搭建

创建 Assets/Editor/Factory/ 文件夹。

创建 AssetFactoryWindow.cs (主窗口框架)。

创建 GeneratorStrategy.cs (抽象基类)。

[ ] 3.2 装备生成器实现

创建 EquipmentGenerator.cs。

实现 UI：绘制防御力、槽位等输入框。

实现逻辑：ScriptableObject.CreateInstance<EquipmentData>()。

[ ] 3.3 迁移旧功能

将原 Tool_BatchItemSOGenerator 中的 Tool/Weapon 生成逻辑迁移为 WeaponGenerator.cs 和 ToolGenerator.cs。

目标：彻底废弃旧的 Tool_BatchItemSOGenerator.cs。

Stage 4: 整合与收尾 (Integration)

[ ] 4.1 UI 适配

修改 EquipmentSlotUI.cs，使其能正确读取 InventoryItem (及底层的 EquipmentData) 并显示图标。

暂时不需要做复杂的属性显示 UI，只要能看到图标就行。

[ ] 4.2 批量生成测试

使用新工具生成一套“皮甲套装” (头、身、腿、鞋)。

在游戏中尝试装备这套新生成的物品。

执行口令： 先写文档，文档通过后再写代码。 Go.