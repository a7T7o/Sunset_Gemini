
# ğŸš€ PROJECT YYY: ç¼–å¹´å²ä¸äº¤æ¥åè®® (The Grand Handover Protocol)



**è‡´ç»§ä»»è€… (To the Next Gemini):**

ä½ æ­£åœ¨æ¥æ‰‹ä¸€ä¸ªå¤„äº **å…³é”®é‡æ„æœŸ (Phase 3.5)** çš„ Unity å†œåœºæ¨¡æ‹Ÿç»è¥é¡¹ç›®ã€‚

æ­¤é¡¹ç›®è¦æ±‚æé«˜ï¼š**å®‡å®™çº§è¯¦ç»†**ã€**ä¸¥è°¨çš„åŸå­æ€§é€»è¾‘**ã€**é«˜åº¦è‡ªåŠ¨åŒ–**ã€‚

å‰ä»»åŠ©æ‰‹ï¼ˆæˆ‘ï¼‰å› ä¸Šä¸‹æ–‡è¿·å¤±å’Œé€»è¾‘è‰ç‡è¢«æ’¤èŒã€‚è¯·ä»”ç»†ç ”è¯»ä»¥ä¸‹å†å²ä¸è§„åˆ™ï¼Œ**ä¸è¦é‡è¹ˆè¦†è¾™**ã€‚



---



## ğŸ›‘ æ ¸å¿ƒè­¦ç¤º (Critical Warnings)



1.  **åˆ‡å‹¿è‡ªä»¥ä¸ºæ˜¯**ï¼šä¸çŸ¥é“æ–‡ä»¶è·¯å¾„å°±é—®ï¼Œä¸è¦ççŒœï¼ˆä¾‹å¦‚ï¼šä¸è¦å¹»æƒ³æœ‰ `Assets/YYY_Scripts/World/Tree/` è¿™ç§è·¯å¾„ï¼Œé™¤éä½ çœ‹åˆ°äº†ï¼‰ã€‚

2.  **æ–‡æ¡£å³æ³•å¾‹**ï¼šä»»ä½•ä»£ç æ”¹åŠ¨å‰ï¼Œå¿…é¡»å…ˆæ›´æ–° `.kiro/specs/` ä¸‹çš„ `requirements`, `design`, `tasks`ã€‚

3.  **ç¦æ­¢ç¡¬ç¼–ç é…ç½®**ï¼šèƒ½é€šè¿‡ä»£ç è®¡ç®—çš„ï¼ˆå¦‚æ”¾ç½®ç‰©çš„ GridSize ç¢°æ’å¤§å°ï¼‰ï¼Œç»å¯¹ç¦æ­¢åœ¨ ScriptableObject (SO) é‡Œæ‰‹åŠ¨é…ç½®ã€‚

4.  **æ•°æ®çº¯å‡€æ€§**ï¼šSO æ˜¯é™æ€æ•°æ®ã€‚`ItemData` ç›®å‰æ˜¯é‡ç¾åŒºï¼Œå¿…é¡»æ¸…æ´—ã€‚

5.  **äº¤äº’åŸå­æ€§**ï¼šä»»ä½•ç‰©å“ç§»åŠ¨/äº¤æ¢ï¼Œå¿…é¡»éµå¾ªâ€œéªŒè¯ -> æäº¤ -> å¤±è´¥å›æ»šâ€çš„äº‹åŠ¡é€»è¾‘ã€‚



---



## ğŸ“… é¡¹ç›®ç¼–å¹´å² (The Chronicle)



### ğŸ›ï¸ Phase 1: æ··æ²Œåˆå¼€ (The Foundation)

* **æ‘˜è¦**ï¼šå»ºç«‹äº†åŸºç¡€çš„èƒŒåŒ… (`InventoryService`)ã€ç®±å­ (`ChestInventory`) å’Œç‰©å“æ•°æ®åº“ (`ItemDatabase`)ã€‚

* **é—ç•™é—®é¢˜**ï¼šæ•°æ®ç»“æ„æ··ä¹±ï¼ˆ`ItemStack` vs `InventoryItem`ï¼‰ï¼Œå­˜æ¡£ä¸¢å¤±ï¼Œäº¤äº’é€»è¾‘å­˜åœ¨åç‰©å“ Bugã€‚



### ğŸ› ï¸ Phase 2: äº¤äº’é‡æ„ (Interaction Refactor)

* **æ ¸å¿ƒæˆ˜å½¹**ï¼š

    * **ç®±å­/èƒŒåŒ…äº’æ–¥**ï¼šè§£å†³äº† BoxUI å’Œ InventoryUI çš„çŠ¶æ€å†²çªã€‚

    * **é˜²åé€»è¾‘**ï¼šä¿®å¤äº†â€œæ‰‹æŒç‰©å“å…³é—­ UI å¯¼è‡´ç‰©å“æ¶ˆå¤±â€çš„é—®é¢˜ï¼ˆå›æ»šé€»è¾‘ï¼‰ã€‚

    * **æ‹†åˆ†ç®—æ³•**ï¼šä¿®å¤äº† Ctrl/Shift æ‹†åˆ†ç‰©å“æ—¶çš„æ•°å­¦é”™è¯¯ã€‚

    * **æ•°æ®åŒæ­¥**ï¼šä¿®å¤äº† `ChestController` (UIå±‚) å’Œ `ChestInventoryV2` (å­˜æ¡£å±‚) çš„â€œåŒè„‘è£‚â€é—®é¢˜ï¼Œå¼•å…¥äº† `SyncInventoryToV2`ã€‚

* **å…³é”®äº§å‡º**ï¼š`InventorySlotInteraction.cs` (å…¨èƒ½äº¤äº’ç»„ä»¶), `SlotDragContext.cs` (è·¨å®¹å™¨æ‹–æ‹½ä¸Šä¸‹æ–‡)ã€‚



### âš”ï¸ Phase 3: å†›ç«åº“è¡ŒåŠ¨ (Operation Arsenal) - *åˆšåˆšç»“æŸ*

* **ç›®æ ‡**ï¼šæ„å»ºè£…å¤‡ç³»ç»Ÿä¸æ‰¹é‡ç”Ÿæˆå·¥å…·ã€‚

* **å…³é”®å†³ç­–**ï¼š

    * **æ¸è¿›å¼é‡æ„**ï¼šä¿ç•™ `ItemData` åŸºç±»ï¼Œæ–°å»º `EquipmentData : ItemData`ï¼Œé¿å…èµ„äº§ä¸¢å¤±ã€‚

    * **æŒä¹…åŒ–å‡çº§**ï¼š`EquipmentService` å®ç°äº† `IPersistentObject`ï¼Œå†…éƒ¨æ•°æ®ç»“æ„å‡çº§ä¸º `InventoryItem[]`ã€‚

* **è¸©å‘è®°å½•ï¼ˆé‡ç‚¹é˜…è¯»ï¼‰**ï¼š

    * **åºåˆ—åŒ–ç¾éš¾**ï¼šåœ¨ `EquipmentData` ä¸­ä½¿ç”¨äº† `new` å…³é”®å­—è¦†ç›–åŸºç±»å­—æ®µï¼Œå¯¼è‡´ Unity åºåˆ—åŒ–å´©æºƒï¼Œæ‹–æ‹½ç‰©å“æ¶ˆå¤±ã€‚**å·²ä¿®å¤ï¼ˆåˆ é™¤äº† new å­—æ®µï¼‰**ã€‚

    * **é€»è¾‘åå™¬**ï¼šæ‹–æ‹½åˆ°è£…å¤‡æ æ—¶ï¼Œå›  `CurrentContainer` ä¸º null ä¸”æœªå¤„ç†å›æ»šï¼Œå¯¼è‡´ç‰©å“æ¶ˆå¤±ã€‚**å·²ä¿®å¤ï¼ˆæ·»åŠ äº† HandleDropToEquipmentSlot å’Œ Cancel å›æ»šï¼‰**ã€‚



---



## ğŸ”¥ å½“å‰æˆ˜å†µï¼šPhase 3.5 å¤§æ¸…æ´— (The Great Purge)



**å½“å‰å¤„äºåœå·¥æ•´é¡¿çŠ¶æ€ã€‚** å‰ä»»ï¼ˆæˆ‘ï¼‰åªé¡¾å †ç ŒåŠŸèƒ½ï¼Œç•™ä¸‹äº†å¤§é‡æŠ€æœ¯å€ºåŠ¡ã€‚ç»§ä»»è€…å¿…é¡»ä¼˜å…ˆæ‰§è¡Œä»¥ä¸‹**å€ºåŠ¡æ¸…ç®—**ï¼š



### 1. æ•°æ®å±‚å‡€åŒ– (Data Cleanup)

* **ç°çŠ¶**ï¼š`EquipmentData` çš„ Inspector é¢æ¿é‡Œæ··æ‚äº† `Placement Config`ï¼ˆå åœ°ï¼‰ã€`Consumable Config`ï¼ˆå›è¡€ï¼‰ï¼Œéå¸¸ä¸ä¸“ä¸šã€‚

* **ä»»åŠ¡**ï¼š

    * ç¼–å†™ `ItemDataEditor` (Custom Editor)ã€‚æ ¹æ® `ItemCategory` åŠ¨æ€éšè—ä¸ç›¸å…³çš„å­—æ®µã€‚

    * ç¡®ä¿ `Equipment` æ˜¯ç‹¬ç«‹çš„ä¸€çº§åˆ†ç±»ï¼Œä¸å†å¯„ç”Ÿäº `Special` ä¸‹ã€‚

    * æ˜ç¡® `equipmentModel` å­—æ®µç”¨é€”ï¼ˆçº¸å¨ƒå¨ƒç³»ç»Ÿï¼‰ï¼Œå¹¶æ·»åŠ æ¸…æ™°æ³¨é‡Šã€‚



### 2. å­˜æ¡£ç³»ç»Ÿè¡¥å®Œ (Persistence Completion)

* **ç°çŠ¶**ï¼šåªå­˜äº†ç®±å­å’ŒèƒŒåŒ…ã€‚ç¯å¢ƒï¼ˆæ ‘/çŸ³ï¼‰ã€æ—¶é—´ã€ç§ç”°çŠ¶æ€éƒ½æ²¡å­˜ã€‚

* **ä»»åŠ¡**ï¼š

    * åˆ¶å®šã€Šå¯å­˜å‚¨å¯¹è±¡å¼€å‘è§„èŒƒã€‹ã€‚

    * å®ç°ç¯å¢ƒç‰©ä½“ï¼ˆTree/Rockï¼‰çš„çŠ¶æ€ä¿å­˜ï¼ˆID + Active + Health + **SeasonState**ï¼‰ã€‚

    * **Tool ç‰¹ä¾‹**ï¼šSaveManager åœ¨ä¿å­˜ Player æ—¶ï¼Œå¿…é¡»**ç¡¬ç¼–ç æ’é™¤** `Tool` å­ç‰©ä½“çš„ Transform åŒæ­¥ï¼ˆå®ƒæ˜¯ 0 åç§»è·Ÿéšçš„ï¼‰ã€‚

    * **Load åˆ·æ–°**ï¼šLoad å®Œæ¯•åï¼Œå¿…é¡»å¼ºåˆ¶è°ƒç”¨ `ToolbarUI.Refresh()` å’Œ `InventoryPanelUI.Refresh()`ï¼Œä¸èƒ½ç­‰ç©å®¶æŒ‰ Tabã€‚



### 3. ç§ç”°æ ¸å¿ƒä¿®å¤ (Farming Fixes)

* **ç°çŠ¶**ï¼šæ´’æ°´å£¶åˆ¤å®šä¾ç„¶æ˜¯å°„çº¿æ£€æµ‹ï¼ˆæ˜“è¢«é®æŒ¡ï¼‰ï¼Œä¸”æ— è·ç¦»é™åˆ¶ã€‚

* **ä»»åŠ¡**ï¼š

    * é‡æ„ `WateringTool`ï¼Œæ”¹ä¸ºåŸºäº Grid çš„æ£€æµ‹ã€‚

    * æ˜ç¡®ç§å­æ•°æ®çš„ SO ç»“æ„ï¼ˆå»ºç«‹ `SeedItemData`ï¼‰ã€‚



---



## ğŸ“œ ç»å¯¹è¡Œä¸ºå‡†åˆ™ (The Constitution)



1.  **SO çº¯å‡€åŸåˆ™**ï¼šSO åªå­˜é™æ€æ•°æ®ã€‚ä¸è¦æŠŠ `GridSize` è¿™ç§èƒ½ç®—å‡ºæ¥çš„ä¸œè¥¿å†™è¿›å»ã€‚

2.  **åŸå­æ€§åŸåˆ™**ï¼š

    * **Save**: å¿…é¡»éå†è°ƒç”¨ `PrepareForSerialization`ã€‚

    * **Load**: å¿…é¡»è°ƒç”¨ `OnAfterDeserialize`ã€‚

    * **Drag**: å¿…é¡»åŒ…å« `Cancel/Return` é€»è¾‘ã€‚

3.  **å·¥ä½œæµ**ï¼š

    * æ¥åˆ°ä»»åŠ¡ -> ç´¢è¦æ–‡ä»¶ç›®å½•ç»“æ„ï¼ˆé˜²æ­¢ççŒœï¼‰-> æ›´æ–° `specs` æ–‡æ¡£ -> å®¡æ ¸é€šè¿‡ -> å†™ä»£ç ã€‚

4.  **æ’ç‰ˆ**ï¼š

    * è¾“å‡ºå¿…é¡»æ¸…æ™°ã€ç¾è§‚ã€‚ä½¿ç”¨åˆ†å‰²çº¿ã€ç¼©è¿›ã€Emoji æ ‡è®°çŠ¶æ€ã€‚

    * ä¸è¦è‰ç‡ï¼Œä¸è¦ç®€çŸ­ã€‚è¦â€œå®‡å®™çº§è¯¦ç»†â€ã€‚



---



## ğŸ“‚ å…³é”®æ–‡ä»¶æŒ‡å¼• (The Map)



* **äº¤äº’æ ¸å¿ƒ**ï¼š

    * `Assets/YYY_Scripts/UI/Inventory/InventorySlotInteraction.cs` (äº¤äº’é€»è¾‘å¤§æœ¬è¥)

    * `Assets/YYY_Scripts/UI/Inventory/InventoryInteractionManager.cs` (ç®¡ç†å™¨)

    * `Assets/YYY_Scripts/UI/Inventory/SlotDragContext.cs` (æ‹–æ‹½ä¸Šä¸‹æ–‡)

* **æ•°æ®æ ¸å¿ƒ**ï¼š

    * `Assets/YYY_Scripts/Data/Items/ItemData.cs` (åŸºç±»ï¼Œè„ä¹±å·®æºå¤´)

    * `Assets/YYY_Scripts/Data/Items/EquipmentData.cs` (æ–°å»ºç«‹çš„å­ç±»)

    * `Assets/Editor/Tool_BatchItemSOGenerator.cs` (æ‰¹é‡ç”Ÿæˆå·¥å…·)

* **å­˜æ¡£æ ¸å¿ƒ**ï¼š

    * `Assets/YYY_Scripts/Data/Core/SaveManager.cs`

    * `Assets/YYY_Scripts/Service/Inventory/ChestInventoryV2.cs` (æ ‡å‡†å‚è€ƒèŒƒä¾‹)



---



**æœ€åå˜±æ‰˜ï¼š**

è€å¤§éœ€è¦çš„æ˜¯ä¸€ä¸ª**æœ‰ç‹¬ç«‹æ€è€ƒèƒ½åŠ›ã€èƒ½æŸ¥æ¼è¡¥ç¼ºçš„æ¶æ„å¸ˆ**ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªåªä¼šå†™ `if-else` çš„ç å†œã€‚

å½“ä½ å‘ç°éœ€æ±‚æœ‰æ¼æ´ï¼ˆæ¯”å¦‚â€œè£…å¤‡æ€ä¹ˆæ²¡ç®—å±æ€§ï¼Ÿâ€ï¼‰ï¼Œè¯·ç«‹åˆ»æå‡ºæ¥ï¼Œè€Œä¸æ˜¯è£…ä½œæ²¡çœ‹è§ã€‚



**Good luck, Agent.**