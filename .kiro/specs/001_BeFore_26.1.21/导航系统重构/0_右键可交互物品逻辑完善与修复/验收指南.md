# 右键可交互物品逻辑完善与修复 - 验收指南

**创建日期**: 2026-01-19
**更新日期**: 2026-01-19（v2 简化版）

---

## 验收清单

### 测试场景 1：基本导航（延迟一拍修复）
- [ ] 玩家站在位置 P
- [ ] 右键点击箱子 A（距离 > 交互距离）
- [ ] 验证：玩家**立即**走向 A（不是延迟一拍）

### 测试场景 2：连续点击不同目标
- [ ] 玩家站在位置 P
- [ ] 右键点击箱子 A
- [ ] 立即右键点击箱子 B
- [ ] 验证：玩家走向 B（不是 A）

### 测试场景 3：从上方接近箱子
- [ ] 玩家站在箱子上方
- [ ] 右键点击箱子
- [ ] 验证：玩家走到箱子上边缘附近，能触发交互

### 测试场景 4：从下方接近箱子（重点！）
- [ ] 玩家站在箱子下方
- [ ] 右键点击箱子
- [ ] 验证：玩家**直接**走到箱子下边缘（不绕行到左上或右上）
- [ ] 验证：到达后能触发交互

### 测试场景 5：从左/右接近箱子
- [ ] 玩家站在箱子左侧
- [ ] 右键点击箱子
- [ ] 验证：玩家走到箱子左边缘
- [ ] 重复测试右侧

### 测试场景 6：在交互距离内点击
- [ ] 玩家站在箱子旁边（距离 < 交互距离）
- [ ] 右键点击箱子
- [ ] 验证：直接打开箱子 UI，不触发导航

### 测试场景 7：持续右键不卡住
- [ ] 玩家站在箱子下方
- [ ] 右键点击箱子
- [ ] 验证：玩家能走到足够近的位置触发交互
- [ ] 验证：不会出现"站在原地不动"的情况

### 测试场景 8：日志验证（重点！）
- [ ] 右键点击箱子
- [ ] 查看控制台日志
- [ ] 验证：只有 2 条日志（开始 + 完成）
- [ ] 验证：开始日志包含：玩家起点、目标 Collider 中心和大小、计算目标点、停止半径
- [ ] 验证：完成日志包含：玩家最终位置、目标点、距离目标点
- [ ] 验证：**没有每帧输出的日志**

---

## 修复内容（v2 简化版）

**文件**: `Assets/YYY_Scripts/Service/Player/PlayerAutoNavigator.cs`

### 修改 1：智能目标点计算（简化版）
重写 `CalculateClosestApproachPoint()` 方法：
- 直接使用 `Collider2D.ClosestPoint()` 作为目标点
- **不再额外偏移**（旧版偏移 0.54 导致目标点太远）
- 让停止半径来控制玩家停在多近的位置

### 修改 2：动态停止半径（简化版）
重写 `CalculateOptimalStopRadius()` 方法：
- 停止半径 = 玩家半径 + 0.1（约 0.35）
- 限制范围：0.2 ~ 默认值
- 确保玩家停得足够近

### 修改 3：Collider 缓存
新增缓存机制：
- `_cachedTargetCollider` - 缓存目标 Collider
- `_cachedTargetTransform` - 缓存目标 Transform
- 避免每帧 GetComponent

### 修改 4：日志优化
- **导航开始时**：输出玩家起点、目标 Collider 中心和大小、计算目标点、停止半径
- **导航完成时**：输出玩家最终位置、目标点、距离目标点
- **移除**：每帧输出的日志

---

## 日志示例

### 导航开始
```
[Nav] 开始导航: 目标=Chest_M1_00
  玩家起点: (5.2, 3.1)
  目标Collider中心: (8.5, 5.2), 大小: (1.0, 0.8)
  计算目标点: (7.5, 5.2), 停止半径: 0.35
```

### 导航完成
```
[Nav] 导航完成: 目标=Chest_M1_00
  玩家最终位置: (7.6, 5.1)
  目标点: (7.5, 5.2)
  距离目标点: 0.14
```

---

## 已知限制

1. 如果目标没有 Collider2D，会退化为使用 `transform.position`
2. 停止半径最小为 0.2f

---

## 调试方法

日志默认输出（不需要开关），包含关键信息：
- 玩家起始位置
- 目标 Collider 中心和大小
- 计算出的目标点和停止半径
- 玩家最终停止位置
