# 丢弃物预制体统一 - 验收指南

## 功能验收清单

### 1. 丢弃物使用正确的 WorldItem Prefab

- [ ] **测试 1.1**：从背包丢弃有 worldPrefab 的物品（如树苗）
  - 预期：掉落物显示正确的阴影效果
  - 预期：掉落物播放正确的浮动动画
  - 预期：控制台输出 `[WorldItemPool] 使用 worldPrefab 实例化 itemId=X`
  
- [ ] **测试 1.2**：从背包丢弃没有 worldPrefab 的物品
  - 预期：使用默认预制体（程序生成的椭圆阴影）
  - 预期：控制台输出警告 `[WorldItemPool] itemId=X 没有 worldPrefab，使用默认预制体`
  
- [ ] **测试 1.3**：砍树掉落物品
  - 预期：掉落物显示正确的阴影效果
  - 预期：掉落物播放正确的浮动动画

### 2. 对象池按 itemId 分类管理

- [ ] **测试 2.1**：丢弃多个相同物品后拾取
  - 预期：控制台输出 `[WorldItemPool] 从 itemId=X 池中获取`
  - 预期：控制台输出 `[WorldItemPool] 回收到 itemId=X 池，当前池大小=Y`
  
- [ ] **测试 2.2**：丢弃多种不同物品
  - 预期：每种物品有独立的池
  - 预期：使用 Context Menu "显示池状态" 可以看到分类池信息

### 3. 对象池容量管理

- [ ] **测试 3.1**：丢弃大量相同物品（超过 maxPoolSizePerItem）
  - 预期：超出容量的物品被销毁
  - 预期：控制台输出 `[WorldItemPool] itemId=X 池已满，销毁物品`
  
- [ ] **测试 3.2**：检查内存泄漏
  - 预期：大量丢弃/拾取操作后，内存使用稳定

## 对比测试

### 丢弃物 vs 砍树掉落物

- [ ] **测试 C.1**：对比外观
  - 丢弃树苗 vs 砍树掉落树苗
  - 预期：两者外观完全一致（阴影、大小、动画）
  
- [ ] **测试 C.2**：对比拾取
  - 预期：两者拾取行为一致

## 测试步骤说明

### 准备工作

1. 打开 Unity 编辑器
2. 加载测试场景
3. 确保场景中有：
   - 玩家角色
   - 背包系统
   - 树木（用于测试砍树掉落）
   - 多种物品（有 worldPrefab 和没有 worldPrefab 的）

### 测试流程

1. **测试丢弃物**：
   - 打开背包
   - 拖拽物品到面板外丢弃
   - 观察掉落物的外观（阴影、动画）
   - 检查控制台日志

2. **测试砍树掉落**：
   - 砍倒一棵树
   - 观察掉落物的外观
   - 对比与丢弃物的差异

3. **测试对象池**：
   - 丢弃多个相同物品
   - 拾取这些物品
   - 再次丢弃
   - 检查控制台日志，确认从池中获取

4. **测试容量限制**：
   - 丢弃大量相同物品（超过 10 个）
   - 检查控制台日志，确认池已满时销毁物品

### 调试日志检查

测试时应该看到以下日志：

- `[WorldItemPool] 使用 worldPrefab 实例化 itemId=X`
- `[WorldItemPool] 从 itemId=X 池中获取`
- `[WorldItemPool] 回收到 itemId=X 池，当前池大小=Y`
- `[WorldItemPool] itemId=X 池已满，销毁物品`
- `[WorldItemPool] itemId=X 没有 worldPrefab，使用默认预制体`

### Context Menu 检查

在 WorldItemPool 组件上右键，选择 "显示池状态"：

```
[WorldItemPool] 活跃: X, 池中总计: Y (默认池: Z, 分类池: N 种)
  - itemId=100: 3 个
  - itemId=101: 5 个
  ...
```

## 已知限制

- 如果 ItemData 没有设置 worldPrefab，会使用默认预制体（程序生成的简单阴影）
- 每种物品类型的池大小限制为 `maxPoolSizePerItem`（默认 10）

## 注意事项

1. **worldPrefab 配置**：
   - 确保 ItemData 的 worldPrefab 字段已正确配置
   - worldPrefab 必须包含 WorldItemPickup 组件

2. **阴影对比**：
   - 预先生成的 worldPrefab 阴影：使用 Sprite 资源
   - 默认预制体阴影：程序生成的椭圆（较简单）

3. **性能监控**：
   - 使用 Unity Profiler 监控内存使用
   - 确认对象池正常工作，没有内存泄漏

## 验收标准

✅ **通过标准**：
- 所有测试项通过
- 丢弃物与砍树掉落物外观一致
- 对象池正常工作，日志输出正确
- 无内存泄漏

❌ **失败标准**：
- 丢弃物没有阴影或阴影不正确
- 对象池未按 itemId 分类
- 出现内存泄漏
- 控制台有错误日志
