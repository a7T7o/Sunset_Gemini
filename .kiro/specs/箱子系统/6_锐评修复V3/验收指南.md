# 箱子 UI 锐评修复 V3 - 验收指南

## 验收清单

### 修复 1：Down 区 Sort

- [ ] 打开箱子 UI
- [ ] 点击 Sort Down 按钮
- [ ] **预期**：背包区域（Down）物品重新排序，UI 立即刷新

### 修复 2：垃圾桶

#### 2.1 背包物品丢弃
- [ ] 打开箱子 UI
- [ ] 点击背包区域（Down）的物品拿起
- [ ] 点击垃圾桶按钮
- [ ] **预期**：物品被丢弃到玩家脚下，手上物品清空

#### 2.2 箱子物品丢弃
- [ ] 打开箱子 UI
- [ ] 拖拽箱子区域（Up）的物品
- [ ] 点击垃圾桶按钮
- [ ] **预期**：物品被丢弃到玩家脚下，拖拽状态清空

### 修复 3：点击拿起

- [ ] 打开背包 UI（Tab）
- [ ] 单击（无修饰键）非空槽位
- [ ] **预期**：物品被拿起，图标跟随鼠标
- [ ] 单击另一个槽位
- [ ] **预期**：物品被放置到目标槽位

### 修复 4：导航距离

- [ ] 关闭所有 UI
- [ ] 右键点击远处的箱子（距离 > 1.5 单位）
- [ ] **预期**：玩家先导航到箱子附近，然后打开箱子 UI
- [ ] 右键点击近处的箱子（距离 < 1.5 单位）
- [ ] **预期**：直接打开箱子 UI，不导航

### 修复 5：Box 打开时右键另一个箱子

- [ ] 打开箱子 A 的 UI
- [ ] 右键点击远处的箱子 B
- [ ] **预期**：关闭箱子 A 的 UI，导航到箱子 B，然后打开箱子 B 的 UI

---

## 回归测试

### 背包基本功能
- [ ] Tab 打开/关闭背包
- [ ] Shift+点击 二分拿取
- [ ] Ctrl+点击 单个拿取
- [ ] 拖拽物品交换位置
- [ ] 拖拽到面板外丢弃

### 箱子基本功能
- [ ] 右键点击箱子打开 UI
- [ ] ESC 关闭箱子 UI
- [ ] Up→Up 拖拽（箱子内交换）
- [ ] Up→Down 拖拽（箱子到背包）
- [ ] Down→Up 拖拽（背包到箱子）
- [ ] Sort Up 整理箱子
- [ ] Sort Down 整理背包

---

## 已知限制

1. 点击拿起使用 `State.HeldByShift` 状态，行为与 Shift+点击相同
2. 导航距离使用 Collider 底部中心计算，如果物体没有 Collider 则使用 Transform 位置

---

## 修改文件清单

| 文件 | 修改内容 |
|------|---------|
| `BoxPanelUI.cs` | 订阅 InventoryService.OnInventoryChanged，实现垃圾桶逻辑 |
| `InventoryInteractionManager.cs` | 恢复 HandleIdleClick 无修饰键分支 |
| `GameInputManager.cs` | 使用 Collider 底部中心计算距离 |
