# éªŒæ”¶æŒ‡å— - ç®±å­æ ·å¼ä¸äº¤äº’å®Œå–„

## åŠŸèƒ½éªŒæ”¶æ¸…å•

### 1. æ•°æ®ç»“æ„éªŒæ”¶

- [ ] **ChestOrigin æšä¸¾**
  - åœ¨ `PlacementEnums.cs` ä¸­å­˜åœ¨ `ChestOrigin` æšä¸¾
  - åŒ…å« `PlayerCrafted` å’Œ `WorldSpawned` ä¸¤ä¸ªå€¼

- [ ] **KeyLockData å¼€é”æ¦‚ç‡**
  - `KeyLockData.cs` åŒ…å« `unlockChance` å­—æ®µ
  - åŒ…å« `GetDefaultUnlockChanceByTier` é™æ€æ–¹æ³•

- [ ] **StorageData è¢«å¼€é”æ¦‚ç‡**
  - `StorageData.cs` åŒ…å« `baseUnlockChance` å­—æ®µ
  - é»˜è®¤å€¼ä¸º 0.6

### 2. ChestController åŠŸèƒ½éªŒæ”¶

- [ ] **æ¥æºä¸å½’å±å­—æ®µ**
  - Inspector ä¸­æ˜¾ç¤º `origin` å­—æ®µ
  - Inspector ä¸­æ˜¾ç¤º `hasBeenLocked` å­—æ®µ

- [ ] **CanBeMinedOrMoved æ–¹æ³•**
  - é‡å¤–ä¸Šé”ç®±å­è¿”å› false
  - é‡å¤–å·²å¼€é”ç®±å­è¿”å› false
  - ç©å®¶ç®±å­è¿”å› true

- [ ] **TryLockByPlayer æ–¹æ³•**
  - å·²ä¸Šè¿‡é”çš„ç®±å­è¿”å› AlreadyLocked
  - æˆåŠŸä¸Šé”å hasBeenLocked å˜ä¸º true
  - é‡å¤–æœªé”ç®±å­ä¸Šé”å ownership å˜ä¸º Player

- [ ] **TryUnlockWithKey æ–¹æ³•**
  - ç©å®¶ç®±å­è¿”å› AlreadyOwned
  - æ¦‚ç‡è®¡ç®—æ­£ç¡®ï¼ˆé’¥åŒ™æ¦‚ç‡ + ç®±å­æ¦‚ç‡ï¼‰
  - æˆåŠŸå isLocked å˜ä¸º false

### 3. æ‰¹é‡ç”Ÿæˆå·¥å…·éªŒæ”¶

- [ ] **é’¥åŒ™ç±»å‹æ”¯æŒ**
  - å·¥å…·è£…å¤‡å¤§ç±»ä¸‹æ˜¾ç¤º"é’¥åŒ™"é€‰é¡¹
  - é€‰æ‹©é’¥åŒ™åæ˜¾ç¤ºæè´¨å’Œæ¦‚ç‡è®¾ç½®
  - æè´¨åˆ‡æ¢æ—¶è‡ªåŠ¨æ›´æ–°é»˜è®¤æ¦‚ç‡

- [ ] **ç”Ÿæˆ KeyLockData**
  - ç”Ÿæˆçš„ SO ç±»å‹ä¸º KeyLockData
  - keyLockType è®¾ç½®ä¸º Key
  - unlockChance è®¾ç½®æ­£ç¡®

## æµ‹è¯•æ­¥éª¤

### æµ‹è¯• 1ï¼šé‡å¤–ä¸Šé”ç®±å­ä¸å¯æŒ–å–

1. åœ¨åœºæ™¯ä¸­æ”¾ç½®ä¸€ä¸ªç®±å­
2. åœ¨ Inspector ä¸­è®¾ç½®ï¼š
   - `origin` = WorldSpawned
   - `isLocked` = true
   - `hasBeenLocked` = true
3. è¿è¡Œæ¸¸æˆï¼Œç”¨é•å­æ”»å‡»ç®±å­
4. **é¢„æœŸç»“æœ**ï¼šç®±å­åªæŠ–åŠ¨ï¼Œä¸å—ä¼¤å®³ï¼Œä¸è¢«æ¨åŠ¨

### æµ‹è¯• 2ï¼šç©å®¶ç®±å­å¯æŒ–å–

1. åœ¨åœºæ™¯ä¸­æ”¾ç½®ä¸€ä¸ªç®±å­
2. åœ¨ Inspector ä¸­è®¾ç½®ï¼š
   - `origin` = PlayerCrafted
   - `isLocked` = true
   - `hasBeenLocked` = true
3. è¿è¡Œæ¸¸æˆï¼Œç”¨é•å­æ”»å‡»ç©ºç®±å­
4. **é¢„æœŸç»“æœ**ï¼šç®±å­å—ä¼¤å®³ï¼Œè¡€é‡å½’é›¶åé”€æ¯

### æµ‹è¯• 3ï¼šå¼€é”æ¦‚ç‡ç³»ç»Ÿ

1. åˆ›å»ºä¸€ä¸ª KeyLockData SOï¼ˆé’¥åŒ™ç±»å‹ï¼‰
2. è®¾ç½® `unlockChance` = 0.4ï¼ˆé‡‘é’¥åŒ™ï¼‰
3. åˆ›å»ºä¸€ä¸ª StorageData SO
4. è®¾ç½® `baseUnlockChance` = 0.6ï¼ˆæœ¨ç®±ï¼‰
5. åœ¨ä»£ç ä¸­è°ƒç”¨ `TryUnlockWithKey`
6. **é¢„æœŸç»“æœ**ï¼šæ€»æ¦‚ç‡ä¸º 1.0ï¼Œå¿…å®šæˆåŠŸ

### æµ‹è¯• 4ï¼šæ‰¹é‡ç”Ÿæˆé’¥åŒ™

1. æ‰“å¼€ `Tools â†’ ğŸ“¦ æ‰¹é‡ç”Ÿæˆç‰©å“ SO`
2. é€‰æ‹©å¤§ç±»"å·¥å…·è£…å¤‡"
3. é€‰æ‹©å°ç±»"é’¥åŒ™"
4. é€‰æ‹©æè´¨"é‡‘"
5. ç¡®è®¤æ¦‚ç‡è‡ªåŠ¨è®¾ç½®ä¸º 0.4
6. é€‰æ‹©ä¸€ä¸ª Spriteï¼Œç‚¹å‡»ç”Ÿæˆ
7. **é¢„æœŸç»“æœ**ï¼šç”Ÿæˆ KeyLockData SOï¼ŒunlockChance = 0.4

## å·²çŸ¥é™åˆ¶

1. **é’¥åŒ™æè´¨ä¸ç®±å­æè´¨æ˜ å°„**
   - æœ¨/çŸ³é’¥åŒ™ â†’ æœ¨ç®±
   - é“/é“œ/é’¢é’¥åŒ™ â†’ é“ç®±
   - é‡‘é’¥åŒ™ â†’ ç‰¹æ®Šç®±

2. **å¼€é”æ¦‚ç‡ä¸Šé™**
   - å½“å‰æ²¡æœ‰ä¸Šé™ï¼Œé‡‘é’¥åŒ™+æœ¨ç®± = 100% æˆåŠŸ
   - å¦‚éœ€è°ƒæ•´ï¼Œå¯åœ¨ `TryUnlockWithKey` ä¸­æ·»åŠ  `Mathf.Min(totalChance, 0.95f)`

3. **UI äº¤äº’**
   - æœ¬æ¬¡æ›´æ–°ä¸åŒ…å« UI äº¤äº’é€»è¾‘
   - é’¥åŒ™ä½¿ç”¨éœ€è¦åœ¨ PlayerInteraction æˆ– GameInputManager ä¸­å®ç°

## ç›¸å…³æ–‡ä»¶

| æ–‡ä»¶ | è¯´æ˜ |
|------|------|
| `Assets/YYY_Scripts/Data/Enums/PlacementEnums.cs` | ChestOrigin æšä¸¾ |
| `Assets/YYY_Scripts/Data/Items/KeyLockData.cs` | é’¥åŒ™/é”æ•°æ®ï¼Œå«å¼€é”æ¦‚ç‡ |
| `Assets/YYY_Scripts/Data/Items/StorageData.cs` | ç®±å­æ•°æ®ï¼Œå«è¢«å¼€é”æ¦‚ç‡ |
| `Assets/YYY_Scripts/World/Placeable/ChestController.cs` | ç®±å­æ§åˆ¶å™¨ï¼Œæ ¸å¿ƒé€»è¾‘ |
| `Assets/Editor/Tool_BatchItemSOGenerator.cs` | æ‰¹é‡ç”Ÿæˆå·¥å…· |
