# 箱子 UI 系统完善 - 验收指南

## 修改文件清单

| 文件 | 修改类型 | 说明 |
|------|---------|------|
| `BoxPanelUI.cs` | 重写 | 只做数据绑定，不生成/销毁槽位 |
| `StorageData.cs` | 新增字段 | `boxUiPrefab` - UI 预制体引用 |
| `ChestController.cs` | 修改 | 实例化对应的 UI Prefab |
| `GameInputManager.cs` | 修改 | `Instance` → `ActiveInstance` |
| `PackagePanelTabsUI.cs` | 修改 | `Instance` → `ActiveInstance` |
| `ToolbarSlotUI.cs` | 修改 | `Instance` → `ActiveInstance` |
| `ItemSlotUI.cs` | 删除 | 用户已有 `InventorySlotUI` |

---

## Unity 编辑器配置（必须完成）

### 1. 配置 StorageData 的 boxUiPrefab

打开以下 ScriptableObject，配置 `boxUiPrefab` 字段：

| StorageData 文件 | boxUiPrefab |
|-----------------|-------------|
| `Storage_Box_1` (小木箱) | `Box_12` |
| `Storage_Box_2` (大木箱) | `Box_24` |
| `Storage_Box_3` (小铁箱) | `Box_36` |
| `Storage_Box_4` (大铁箱) | `Box_48` |

### 2. 确保 UI 预制体挂载 BoxPanelUI

检查每个 Box_XX 预制体：
- [ ] 根物体挂载 `BoxPanelUI` 组件
- [ ] `upGridParent` 指向 `Up` 子物体
- [ ] `downGridParent` 指向 `Down` 子物体
- [ ] 按钮引用正确（可选）

---

## 功能验收清单

### 基础功能

- [ ] 右键点击箱子 → 打开对应的 UI 预制体
- [ ] 不同容量箱子打开不同的 UI（12/24/36/48 格）
- [ ] 箱子格子正确显示物品图标和数量
- [ ] 背包格子正确显示物品图标和数量

### 面板互斥

- [ ] 打开箱子 UI 时，PackagePanel 自动关闭
- [ ] 打开 PackagePanel 时，箱子 UI 自动关闭
- [ ] 打开另一个箱子时，之前的箱子 UI 自动关闭

### 快捷键

- [ ] ESC 键关闭箱子 UI
- [ ] Tab 键关闭箱子 UI 并打开背包
- [ ] B 键关闭箱子 UI 并打开配方
- [ ] M 键关闭箱子 UI 并打开地图

### 数据同步

- [ ] 放入物品后，箱子格子立即更新
- [ ] 取出物品后，箱子格子立即更新
- [ ] 关闭 UI 后，箱子数据保持正确

---

## 测试步骤

### 测试 1：基础打开/关闭

1. 在场景中放置一个小木箱（12格）
2. 右键点击箱子
3. 验证：打开 Box_12 UI，显示 12 个箱子格子
4. 按 ESC 关闭
5. 验证：UI 关闭，箱子 Sprite 恢复关闭状态

### 测试 2：不同容量箱子

1. 放置大铁箱（48格）
2. 右键点击
3. 验证：打开 Box_48 UI，显示 48 个箱子格子

### 测试 3：面板互斥

1. 打开背包（Tab）
2. 右键点击箱子
3. 验证：背包关闭，箱子 UI 打开
4. 按 Tab
5. 验证：箱子 UI 关闭，背包打开

### 测试 4：多箱子切换

1. 放置两个箱子 A 和 B
2. 右键点击箱子 A
3. 验证：箱子 A 的 UI 打开
4. 右键点击箱子 B
5. 验证：箱子 A 的 UI 关闭，箱子 B 的 UI 打开

---

## 已知限制

1. **物品拖拽**：当前只实现了数据绑定，拖拽功能需要与 `InventoryInteractionManager` 集成
2. **整理按钮**：`BT_Sort_Up` 和 `BT_Sort_Down` 的逻辑尚未实现
3. **垃圾桶**：`BT_TrashCan` 的逻辑尚未实现
4. **Shift+Click 快速转移**：需要额外实现

---

## 下一步工作

1. 实现物品拖拽（与 InventoryInteractionManager 集成）
2. 实现 Shift+Click 快速转移
3. 实现整理功能
4. 实现垃圾桶功能
