# 箱子系统 - 锁与归属系统

## 文档说明
对应需求 6 & 7：上锁/钥匙/归属规则

---

## 当前行为规则

### 来源与归属

| 字段 | 类型 | 说明 |
|------|------|------|
| `origin` | ChestOrigin | 箱子来源（PlayerCrafted / WorldSpawned） |
| `ownership` | ChestOwnership | 箱子归属（Player / World / Locked） |
| `hasBeenLocked` | bool | 是否曾经被上过锁 |
| `isLocked` | bool | 当前是否上锁 |

### 上锁规则

| 条件 | 结果 |
|------|------|
| 已上过锁（hasBeenLocked=true） | 不能再次上锁 |
| 锁与箱子材质不匹配 | 上锁失败，提示"材质不匹配" |
| 野外未锁箱子上锁 | 归属变为玩家 |

### 解锁规则

| 条件 | 结果 |
|------|------|
| 玩家自己的箱子 | 不需要钥匙，直接打开 |
| 野外上锁箱子 | 需要钥匙，概率开锁 |
| 开锁成功 | 保留钥匙 |
| 开锁失败 | 消耗钥匙 |

### 概率系统

```
最终概率 = 钥匙概率 + 箱子概率
```

| 钥匙材质 | 开锁概率 |
|---------|---------|
| 木 | 0.10 |
| 石 | 0.15 |
| 铁 | 0.20 |
| 铜 | 0.25 |
| 钢 | 0.30 |
| 金 | 0.40 |

| 箱子材质 | 被开锁概率 |
|---------|-----------|
| 木箱 | 0.60 |
| 铁箱 | 0.50 |

---

## ⚠️ 与原始需求的差异

| 原始需求 | 当前实现 | 说明 |
|---------|---------|------|
| 上锁后归属变为玩家 | 部分实现 | 野外箱子上锁后变为玩家 |
| 钥匙打开后变为玩家所有 | **未实现** | 野外箱子开锁后保持 World 归属 |

**需要与用户确认**：野外箱子开锁后是否应该变为玩家归属？

---

## 相关文件

| 文件 | 说明 |
|------|------|
| `Assets/YYY_Scripts/World/Placeable/ChestController.cs` | 锁定系统实现 |
| `Assets/YYY_Scripts/Data/Items/KeyLockData.cs` | 钥匙/锁数据类型 |
