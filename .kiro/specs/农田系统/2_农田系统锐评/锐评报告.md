# å†œç”°ç³»ç»Ÿå…¨é¢é”è¯„æŠ¥å‘Š

**é”è¯„æ—¥æœŸ**: 2026-01-24  
**é”è¯„è€…**: Code Reaper  
**é”è¯„èŒƒå›´**: å†œç”°ç³»ç»Ÿå…¨éƒ¨ä»£ç ã€è®¾è®¡æ–‡æ¡£ã€ä¸ç°æœ‰ç³»ç»Ÿçš„é€‚é…æ€§

---

## ç›®å½•

1. [æ‰§è¡Œæ‘˜è¦](#1-æ‰§è¡Œæ‘˜è¦)
2. [ä»£ç è´¨é‡é—®é¢˜](#2-ä»£ç è´¨é‡é—®é¢˜)
3. [é€»è¾‘æ¼æ´åˆ†æ](#3-é€»è¾‘æ¼æ´åˆ†æ)
4. [æ€§èƒ½é»‘æ´æ£€æµ‹](#4-æ€§èƒ½é»‘æ´æ£€æµ‹)
5. [ç³»ç»Ÿé€‚é…é—®é¢˜](#5-ç³»ç»Ÿé€‚é…é—®é¢˜)
6. [æ¶æ„è®¾è®¡é—®é¢˜](#6-æ¶æ„è®¾è®¡é—®é¢˜)
7. [éªŒæ”¶å‰ç½®æ¡ä»¶](#7-éªŒæ”¶å‰ç½®æ¡ä»¶)
8. [ä¿®å¤ä»»åŠ¡æ¸…å•](#8-ä¿®å¤ä»»åŠ¡æ¸…å•)

---

## 1. æ‰§è¡Œæ‘˜è¦

### 1.1 æ€»ä½“è¯„ä»·

| ç»´åº¦ | è¯„åˆ† | è¯´æ˜ |
|------|------|------|
| ä»£ç è´¨é‡ | â­â­â­ (3/5) | åŸºç¡€ç»“æ„åˆç†ï¼Œä½†å­˜åœ¨ç¡¬ç¼–ç å’Œé‡å¤ä»£ç  |
| é€»è¾‘å®Œæ•´æ€§ | â­â­ (2/5) | æ ¸å¿ƒé€»è¾‘æœ‰æ¼æ´ï¼Œå¤šå¤„ TODO æœªå®ç° |
| æ€§èƒ½è¡¨ç° | â­â­â­ (3/5) | å­˜åœ¨æ½œåœ¨æ€§èƒ½é—®é¢˜ï¼Œä½†è§„æ¨¡å°æ—¶å¯æ¥å— |
| ç³»ç»Ÿé€‚é… | â­ (1/5) | ä¸ç°æœ‰ç³»ç»Ÿå‡ ä¹å®Œå…¨è„±èŠ‚ |
| æ¶æ„è®¾è®¡ | â­â­â­ (3/5) | è®¾è®¡æ–‡æ¡£å®Œå–„ï¼Œä½†å®ç°ä¸è®¾è®¡ä¸ç¬¦ |

### 1.2 å…³é”®é—®é¢˜æ±‡æ€»

| ä¸¥é‡ç¨‹åº¦ | é—®é¢˜æ•°é‡ | è¯´æ˜ |
|---------|---------|------|
| ğŸ”´ è‡´å‘½ | 4 | å¯¼è‡´åŠŸèƒ½å®Œå…¨æ— æ³•ä½¿ç”¨ |
| ğŸŸ  ä¸¥é‡ | 6 | å¯¼è‡´åŠŸèƒ½éƒ¨åˆ†å¤±æ•ˆæˆ–æ•°æ®é”™è¯¯ |
| ğŸŸ¡ ä¸­ç­‰ | 8 | å½±å“ç”¨æˆ·ä½“éªŒæˆ–ä»£ç å¯ç»´æŠ¤æ€§ |
| ğŸŸ¢ è½»å¾® | 5 | ä»£ç é£æ ¼æˆ–å°ä¼˜åŒ– |



---

## 2. ä»£ç è´¨é‡é—®é¢˜

### 2.1 ğŸ”´ è‡´å‘½ï¼šHarvestCrop è¿”å› null ç¡¬ç¼–ç 

**ä½ç½®**: `FarmingManager.cs` ç¬¬ 320-325 è¡Œ

```csharp
// TODO: è·å–ä½œç‰©æ•°æ®ï¼ˆItemDatabaseè®¿é—®éœ€è¦å®ç°ï¼‰
// ä¸´æ—¶ï¼šç›´æ¥ä»SeedDataè·å–æ”¶è·ä¿¡æ¯
harvestedCrop = null;  // â† æ°¸è¿œè¿”å› nullï¼
harvestAmount = Random.Range(
    crop.seedData.harvestAmountRange.x,
    crop.seedData.harvestAmountRange.y + 1
);
```

**é—®é¢˜åˆ†æ**:
- `harvestedCrop` æ°¸è¿œä¸º `null`ï¼Œè°ƒç”¨æ–¹æ— æ³•çŸ¥é“æ”¶è·äº†ä»€ä¹ˆä½œç‰©
- å³ä½¿ `harvestAmount` æ­£ç¡®ï¼Œä¹Ÿæ— æ³•å°†ç‰©å“æ·»åŠ åˆ°èƒŒåŒ…
- è¿™æ˜¯ä¸€ä¸ª**åŠŸèƒ½å®Œå…¨å¤±æ•ˆ**çš„è‡´å‘½é—®é¢˜

**ä¿®å¤æ–¹æ¡ˆ**:
```csharp
// é€šè¿‡ harvestCropID ä» ItemDatabase è·å– CropData
if (database != null)
{
    harvestedCrop = database.GetItemByID(crop.seedData.harvestCropID) as CropData;
}
```

---

### 2.2 ğŸ”´ è‡´å‘½ï¼šèƒŒåŒ…ç³»ç»Ÿå®Œå…¨æœªé›†æˆ

**ä½ç½®**: `FarmingManager.cs` å¤šå¤„ TODO æ³¨é‡Š

```csharp
// ç¬¬ 248 è¡Œ
// TODO: ä»èƒŒåŒ…ç§»é™¤ç§å­
// InventoryService.Instance.RemoveItem(seedData.itemID, 1);

// ç¬¬ 340 è¡Œ
// TODO: æ·»åŠ åˆ°èƒŒåŒ…
// InventoryService.Instance.AddItem(harvestedCrop.itemID, harvestAmount);
```

**é—®é¢˜åˆ†æ**:
- ç§æ¤ä¸æ¶ˆè€—ç§å­ â†’ æ— é™ç§å­ bug
- æ”¶è·ä¸æ·»åŠ ç‰©å“ â†’ æ”¶è·æ— æ„ä¹‰
- è¿™æ˜¯**æ ¸å¿ƒåŠŸèƒ½ç¼ºå¤±**

**ä¿®å¤æ–¹æ¡ˆ**:
```csharp
// ç§æ¤æ—¶æ¶ˆè€—ç§å­
if (!InventoryService.Instance.RemoveItem(seedData.itemID, 1))
{
    Debug.Log("[FarmingManager] èƒŒåŒ…ä¸­æ²¡æœ‰è¶³å¤Ÿçš„ç§å­");
    return false;
}

// æ”¶è·æ—¶æ·»åŠ ä½œç‰©
InventoryService.Instance.AddItem(harvestedCrop.itemID, harvestAmount);
```

---

### 2.3 ğŸ”´ è‡´å‘½ï¼šç²¾åŠ›ç³»ç»Ÿå®Œå…¨æœªé›†æˆ

**ä½ç½®**: `FarmingManager.cs` ç¬¬ 50-55 è¡Œ

```csharp
[Header("=== ç²¾åŠ›æ¶ˆè€— ===")]
#pragma warning disable 0414
[SerializeField] private float tillingStaminaCost = 3f;
[SerializeField] private float wateringStaminaCost = 2f;
#pragma warning restore 0414
```

**é—®é¢˜åˆ†æ**:
- ä½¿ç”¨ `#pragma warning disable` å‹åˆ¶"æœªä½¿ç”¨å˜é‡"è­¦å‘Š
- ç²¾åŠ›æ¶ˆè€—é€»è¾‘å®Œå…¨æœªå®ç°
- ç©å®¶å¯ä»¥æ— é™è€•åœ°ã€æµ‡æ°´

**ä¿®å¤æ–¹æ¡ˆ**:
éœ€è¦å…ˆç¡®è®¤ç²¾åŠ›ç³»ç»Ÿæ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨åˆ™é›†æˆï¼š
```csharp
// TODO: æ£€æŸ¥ç²¾åŠ›
if (StaminaSystem.Instance != null && !StaminaSystem.Instance.ConsumeStamina(tillingStaminaCost))
{
    Debug.Log("[FarmingManager] ç²¾åŠ›ä¸è¶³");
    return false;
}
```

---

### 2.4 ğŸŸ  ä¸¥é‡ï¼šCropInstance.UpdateVisuals() ä¸ CropController.UpdateVisuals() é‡å¤

**ä½ç½®**: 
- `CropInstance.cs` ç¬¬ 95-115 è¡Œ
- `CropController.cs` ç¬¬ 45-65 è¡Œ

**é—®é¢˜åˆ†æ**:
ä¸¤ä¸ªç±»éƒ½æœ‰ `UpdateVisuals()` æ–¹æ³•ï¼ŒåŠŸèƒ½å‡ ä¹ç›¸åŒï¼š

```csharp
// CropInstance.UpdateVisuals()
public void UpdateVisuals()
{
    if (cropObject == null) return;
    SpriteRenderer renderer = cropObject.GetComponent<SpriteRenderer>();
    if (renderer != null)
    {
        Sprite sprite = GetCurrentSprite();
        if (sprite != null) renderer.sprite = sprite;
        if (isWithered) renderer.color = new Color(0.8f, 0.8f, 0.5f, 1f);
        else renderer.color = Color.white;
    }
}

// CropController.UpdateVisuals()
public void UpdateVisuals()
{
    if (cropInstance == null || spriteRenderer == null) return;
    Sprite sprite = cropInstance.GetCurrentSprite();
    if (sprite != null) spriteRenderer.sprite = sprite;
    if (cropInstance.isWithered) spriteRenderer.color = new Color(0.8f, 0.7f, 0.4f, 1f);
    else spriteRenderer.color = Color.white;
}
```

**é—®é¢˜**:
1. ä»£ç é‡å¤ï¼Œè¿å DRY åŸåˆ™
2. æ¯èé¢œè‰²ä¸ä¸€è‡´ï¼š`(0.8f, 0.8f, 0.5f)` vs `(0.8f, 0.7f, 0.4f)`
3. è°ƒç”¨æ··ä¹±ï¼š`CropGrowthSystem` è°ƒç”¨ `crop.UpdateVisuals()`ï¼Œä½† `CropController` ä¹Ÿæœ‰è‡ªå·±çš„æ›´æ–°é€»è¾‘

**ä¿®å¤æ–¹æ¡ˆ**:
- åˆ é™¤ `CropInstance.UpdateVisuals()`
- æ‰€æœ‰è§†è§‰æ›´æ–°é€šè¿‡ `CropController.UpdateVisuals()` è¿›è¡Œ
- ç»Ÿä¸€æ¯èé¢œè‰²

---

### 2.5 ğŸŸ  ä¸¥é‡ï¼šItemDatabase è®¿é—®æ–¹å¼é”™è¯¯

**ä½ç½®**: è®¾è®¡æ–‡æ¡£ä¸­æåˆ°ä½†ä»£ç ä¸­æœªå®ç°

**é—®é¢˜åˆ†æ**:
æ ¹æ®é¡¹ç›®è§„èŒƒï¼ˆ`rules.md`ï¼‰ï¼š
```csharp
// âŒ é”™è¯¯ï¼šæ°¸è¿œè¿”å› null
database = FindFirstObjectByType<ItemDatabase>();

// âœ… æ­£ç¡®ï¼šä»å·²æœ‰å¼•ç”¨çš„ MonoBehaviour è·å–
if (inventory != null)
    database = inventory.Database;
```

å½“å‰ä»£ç å®Œå…¨æ²¡æœ‰è·å– `ItemDatabase` çš„é€»è¾‘ï¼Œå¯¼è‡´æ— æ³•ï¼š
- é€šè¿‡ `harvestCropID` è·å– `CropData`
- éªŒè¯ç§å­ ID æ˜¯å¦æœ‰æ•ˆ

**ä¿®å¤æ–¹æ¡ˆ**:
```csharp
[SerializeField] private ItemDatabase itemDatabase;

// æˆ–é€šè¿‡ InventoryService è·å–
private ItemDatabase GetDatabase()
{
    if (itemDatabase != null) return itemDatabase;
    if (InventoryService.Instance != null)
        return InventoryService.Instance.Database;
    return null;
}
```



---

## 3. é€»è¾‘æ¼æ´åˆ†æ

### 3.1 ğŸ”´ è‡´å‘½ï¼šå¤šæ¥¼å±‚æ”¯æŒè®¾è®¡æœ‰ä½†æœªå®ç°

**è®¾è®¡æ–‡æ¡£** (`design.md`) ä¸­æ˜ç¡®è¦æ±‚ï¼š

```csharp
// æ¯ä¸ªæ¥¼å±‚çš„ Tilemap å¼•ç”¨
[System.Serializable]
public class LayerTilemaps
{
    public string layerName;
    public Tilemap farmlandTilemap;
    public Tilemap waterPuddleTilemap;
    public Tilemap groundTilemap;
}

[SerializeField] private LayerTilemaps[] layerTilemaps;
```

**å®é™…ä»£ç ** (`FarmingManager.cs`)ï¼š

```csharp
[Header("=== Tilemapå¼•ç”¨ ===")]
[SerializeField] private Tilemap farmlandTilemap;  // åªæœ‰ä¸€ä¸ªï¼
[SerializeField] private Tilemap groundTilemap;    // åªæœ‰ä¸€ä¸ªï¼
```

**é—®é¢˜åˆ†æ**:
- è®¾è®¡è¦æ±‚æ”¯æŒå¤šæ¥¼å±‚ï¼ˆLAYER 1, LAYER 2, LAYER 3ï¼‰
- å®é™…ä»£ç åªæ”¯æŒå•ä¸ª Tilemap
- ç©å®¶åœ¨äºŒæ¥¼è€•åœ°ä¼šå½±å“ä¸€æ¥¼çš„ Tilemap

**ä¿®å¤æ–¹æ¡ˆ**:
æŒ‰è®¾è®¡æ–‡æ¡£é‡æ„ï¼Œæ·»åŠ  `LayerTilemaps[]` æ•°ç»„å’Œæ¥¼å±‚æ£€æµ‹é€»è¾‘ã€‚

---

### 3.2 ğŸŸ  ä¸¥é‡ï¼šå­£èŠ‚åˆ¤æ–­é€»è¾‘å­˜åœ¨éšæ‚£

**ä½ç½®**: `FarmingManager.cs` ç¬¬ 230-240 è¡Œ

```csharp
private bool IsCorrectSeason(SeedData seedData)
{
    if (timeManager == null) return true;
    
    if (seedData.season == Season.AllSeason)
        return true;

    // æ¯”è¾ƒæšä¸¾å€¼ï¼ˆæ•´æ•°ï¼‰æ¥åˆ¤æ–­å­£èŠ‚æ˜¯å¦åŒ¹é…
    // ItemEnums.Season: Spring=0, Summer=1, Fall=2, Winter=3
    // SeasonManager.Season: Spring=0, Summer=1, Autumn=2, Winter=3
    SeasonManager.Season currentSeason = timeManager.GetSeason();
    return (int)seedData.season == (int)currentSeason;
}
```

**é—®é¢˜åˆ†æ**:
1. æ³¨é‡Šè¯´æ˜äº†ä¸¤ä¸ªæšä¸¾çš„å·®å¼‚ï¼ˆ`Fall` vs `Autumn`ï¼‰ï¼Œä½†ä¾èµ–æ•´æ•°æ¯”è¾ƒ
2. å¦‚æœæšä¸¾å®šä¹‰å˜åŒ–ï¼Œé€»è¾‘ä¼šé™é»˜å¤±è´¥
3. æ²¡æœ‰å¤„ç† `Season.AllSeason` åœ¨ `SeasonManager.Season` ä¸­ä¸å­˜åœ¨çš„æƒ…å†µ

**ä¿®å¤æ–¹æ¡ˆ**:
```csharp
private bool IsCorrectSeason(SeedData seedData)
{
    if (timeManager == null) return true;
    if (seedData.season == Season.AllSeason) return true;

    SeasonManager.Season currentSeason = timeManager.GetSeason();
    
    // æ˜¾å¼æ˜ å°„ï¼Œé¿å…ä¾èµ–æ•´æ•°å€¼
    return seedData.season switch
    {
        Season.Spring => currentSeason == SeasonManager.Season.Spring,
        Season.Summer => currentSeason == SeasonManager.Season.Summer,
        Season.Fall => currentSeason == SeasonManager.Season.Autumn,
        Season.Winter => currentSeason == SeasonManager.Season.Winter,
        _ => false
    };
}
```

---

### 3.3 ğŸŸ  ä¸¥é‡ï¼šæµ‡æ°´æ—¶é—´è·¨å¤©è®¡ç®—æœ‰ bug

**ä½ç½®**: `FarmingManager.cs` ç¬¬ 145-155 è¡Œ

```csharp
private void OnHourChanged(int currentHour)
{
    float currentTime = timeManager.GetHour() + timeManager.GetMinute() / 60f;

    foreach (var kvp in farmTiles)
    {
        FarmTileData tile = kvp.Value;
        
        if (tile.wateredToday && tile.waterTime >= 0)
        {
            float hoursSinceWatering = currentTime - tile.waterTime;
            
            // å¤„ç†è·¨å¤©æƒ…å†µï¼ˆä¾‹å¦‚23ç‚¹æµ‡æ°´ï¼Œ1ç‚¹æ£€æŸ¥ï¼‰
            if (hoursSinceWatering < 0)
                hoursSinceWatering += 24f;
            // ...
        }
    }
}
```

**é—®é¢˜åˆ†æ**:
1. æ¸¸æˆæ—¶é—´æ˜¯ 06:00-02:00ï¼ˆ26å°æ—¶åˆ¶ï¼‰ï¼Œä¸æ˜¯æ ‡å‡† 24 å°æ—¶
2. è·¨å¤©ä¿®æ­£ `+24f` ä¸æ­£ç¡®ï¼Œåº”è¯¥æ˜¯ `+20f`ï¼ˆæ¸¸æˆä¸€å¤© 20 å°æ—¶ï¼‰
3. å¦‚æœç©å®¶åœ¨ 01:00 æµ‡æ°´ï¼Œ02:00 ç¡è§‰ï¼Œç¬¬äºŒå¤© 06:00 æ£€æŸ¥æ—¶ï¼Œ`hoursSinceWatering` è®¡ç®—é”™è¯¯

**ä¿®å¤æ–¹æ¡ˆ**:
```csharp
// ä½¿ç”¨æ¸¸æˆæ—¶é—´ç³»ç»Ÿçš„å°æ—¶æ•°
float hoursSinceWatering = currentTime - tile.waterTime;
if (hoursSinceWatering < 0)
    hoursSinceWatering += 20f; // æ¸¸æˆä¸€å¤© 20 å°æ—¶
```

---

### 3.4 ğŸŸ¡ ä¸­ç­‰ï¼šä½œç‰©ç”Ÿé•¿é˜¶æ®µè®¡ç®—å¯èƒ½è¶Šç•Œ

**ä½ç½®**: `CropGrowthSystem.cs` ç¬¬ 95-105 è¡Œ

```csharp
private void GrowCrop(CropInstance crop)
{
    crop.grownDays++;

    int maxStage = crop.seedData.growthStageSprites.Length - 1;
    int totalGrowthDays = crop.seedData.growthDays;
    
    float growthProgress = (float)crop.grownDays / totalGrowthDays;
    int targetStage = Mathf.FloorToInt(growthProgress * (maxStage + 1));
    targetStage = Mathf.Clamp(targetStage, 0, maxStage);
    // ...
}
```

**é—®é¢˜åˆ†æ**:
- å¦‚æœ `growthStageSprites` ä¸ºç©ºæˆ– nullï¼Œ`maxStage = -1`
- `Mathf.Clamp(targetStage, 0, -1)` è¿”å› 0ï¼Œä½†åç»­è®¿é—® `growthStageSprites[0]` ä¼šæŠ¥é”™
- è™½ç„¶æœ‰ `OnValidate` æ£€æŸ¥ï¼Œä½†è¿è¡Œæ—¶å¯èƒ½è¢«ç»•è¿‡

**ä¿®å¤æ–¹æ¡ˆ**:
```csharp
if (crop.seedData.growthStageSprites == null || crop.seedData.growthStageSprites.Length == 0)
{
    Debug.LogError($"[CropGrowthSystem] {crop.seedData.itemName} æ²¡æœ‰ç”Ÿé•¿é˜¶æ®µSpriteï¼");
    return;
}
```

---

### 3.5 ğŸŸ¡ ä¸­ç­‰ï¼šå¯é‡å¤æ”¶è·ä½œç‰©çš„é˜¶æ®µé‡ç½®é€»è¾‘ä¸åˆç†

**ä½ç½®**: `FarmingManager.cs` ç¬¬ 330-335 è¡Œ

```csharp
if (crop.seedData.isReHarvestable)
{
    int reGrowStage = Mathf.Max(1, crop.seedData.growthStageSprites.Length - 3);
    crop.currentStage = reGrowStage;
    // ...
}
```

**é—®é¢˜åˆ†æ**:
- ç¡¬ç¼–ç  `-3` æ¥è®¡ç®—é‡æ–°ç”Ÿé•¿é˜¶æ®µ
- å¦‚æœä½œç‰©åªæœ‰ 3 ä¸ªé˜¶æ®µï¼Œ`reGrowStage = Max(1, 0) = 1`
- å¦‚æœä½œç‰©æœ‰ 5 ä¸ªé˜¶æ®µï¼Œ`reGrowStage = Max(1, 2) = 2`
- è¿™ä¸ªé€»è¾‘æ²¡æœ‰è€ƒè™‘ `SeedData` ä¸­å¯èƒ½éœ€è¦çš„ `reGrowthStage` å­—æ®µ

**ä¿®å¤æ–¹æ¡ˆ**:
åœ¨ `SeedData` ä¸­æ·»åŠ  `reGrowthStage` å­—æ®µï¼Œæˆ–ä½¿ç”¨æ›´åˆç†çš„è®¡ç®—ï¼š
```csharp
// æ–¹æ¡ˆ1ï¼šæ·»åŠ å­—æ®µ
int reGrowStage = crop.seedData.reGrowthStage;

// æ–¹æ¡ˆ2ï¼šåŸºäºç”Ÿé•¿å¤©æ•°è®¡ç®—
int reGrowStage = Mathf.Max(1, maxStage - crop.seedData.reHarvestDays);
```



---

## 4. æ€§èƒ½é»‘æ´æ£€æµ‹

### 4.1 ğŸŸ  ä¸¥é‡ï¼šOnHourChanged éå†æ‰€æœ‰ farmTiles

**ä½ç½®**: `FarmingManager.cs` ç¬¬ 140-165 è¡Œ

```csharp
private void OnHourChanged(int currentHour)
{
    if (timeManager == null) return;

    float currentTime = timeManager.GetHour() + timeManager.GetMinute() / 60f;

    foreach (var kvp in farmTiles)  // â† æ¯å°æ—¶éå†æ‰€æœ‰è€•åœ°
    {
        FarmTileData tile = kvp.Value;
        
        if (tile.wateredToday && tile.waterTime >= 0)
        {
            // æ£€æŸ¥æ˜¯å¦éœ€è¦åˆ‡æ¢è§†è§‰çŠ¶æ€
        }
    }
}
```

**é—®é¢˜åˆ†æ**:
- æ¸¸æˆæ¯å°æ—¶è§¦å‘ä¸€æ¬¡ï¼Œæ¯æ¬¡éå†æ‰€æœ‰è€•åœ°
- å¦‚æœæœ‰ 1000 å—è€•åœ°ï¼Œæ¯å°æ—¶éå† 1000 æ¬¡
- å¤§éƒ¨åˆ†è€•åœ°å¯èƒ½ä¸éœ€è¦æ›´æ–°ï¼ˆæœªæµ‡æ°´æˆ–å·²ç»æ˜¯æ·±è‰²çŠ¶æ€ï¼‰

**æ€§èƒ½å½±å“**:
- å°è§„æ¨¡ï¼ˆ<100 å—ï¼‰ï¼šå¯å¿½ç•¥
- ä¸­è§„æ¨¡ï¼ˆ100-500 å—ï¼‰ï¼šè½»å¾®å¡é¡¿
- å¤§è§„æ¨¡ï¼ˆ>500 å—ï¼‰ï¼šæ˜æ˜¾å¡é¡¿

**ä¿®å¤æ–¹æ¡ˆ**:
```csharp
// ç»´æŠ¤ä¸€ä¸ª"ä»Šå¤©æµ‡æ°´çš„è€•åœ°"åˆ—è¡¨
private HashSet<Vector3Int> wateredTodayTiles = new HashSet<Vector3Int>();

public bool WaterTileAtCell(Vector3Int cellPosition)
{
    // ... æµ‡æ°´é€»è¾‘ ...
    wateredTodayTiles.Add(cellPosition);
}

private void OnHourChanged(int currentHour)
{
    foreach (var pos in wateredTodayTiles)  // åªéå†ä»Šå¤©æµ‡æ°´çš„
    {
        if (farmTiles.TryGetValue(pos, out FarmTileData tile))
        {
            // æ£€æŸ¥æ˜¯å¦éœ€è¦åˆ‡æ¢è§†è§‰çŠ¶æ€
        }
    }
}

private void OnDayChanged(int year, int day, int totalDays)
{
    wateredTodayTiles.Clear();  // æ¯å¤©æ¸…ç©º
}
```

---

### 4.2 ğŸŸ¡ ä¸­ç­‰ï¼šOnDayChanged éå†æ‰€æœ‰ farmTiles

**ä½ç½®**: `FarmingManager.cs` ç¬¬ 115-135 è¡Œ

```csharp
private void OnDayChanged(int year, int day, int totalDays)
{
    foreach (var kvp in farmTiles)  // â† æ¯å¤©éå†æ‰€æœ‰è€•åœ°
    {
        FarmTileData tile = kvp.Value;
        tile.wateredYesterday = tile.wateredToday;
        tile.wateredToday = false;
        tile.waterTime = -1f;
        tile.moistureState = SoilMoistureState.Dry;
        UpdateTileVisual(kvp.Key, tile);  // â† æ¯å—è€•åœ°éƒ½æ›´æ–° Tilemap
    }
}
```

**é—®é¢˜åˆ†æ**:
- æ¯å¤©å¼€å§‹æ—¶éå†æ‰€æœ‰è€•åœ°
- æ¯å—è€•åœ°éƒ½è°ƒç”¨ `UpdateTileVisual()`ï¼Œå³ä½¿çŠ¶æ€æ²¡å˜
- `Tilemap.SetTile()` æ˜¯ç›¸å¯¹æ˜‚è´µçš„æ“ä½œ

**ä¿®å¤æ–¹æ¡ˆ**:
```csharp
private void OnDayChanged(int year, int day, int totalDays)
{
    foreach (var kvp in farmTiles)
    {
        FarmTileData tile = kvp.Value;
        
        bool needsVisualUpdate = tile.moistureState != SoilMoistureState.Dry;
        
        tile.wateredYesterday = tile.wateredToday;
        tile.wateredToday = false;
        tile.waterTime = -1f;
        tile.moistureState = SoilMoistureState.Dry;
        
        // åªæœ‰çŠ¶æ€å˜åŒ–æ—¶æ‰æ›´æ–°è§†è§‰
        if (needsVisualUpdate)
        {
            UpdateTileVisual(kvp.Key, tile);
        }
    }
}
```

---

### 4.3 ğŸŸ¡ ä¸­ç­‰ï¼šCropController.Update() æ¯å¸§æ‰§è¡Œ

**ä½ç½®**: `CropController.cs` ç¬¬ 70-80 è¡Œ

```csharp
private void Update()
{
    // æˆç†Ÿä½œç‰©çš„é—ªçƒæ•ˆæœ
    if (isMature && enableMatureGlow && !cropInstance.isWithered)
    {
        glowTime += Time.deltaTime * glowSpeed;
        float glow = Mathf.PingPong(glowTime, 1f);
        spriteRenderer.color = Color.Lerp(Color.white, glowColor, glow * 0.3f);
    }
}
```

**é—®é¢˜åˆ†æ**:
- æ¯ä¸ªæˆç†Ÿä½œç‰©æ¯å¸§éƒ½æ‰§è¡Œ `Update()`
- å¦‚æœæœ‰ 100 ä¸ªæˆç†Ÿä½œç‰©ï¼Œæ¯å¸§æ‰§è¡Œ 100 æ¬¡
- `Color.Lerp` å’Œ `spriteRenderer.color` èµ‹å€¼æœ‰ä¸€å®šå¼€é”€

**ä¿®å¤æ–¹æ¡ˆ**:
```csharp
// æ–¹æ¡ˆ1ï¼šä½¿ç”¨åç¨‹ä»£æ›¿ Update
private IEnumerator GlowCoroutine()
{
    while (isMature && enableMatureGlow && !cropInstance.isWithered)
    {
        glowTime += Time.deltaTime * glowSpeed;
        float glow = Mathf.PingPong(glowTime, 1f);
        spriteRenderer.color = Color.Lerp(Color.white, glowColor, glow * 0.3f);
        yield return null;
    }
}

// æ–¹æ¡ˆ2ï¼šä½¿ç”¨ Shader å®ç°é—ªçƒæ•ˆæœï¼ˆæ¨èï¼‰
// åœ¨ Shader ä¸­ä½¿ç”¨ _Time å˜é‡å®ç°é—ªçƒï¼Œæ— éœ€è„šæœ¬æ›´æ–°
```

---

### 4.4 ğŸŸ¢ è½»å¾®ï¼šInstantiate/Destroy ç²’å­æ•ˆæœ

**ä½ç½®**: `FarmingManager.cs` ç¬¬ 195-200 è¡Œ

```csharp
private void PlayTillingEffects(Vector3 worldPosition)
{
    if (tillingParticlePrefab != null)
    {
        GameObject particles = Instantiate(tillingParticlePrefab, worldPosition, Quaternion.identity);
        Destroy(particles, 2f);
    }
}
```

**é—®é¢˜åˆ†æ**:
- æ¯æ¬¡è€•åœ°/æµ‡æ°´éƒ½ `Instantiate` å’Œ `Destroy`
- é¢‘ç¹æ“ä½œæ—¶ä¼šäº§ç”Ÿ GC å‹åŠ›

**ä¿®å¤æ–¹æ¡ˆ**:
ä½¿ç”¨å¯¹è±¡æ± ï¼š
```csharp
// ä½¿ç”¨é¡¹ç›®å·²æœ‰çš„ WorldItemPool æ¨¡å¼
private Queue<GameObject> particlePool = new Queue<GameObject>();

private GameObject GetParticle()
{
    if (particlePool.Count > 0)
        return particlePool.Dequeue();
    return Instantiate(tillingParticlePrefab);
}

private void ReturnParticle(GameObject particle)
{
    particle.SetActive(false);
    particlePool.Enqueue(particle);
}
```



---

## 5. ç³»ç»Ÿé€‚é…é—®é¢˜

### 5.1 ğŸ”´ è‡´å‘½ï¼šä¸èƒŒåŒ…ç³»ç»Ÿå®Œå…¨è„±èŠ‚

**ç°æœ‰èƒŒåŒ…ç³»ç»Ÿ**:
- `InventoryService` - èƒŒåŒ…æœåŠ¡
- `IItemContainer` - å®¹å™¨æ¥å£
- `ItemDatabase` - ç‰©å“æ•°æ®åº“

**å†œç”°ç³»ç»Ÿç°çŠ¶**:
- æ²¡æœ‰å¼•ç”¨ `InventoryService`
- æ²¡æœ‰å¼•ç”¨ `ItemDatabase`
- ç§æ¤ä¸æ¶ˆè€—ç§å­
- æ”¶è·ä¸æ·»åŠ ç‰©å“

**é€‚é…æ¸…å•**:
| åŠŸèƒ½ | éœ€è¦è°ƒç”¨çš„æ¥å£ | å½“å‰çŠ¶æ€ |
|------|---------------|---------|
| ç§æ¤æ¶ˆè€—ç§å­ | `InventoryService.RemoveItem()` | âŒ æœªå®ç° |
| æ”¶è·æ·»åŠ ä½œç‰© | `InventoryService.AddItem()` | âŒ æœªå®ç° |
| è·å–ä½œç‰©æ•°æ® | `ItemDatabase.GetItemByID()` | âŒ æœªå®ç° |
| æ£€æŸ¥ç§å­æ•°é‡ | `InventoryService.GetItemCount()` | âŒ æœªå®ç° |

---

### 5.2 ğŸŸ  ä¸¥é‡ï¼šä¸å·¥å…·ç³»ç»Ÿæœªé›†æˆ

**ç°æœ‰å·¥å…·ç³»ç»Ÿ**:
- `GameInputManager` - è¾“å…¥ç®¡ç†
- `PlayerToolHitEmitter` - å·¥å…·å‘½ä¸­å‘å°„
- `ToolData` - å·¥å…·æ•°æ®

**å†œç”°ç³»ç»Ÿç°çŠ¶**:
- `TillSoil()` å’Œ `WaterTile()` æ–¹æ³•å­˜åœ¨
- ä½†æ²¡æœ‰ä¸å·¥å…·ç³»ç»Ÿè¿æ¥
- ç©å®¶æ— æ³•é€šè¿‡å·¥å…·è§¦å‘è¿™äº›æ–¹æ³•

**é€‚é…æ¸…å•**:
| å·¥å…· | éœ€è¦è§¦å‘çš„æ–¹æ³• | å½“å‰çŠ¶æ€ |
|------|---------------|---------|
| é”„å¤´ | `FarmingManager.TillSoil()` | âŒ æœªè¿æ¥ |
| æ°´å£¶ | `FarmingManager.WaterTile()` | âŒ æœªè¿æ¥ |
| æ‰‹/é•°åˆ€ | `FarmingManager.HarvestCrop()` | âŒ æœªè¿æ¥ |

**é›†æˆæ–¹æ¡ˆ**:
```csharp
// åœ¨ GameInputManager æˆ– PlayerToolHitEmitter ä¸­
private void HandleToolUse(ToolData tool, Vector3 targetPosition)
{
    switch (tool.toolType)
    {
        case ToolType.Hoe:
            FarmingManager.Instance.TillSoil(targetPosition);
            break;
        case ToolType.WateringCan:
            FarmingManager.Instance.WaterTile(targetPosition);
            break;
        // ...
    }
}
```

---

### 5.3 ğŸŸ  ä¸¥é‡ï¼šä¸æ”¾ç½®ç³»ç»Ÿè¾¹ç•Œä¸æ¸…

**è®¾è®¡å†³ç­–**ï¼ˆæ¥è‡ª `memory.md`ï¼‰:
> ç§å­ï¼ˆSeedDataï¼‰ç”±å†œç”°ç³»ç»Ÿï¼ˆFarmingSystemï¼‰ç®¡ç†ï¼Œä¸æ ‘è‹—ï¼ˆSaplingDataï¼‰åˆ†ç¦»ã€‚

**ç°æœ‰æ”¾ç½®ç³»ç»Ÿ**:
- `PlacementManagerV3` - æ”¾ç½®ç®¡ç†å™¨
- `PlacementValidatorV3` - æ”¾ç½®éªŒè¯å™¨
- æ”¯æŒ `SaplingData`ã€`StorageData` ç­‰

**é—®é¢˜**:
1. ç§å­ç§æ¤é€»è¾‘åœ¨ `FarmingManager` ä¸­
2. ä½†ç§å­ç‰©å“å¯èƒ½é€šè¿‡ `PlacementManagerV3` è¢«é”™è¯¯å¤„ç†
3. éœ€è¦æ˜ç¡®çš„ç±»å‹æ£€æŸ¥æ¥åŒºåˆ†

**é€‚é…æ–¹æ¡ˆ**:
```csharp
// åœ¨ PlacementManagerV3 ä¸­
public bool CanPlace(ItemData item)
{
    // ç§å­ä¸é€šè¿‡æ”¾ç½®ç³»ç»Ÿå¤„ç†
    if (item is SeedData)
    {
        Debug.Log("[PlacementManager] ç§å­åº”é€šè¿‡å†œç”°ç³»ç»Ÿç§æ¤");
        return false;
    }
    // ...
}
```

---

### 5.4 ğŸŸ¡ ä¸­ç­‰ï¼šä¸å¯¼èˆªç³»ç»Ÿæœªé›†æˆ

**ç°æœ‰å¯¼èˆªç³»ç»Ÿ**:
- `NavGrid2D` - 2D å¯¼èˆªç½‘æ ¼
- `NavGrid2D.OnRequestGridRefresh` - åˆ·æ–°è¯·æ±‚äº‹ä»¶

**å†œç”°ç³»ç»Ÿç°çŠ¶**:
- è€•åœ°åˆ›å»º/ç§»é™¤ä¸è§¦å‘å¯¼èˆªç½‘æ ¼åˆ·æ–°
- ä½œç‰©ä¸ä½œä¸ºéšœç¢ç‰©

**é—®é¢˜**:
- å¦‚æœä½œç‰©åº”è¯¥é˜»æŒ¡ç§»åŠ¨ï¼Œéœ€è¦åˆ·æ–°å¯¼èˆªç½‘æ ¼
- å¦‚æœä½œç‰©ä¸é˜»æŒ¡ç§»åŠ¨ï¼Œéœ€è¦ç¡®ä¿ä¸è¢«è¯¯åˆ¤ä¸ºéšœç¢ç‰©

**é€‚é…æ–¹æ¡ˆ**:
```csharp
// å¦‚æœä½œç‰©éœ€è¦é˜»æŒ¡ç§»åŠ¨
public bool PlantSeedAtCell(Vector3Int cellPosition, SeedData seedData)
{
    // ... ç§æ¤é€»è¾‘ ...
    
    // åˆ·æ–°å¯¼èˆªç½‘æ ¼
    NavGrid2D.OnRequestGridRefresh?.Invoke();
}
```

---

### 5.5 ğŸŸ¡ ä¸­ç­‰ï¼šä¸é®æŒ¡ç³»ç»Ÿæœªé›†æˆ

**ç°æœ‰é®æŒ¡ç³»ç»Ÿ**:
- `OcclusionManager` - é®æŒ¡ç®¡ç†å™¨
- `OcclusionTransparency` - é®æŒ¡é€æ˜ç»„ä»¶

**å†œç”°ç³»ç»Ÿç°çŠ¶**:
- ä½œç‰© Prefab æ²¡æœ‰ `OcclusionTransparency` ç»„ä»¶
- é«˜å¤§ä½œç‰©ï¼ˆå¦‚ç‰ç±³ï¼‰å¯èƒ½é®æŒ¡ç©å®¶

**é€‚é…æ–¹æ¡ˆ**:
```csharp
// åœ¨ CropController ä¸­
private void Awake()
{
    // å¦‚æœä½œç‰©é«˜åº¦è¶…è¿‡é˜ˆå€¼ï¼Œæ·»åŠ é®æŒ¡ç»„ä»¶
    if (cropInstance.seedData.maxHeight > 1.5f)
    {
        gameObject.AddComponent<OcclusionTransparency>();
    }
}
```

---

### 5.6 ğŸŸ¢ è½»å¾®ï¼šä¸ UI ç³»ç»Ÿæœªé›†æˆ

**éœ€è¦çš„ UI åŠŸèƒ½**:
| UI åŠŸèƒ½ | è¯´æ˜ | å½“å‰çŠ¶æ€ |
|--------|------|---------|
| ä½œç‰©ä¿¡æ¯æç¤º | æ˜¾ç¤ºä½œç‰©åç§°ã€ç”Ÿé•¿è¿›åº¦ | âŒ æœªå®ç° |
| æ”¶è·æç¤º | æ˜¾ç¤º"æŒ‰ E æ”¶è·" | âŒ æœªå®ç° |
| å­£èŠ‚ä¸åŒ¹é…æç¤º | æ˜¾ç¤º"æ­¤å­£èŠ‚æ— æ³•ç§æ¤" | âŒ æœªå®ç° |
| ç²¾åŠ›ä¸è¶³æç¤º | æ˜¾ç¤º"ç²¾åŠ›ä¸è¶³" | âŒ æœªå®ç° |



---

## 6. æ¶æ„è®¾è®¡é—®é¢˜

### 6.1 ğŸŸ  ä¸¥é‡ï¼šå•ä¾‹æ¨¡å¼æ»¥ç”¨

**ç°çŠ¶**:
```csharp
// FarmingManager.cs
public static FarmingManager Instance { get; private set; }

// CropGrowthSystem.cs
public static CropGrowthSystem Instance { get; private set; }
```

**é—®é¢˜**:
1. ä¸¤ä¸ªå•ä¾‹ç®¡ç†åŒä¸€ä¸ªé¢†åŸŸï¼ˆå†œç”°ï¼‰
2. `CropGrowthSystem` ä¾èµ– `FarmingManager.Instance`
3. åˆå§‹åŒ–é¡ºåºä¸ç¡®å®šï¼Œå¯èƒ½å¯¼è‡´ç©ºå¼•ç”¨

**ä¿®å¤æ–¹æ¡ˆ**:
```csharp
// æ–¹æ¡ˆ1ï¼šåˆå¹¶ä¸ºä¸€ä¸ªç±»
// å°† CropGrowthSystem çš„é€»è¾‘åˆå¹¶åˆ° FarmingManager

// æ–¹æ¡ˆ2ï¼šä½¿ç”¨ä¾èµ–æ³¨å…¥
public class CropGrowthSystem : MonoBehaviour
{
    [SerializeField] private FarmingManager farmingManager;
    
    private void Start()
    {
        if (farmingManager == null)
            farmingManager = FarmingManager.Instance;
    }
}
```

---

### 6.2 ğŸŸ¡ ä¸­ç­‰ï¼šèŒè´£ä¸æ¸…æ™°

**FarmingManager å½“å‰èŒè´£**:
1. è€•åœ°ç®¡ç†ï¼ˆTillSoilï¼‰
2. ç§æ¤ç®¡ç†ï¼ˆPlantSeedï¼‰
3. æµ‡æ°´ç®¡ç†ï¼ˆWaterTileï¼‰
4. æ”¶è·ç®¡ç†ï¼ˆHarvestCropï¼‰
5. Tilemap è§†è§‰æ›´æ–°
6. éŸ³æ•ˆæ’­æ”¾
7. ç²’å­æ•ˆæœ
8. æ—¶é—´äº‹ä»¶å¤„ç†

**é—®é¢˜**:
- å•ä¸€ç±»æ‰¿æ‹…è¿‡å¤šèŒè´£
- è¿åå•ä¸€èŒè´£åŸåˆ™ï¼ˆSRPï¼‰
- éš¾ä»¥æµ‹è¯•å’Œç»´æŠ¤

**å»ºè®®æ‹†åˆ†**:
```
FarmingManagerï¼ˆåè°ƒè€…ï¼‰
â”œâ”€â”€ FarmTileManagerï¼ˆè€•åœ°çŠ¶æ€ç®¡ç†ï¼‰
â”œâ”€â”€ CropManagerï¼ˆä½œç‰©ç”Ÿå‘½å‘¨æœŸï¼‰
â”œâ”€â”€ FarmVisualManagerï¼ˆè§†è§‰æ›´æ–°ï¼‰
â””â”€â”€ FarmAudioManagerï¼ˆéŸ³æ•ˆç®¡ç†ï¼‰
```

---

### 6.3 ğŸŸ¡ ä¸­ç­‰ï¼šæ•°æ®ä¸é€»è¾‘è€¦åˆ

**CropInstance é—®é¢˜**:
```csharp
public class CropInstance
{
    public SeedData seedData;           // æ•°æ®
    public GameObject cropObject;       // è¿è¡Œæ—¶å¯¹è±¡
    public int currentStage;            // çŠ¶æ€
    
    public void UpdateVisuals()         // é€»è¾‘ï¼
    {
        // ç›´æ¥æ“ä½œ GameObject
    }
}
```

**é—®é¢˜**:
- `CropInstance` æ—¢æ˜¯æ•°æ®ç±»åˆåŒ…å«é€»è¾‘
- ç›´æ¥æŒæœ‰ `GameObject` å¼•ç”¨ï¼Œéš¾ä»¥åºåˆ—åŒ–
- `UpdateVisuals()` åº”è¯¥åœ¨ `CropController` ä¸­

**ä¿®å¤æ–¹æ¡ˆ**:
```csharp
// çº¯æ•°æ®ç±»
[System.Serializable]
public class CropInstanceData
{
    public int seedDataID;
    public int currentStage;
    public int plantedDay;
    public int grownDays;
    public int daysWithoutWater;
    public bool isWithered;
    public int harvestCount;
    public int lastHarvestDay;
}

// è¿è¡Œæ—¶åŒ…è£…
public class CropInstance
{
    public CropInstanceData data;
    public SeedData seedData;  // è¿è¡Œæ—¶å¼•ç”¨
    public GameObject cropObject;  // è¿è¡Œæ—¶å¼•ç”¨
}
```

---

### 6.4 ğŸŸ¢ è½»å¾®ï¼šç¼ºå°‘æ¥å£æŠ½è±¡

**ç°çŠ¶**:
- ç›´æ¥ä½¿ç”¨å…·ä½“ç±» `FarmingManager`
- æ²¡æœ‰ `IFarmingService` æ¥å£

**é—®é¢˜**:
- éš¾ä»¥è¿›è¡Œå•å…ƒæµ‹è¯•ï¼ˆæ— æ³• Mockï¼‰
- éš¾ä»¥æ›¿æ¢å®ç°

**å»ºè®®**:
```csharp
public interface IFarmingService
{
    bool TillSoil(Vector3 worldPosition);
    bool PlantSeed(Vector3 worldPosition, SeedData seedData);
    bool WaterTile(Vector3 worldPosition);
    bool HarvestCrop(Vector3 worldPosition, out CropData crop, out int amount);
}
```



---

## 7. éªŒæ”¶å‰ç½®æ¡ä»¶

### 7.1 ç”¨æˆ·æ“ä½œå‰ç½®æ¡ä»¶

| åºå· | å‰ç½®æ¡ä»¶ | è¯´æ˜ | çŠ¶æ€ |
|------|---------|------|------|
| U1 | Rule Tile é…ç½® | åˆ›å»ºè€•åœ° Rule Tileï¼Œé…ç½®è¾¹ç•Œè§„åˆ™ | â³ å¾…ç”¨æˆ·æ“ä½œ |
| U2 | æ°´æ¸ Tile åˆ›å»º | åˆ›å»º 3 ç§æ°´æ¸ Tile | â³ å¾…ç”¨æˆ·æ“ä½œ |
| U3 | åœºæ™¯ Tilemap ç»“æ„ | åœ¨æ¯ä¸ª LAYER ä¸‹åˆ›å»º Farmland å’Œ WaterPuddle Tilemap | â³ å¾…ç”¨æˆ·æ“ä½œ |
| U4 | ä½œç‰© Prefab é…ç½® | åˆ›å»ºä½œç‰© Prefabï¼Œæ·»åŠ å¿…è¦ç»„ä»¶ | â³ å¾…ç”¨æˆ·æ“ä½œ |
| U5 | ç§å­ SO åˆ›å»º | åˆ›å»ºè‡³å°‘ 1 ä¸ª SeedData SO ç”¨äºæµ‹è¯• | â³ å¾…ç”¨æˆ·æ“ä½œ |
| U6 | ä½œç‰© SO åˆ›å»º | åˆ›å»ºå¯¹åº”çš„ CropData SO | â³ å¾…ç”¨æˆ·æ“ä½œ |

### 7.2 ä»£ç ä¿®å¤å‰ç½®æ¡ä»¶

| åºå· | å‰ç½®æ¡ä»¶ | è¯´æ˜ | ä¼˜å…ˆçº§ |
|------|---------|------|--------|
| C1 | ItemDatabase è®¿é—® | å®ç°æ­£ç¡®çš„ ItemDatabase è·å–æ–¹å¼ | P0 |
| C2 | èƒŒåŒ…ç³»ç»Ÿé›†æˆ | å®ç°ç§å­æ¶ˆè€—å’Œä½œç‰©æ·»åŠ  | P0 |
| C3 | å·¥å…·ç³»ç»Ÿé›†æˆ | è¿æ¥é”„å¤´ã€æ°´å£¶ã€æ”¶è·å·¥å…· | P0 |
| C4 | å¤šæ¥¼å±‚æ”¯æŒ | å®ç° LayerTilemaps æ•°ç»„å’Œæ¥¼å±‚æ£€æµ‹ | P0 |
| C5 | HarvestCrop ä¿®å¤ | è¿”å›æ­£ç¡®çš„ CropData | P0 |
| C6 | é‡å¤ä»£ç æ¸…ç† | åˆ é™¤ CropInstance.UpdateVisuals() | P1 |
| C7 | å­£èŠ‚åˆ¤æ–­ä¿®å¤ | ä½¿ç”¨æ˜¾å¼æ˜ å°„ä»£æ›¿æ•´æ•°æ¯”è¾ƒ | P1 |
| C8 | æ€§èƒ½ä¼˜åŒ– | ä¼˜åŒ– OnHourChanged éå† | P2 |

### 7.3 æµ‹è¯•éªŒæ”¶æ¡ä»¶

| åºå· | æµ‹è¯•é¡¹ | éªŒæ”¶æ ‡å‡† |
|------|--------|---------|
| T1 | é”„åœ°åŠŸèƒ½ | ä½¿ç”¨é”„å¤´å³é”®åœ°é¢ï¼Œåˆ›å»ºè€•åœ° Tile |
| T2 | ç§æ¤åŠŸèƒ½ | åœ¨è€•åœ°ä¸Šä½¿ç”¨ç§å­ï¼Œæ¶ˆè€—ç§å­ï¼Œåˆ›å»ºä½œç‰© |
| T3 | æµ‡æ°´åŠŸèƒ½ | ä½¿ç”¨æ°´å£¶æµ‡æ°´ï¼Œæ˜¾ç¤ºæ°´æ¸ï¼Œ2å°æ—¶åå˜æ·±è‰² |
| T4 | ç”Ÿé•¿åŠŸèƒ½ | æ¯å¤©æ£€æŸ¥ï¼Œæµ‡æ°´çš„ä½œç‰©ç”Ÿé•¿ï¼Œæœªæµ‡æ°´çš„åœæ»/æ¯è |
| T5 | æ”¶è·åŠŸèƒ½ | æˆç†Ÿä½œç‰©å¯æ”¶è·ï¼Œæ·»åŠ åˆ°èƒŒåŒ… |
| T6 | å¯é‡å¤æ”¶è· | å¯é‡å¤æ”¶è·ä½œç‰©æ”¶è·åå›é€€é˜¶æ®µï¼Œå¯å†æ¬¡æ”¶è· |
| T7 | å¤šæ¥¼å±‚ | ä¸åŒæ¥¼å±‚çš„è€•åœ°ç‹¬ç«‹æ“ä½œ |
| T8 | Rule Tile | è€•åœ°è¾¹ç•Œè‡ªåŠ¨æ‹¼æ¥æ­£ç¡® |
| T9 | å­£èŠ‚æ£€æŸ¥ | é”™è¯¯å­£èŠ‚æ— æ³•ç§æ¤ |
| T10 | ç²¾åŠ›æ¶ˆè€— | è€•åœ°/æµ‡æ°´æ¶ˆè€—ç²¾åŠ›ï¼ˆå¦‚æœç²¾åŠ›ç³»ç»Ÿå­˜åœ¨ï¼‰ |

### 7.4 ä¾èµ–ç³»ç»Ÿç¡®è®¤

| ç³»ç»Ÿ | æ˜¯å¦å­˜åœ¨ | é›†æˆçŠ¶æ€ |
|------|---------|---------|
| InventoryService | âœ… å­˜åœ¨ | âŒ æœªé›†æˆ |
| ItemDatabase | âœ… å­˜åœ¨ | âŒ æœªé›†æˆ |
| TimeManager | âœ… å­˜åœ¨ | âœ… å·²é›†æˆ |
| SeasonManager | âœ… å­˜åœ¨ | âš ï¸ éƒ¨åˆ†é›†æˆ |
| GameInputManager | âœ… å­˜åœ¨ | âŒ æœªé›†æˆ |
| NavGrid2D | âœ… å­˜åœ¨ | âŒ æœªé›†æˆ |
| OcclusionManager | âœ… å­˜åœ¨ | âŒ æœªé›†æˆ |
| StaminaSystem | â“ æœªç¡®è®¤ | âŒ æœªé›†æˆ |
| PlacementManagerV3 | âœ… å­˜åœ¨ | âš ï¸ éœ€è¦è¾¹ç•Œæ£€æŸ¥ |



---

## 8. ä¿®å¤ä»»åŠ¡æ¸…å•

### 8.1 P0 - è‡´å‘½é—®é¢˜ä¿®å¤ï¼ˆå¿…é¡»å®Œæˆï¼‰

| ä»»åŠ¡ | æè¿° | é¢„ä¼°å·¥æ—¶ | ä¾èµ– |
|------|------|---------|------|
| P0-1 | å®ç° ItemDatabase è®¿é—® | 1h | - |
| P0-2 | é›†æˆèƒŒåŒ…ç³»ç»Ÿï¼ˆç§å­æ¶ˆè€—ï¼‰ | 1h | P0-1 |
| P0-3 | é›†æˆèƒŒåŒ…ç³»ç»Ÿï¼ˆä½œç‰©æ·»åŠ ï¼‰ | 1h | P0-1 |
| P0-4 | ä¿®å¤ HarvestCrop è¿”å›å€¼ | 0.5h | P0-1 |
| P0-5 | å®ç°å¤šæ¥¼å±‚ Tilemap æ”¯æŒ | 3h | U3 |
| P0-6 | é›†æˆå·¥å…·ç³»ç»Ÿï¼ˆé”„å¤´ï¼‰ | 2h | - |
| P0-7 | é›†æˆå·¥å…·ç³»ç»Ÿï¼ˆæ°´å£¶ï¼‰ | 1h | P0-6 |
| P0-8 | é›†æˆå·¥å…·ç³»ç»Ÿï¼ˆæ”¶è·ï¼‰ | 1h | P0-6 |

**P0 æ€»å·¥æ—¶**: ~10.5h

### 8.2 P1 - ä¸¥é‡é—®é¢˜ä¿®å¤

| ä»»åŠ¡ | æè¿° | é¢„ä¼°å·¥æ—¶ | ä¾èµ– |
|------|------|---------|------|
| P1-1 | åˆ é™¤ CropInstance.UpdateVisuals() | 0.5h | - |
| P1-2 | ç»Ÿä¸€æ¯èé¢œè‰² | 0.5h | P1-1 |
| P1-3 | ä¿®å¤å­£èŠ‚åˆ¤æ–­é€»è¾‘ | 0.5h | - |
| P1-4 | ä¿®å¤æµ‡æ°´æ—¶é—´è·¨å¤©è®¡ç®— | 0.5h | - |
| P1-5 | æ·»åŠ æ”¾ç½®ç³»ç»Ÿè¾¹ç•Œæ£€æŸ¥ | 1h | - |
| P1-6 | é›†æˆç²¾åŠ›ç³»ç»Ÿï¼ˆå¦‚æœå­˜åœ¨ï¼‰ | 1h | ç¡®è®¤ç²¾åŠ›ç³»ç»Ÿ |

**P1 æ€»å·¥æ—¶**: ~4h

### 8.3 P2 - æ€§èƒ½ä¼˜åŒ–

| ä»»åŠ¡ | æè¿° | é¢„ä¼°å·¥æ—¶ | ä¾èµ– |
|------|------|---------|------|
| P2-1 | ä¼˜åŒ– OnHourChanged éå† | 1h | - |
| P2-2 | ä¼˜åŒ– OnDayChanged éå† | 0.5h | - |
| P2-3 | ä¼˜åŒ– CropController.Update() | 1h | - |
| P2-4 | å®ç°ç²’å­æ•ˆæœå¯¹è±¡æ±  | 1h | - |

**P2 æ€»å·¥æ—¶**: ~3.5h

### 8.4 P3 - æ¶æ„ä¼˜åŒ–ï¼ˆå¯é€‰ï¼‰

| ä»»åŠ¡ | æè¿° | é¢„ä¼°å·¥æ—¶ | ä¾èµ– |
|------|------|---------|------|
| P3-1 | åˆå¹¶ CropGrowthSystem åˆ° FarmingManager | 2h | - |
| P3-2 | æ‹†åˆ† FarmingManager èŒè´£ | 4h | P3-1 |
| P3-3 | åˆ†ç¦» CropInstance æ•°æ®å’Œé€»è¾‘ | 2h | - |
| P3-4 | æ·»åŠ  IFarmingService æ¥å£ | 1h | - |

**P3 æ€»å·¥æ—¶**: ~9h

### 8.5 ç”¨æˆ·æ“ä½œä»»åŠ¡

| ä»»åŠ¡ | æè¿° | è¯´æ˜ |
|------|------|------|
| U-1 | é…ç½® Rule Tile | å‚è€ƒ `RuleTileé…ç½®æŒ‡å—.md` |
| U-2 | åˆ›å»ºæ°´æ¸ Tile | 3 ç§æ ·å¼ |
| U-3 | æ­å»ºåœºæ™¯ Tilemap ç»“æ„ | æ¯ä¸ª LAYER ä¸‹åˆ›å»º Farmland å’Œ WaterPuddle |
| U-4 | é…ç½®ä½œç‰© Prefab | æ·»åŠ  SpriteRendererã€CropController |
| U-5 | åˆ›å»ºæµ‹è¯•ç”¨ SeedData | è‡³å°‘ 1 ä¸ª |
| U-6 | åˆ›å»ºæµ‹è¯•ç”¨ CropData | å¯¹åº” SeedData |

---

## æ€»ç»“

### é—®é¢˜ç»Ÿè®¡

| ç±»åˆ« | æ•°é‡ | è¯´æ˜ |
|------|------|------|
| ğŸ”´ è‡´å‘½é—®é¢˜ | 4 | å¿…é¡»ä¿®å¤æ‰èƒ½ä½¿ç”¨ |
| ğŸŸ  ä¸¥é‡é—®é¢˜ | 6 | å½±å“æ ¸å¿ƒåŠŸèƒ½ |
| ğŸŸ¡ ä¸­ç­‰é—®é¢˜ | 8 | å½±å“ä½“éªŒæˆ–å¯ç»´æŠ¤æ€§ |
| ğŸŸ¢ è½»å¾®é—®é¢˜ | 5 | ä¼˜åŒ–é¡¹ |

### ä¿®å¤ä¼˜å…ˆçº§

1. **ç«‹å³ä¿®å¤**ï¼ˆP0ï¼‰ï¼šèƒŒåŒ…é›†æˆã€å·¥å…·é›†æˆã€å¤šæ¥¼å±‚æ”¯æŒ
2. **å°½å¿«ä¿®å¤**ï¼ˆP1ï¼‰ï¼šé‡å¤ä»£ç ã€é€»è¾‘æ¼æ´
3. **è®¡åˆ’ä¿®å¤**ï¼ˆP2ï¼‰ï¼šæ€§èƒ½ä¼˜åŒ–
4. **é•¿æœŸä¼˜åŒ–**ï¼ˆP3ï¼‰ï¼šæ¶æ„é‡æ„

### é¢„ä¼°æ€»å·¥æ—¶

| ä¼˜å…ˆçº§ | å·¥æ—¶ | è¯´æ˜ |
|--------|------|------|
| P0 | 10.5h | å¿…é¡»å®Œæˆ |
| P1 | 4h | å»ºè®®å®Œæˆ |
| P2 | 3.5h | å¯é€‰ |
| P3 | 9h | å¯é€‰ |
| **æ€»è®¡** | **27h** | å®Œæ•´ä¿®å¤ |

### å»ºè®®å¼€å‘é¡ºåº

1. ç”¨æˆ·å®Œæˆ U-1 ~ U-6ï¼ˆç´ æå’Œåœºæ™¯é…ç½®ï¼‰
2. å¼€å‘å®Œæˆ P0-1 ~ P0-8ï¼ˆæ ¸å¿ƒåŠŸèƒ½ä¿®å¤ï¼‰
3. å¼€å‘å®Œæˆ P1-1 ~ P1-6ï¼ˆä¸¥é‡é—®é¢˜ä¿®å¤ï¼‰
4. æµ‹è¯•éªŒæ”¶ T1 ~ T10
5. æ ¹æ®éœ€è¦å®Œæˆ P2ã€P3

---

*é”è¯„æŠ¥å‘Šå®Œæˆ - 2026-01-24*  
*Code Reaper*

