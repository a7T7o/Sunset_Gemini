# 耕地 Tile 系统 - 验收指南

**创建日期**: 2026-01-25  
**版本**: 1.0

---

## 功能验收清单

### 1. 资产验证

- [ ] 运行 `Tools/Farm/Validate Farmland Tiles` 菜单
- [ ] 确认输出显示 24 个 Tile 存在，0 个缺失
- [ ] 检查 `Assets/ZZZ_999_Package/000_Tile/Farmland/` 目录结构：
  - [ ] `Border/` 包含 15 个 Tile 资产
  - [ ] `Center/` 包含 2 个 Tile 资产（C0、C1）
  - [ ] `Shadow/` 包含 4 个 Tile 资产
  - [ ] `Water/` 包含 3 个 Tile 资产

### 2. Tilemap 配置验证

- [ ] 每个 LAYER 下存在 `Farmland_Center` Tilemap
- [ ] 每个 LAYER 下存在 `Farmland_Border` Tilemap
- [ ] Tilemap Renderer 的 Sorting Layer 设置为 `Ground`
- [ ] Order in Layer 正确：Center=1, Border=2

### 3. 组件配置验证

- [ ] `FarmlandBorderManager` 组件存在于 MANAGERS 下
- [ ] 所有 Tile 引用字段已配置（无红色警告）
- [ ] `FarmTileManager` 的 `LayerTilemaps` 已配置新字段

---

## 功能测试步骤

### 测试 1: 单格耕地

1. 进入 Play 模式
2. 装备锄头工具
3. 点击地面创建一格耕地
4. **预期结果**:
   - [ ] 点击位置显示中心块 (C0)
   - [ ] 周围 4 格显示正确的边界 (U/D/L/R)
   - [ ] 对角线 4 格显示阴影 (SLU/SRU/SLD/SRD)

### 测试 2: 相邻耕地

1. 在已有耕地旁边再锄一格
2. **预期结果**:
   - [ ] 两个中心块之间的边界消失
   - [ ] 边界自动更新为正确类型
   - [ ] 阴影位置正确调整

### 测试 3: 2×2 耕地

1. 创建 2×2 的耕地区域
2. **预期结果**:
   - [ ] 4 个中心块正确显示
   - [ ] 外围边界正确（角落显示 UL/UR/DL/DR）
   - [ ] 中间无边界

### 测试 4: 3×3 耕地

1. 创建 3×3 的耕地区域
2. **预期结果**:
   - [ ] 中心格周围 8 格都是中心块
   - [ ] 外围边界正确
   - [ ] 角落显示正确的边界类型

### 测试 5: L 形耕地

1. 创建 L 形的耕地区域
2. **预期结果**:
   - [ ] 内角处边界正确
   - [ ] 外角处阴影正确

---

## 边界类型验证表

| 周围中心块分布 | 预期边界 Tile |
|---------------|--------------|
| 只有上方 | Farm_U |
| 只有下方 | Farm_D |
| 只有左方 | Farm_L |
| 只有右方 | Farm_R |
| 上下都有 | Farm_UD |
| 左右都有 | Farm_LR |
| 上左都有 | Farm_UL |
| 上右都有 | Farm_UR |
| 下左都有 | Farm_DL |
| 下右都有 | Farm_DR |
| 上下左都有 | Farm_UDL |
| 上下右都有 | Farm_UDR |
| 上左右都有 | Farm_ULR |
| 下左右都有 | Farm_DLR |
| 四周都有 | Farm_UDLR |

---

## 阴影验证

阴影只在以下条件满足时显示：
- 四个正方向（上下左右）都没有中心块
- 对角线方向有中心块

| 对角线中心块 | 预期阴影 Tile |
|-------------|--------------|
| 左上有 | Farm_SLU |
| 右上有 | Farm_SRU |
| 左下有 | Farm_SLD |
| 右下有 | Farm_SRD |

---

## 调试命令

如果遇到问题，可以在 Console 中运行：

```csharp
// 验证 Tile 资源配置
FarmlandBorderManager.Instance.ValidateTileResources();

// 刷新所有边界
FarmlandBorderManager.Instance.RefreshAllLayersBorders();
```

---

## 已知限制

1. **施肥状态**：当前 `RefreshAllBorders()` 默认使用未施肥中心块 (C0)，施肥状态需要从 `FarmTileData` 获取
2. **跨楼层**：边界检测只在同一楼层内进行，不跨楼层

---

## 常见问题排查

### 问题 1: 边界不显示

**检查**:
1. `FarmlandBorderManager` 组件是否存在
2. Tile 引用是否全部配置
3. `LayerTilemaps` 的 `farmlandBorderTilemap` 是否配置

### 问题 2: 边界类型错误

**检查**:
1. Tile 资产的 Sprite 引用是否正确
2. `FarmlandBorderManager` 的 Tile 引用是否拖错位置

### 问题 3: 阴影不显示

**检查**:
1. 阴影 Tile 引用是否配置
2. 确认测试位置满足阴影显示条件（四个正方向无中心块）

---

**文档维护者**: Kiro  
**最后更新**: 2026-01-25
