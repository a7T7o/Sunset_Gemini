# 耕地 Tile 系统 - 完整配置指南

**创建日期**: 2026-01-25  
**版本**: 1.0

---

## 概述

本指南将帮助你完成耕地 Tile 系统的完整配置，包括：
1. ~~美术资源制作~~ ✅ 已完成
2. ~~Unity Tile 资产创建~~ ✅ 已通过脚本自动创建
3. ~~Tilemap 层级配置~~ ✅ 已通过 MCP 自动创建
4. 组件配置（需要手动拖拽）

---

## Tile 资产清单（共 24 个）

所有 Tile 资产已自动创建在 `Assets/ZZZ_999_Package/000_Tile/Farmland/` 目录下：

### Border（15 个）

| Tile 资产 | 对应 Sprite | 说明 |
|-----------|-------------|------|
| `Tile_Farm_U` | Farm_U | 上方有中心块 |
| `Tile_Farm_D` | Farm_D | 下方有中心块 |
| `Tile_Farm_L` | Farm_L | 左方有中心块 |
| `Tile_Farm_R` | Farm_R | 右方有中心块 |
| `Tile_Farm_UD` | Farm_UD | 上下都有中心块 |
| `Tile_Farm_LR` | Farm_LR | 左右都有中心块 |
| `Tile_Farm_UL` | Farm_UL | 上方和左方有中心块 |
| `Tile_Farm_UR` | Farm_UR | 上方和右方有中心块 |
| `Tile_Farm_DL` | Farm_DL | 下方和左方有中心块 |
| `Tile_Farm_DR` | Farm_DR | 下方和右方有中心块 |
| `Tile_Farm_UDL` | Farm_UDL | 上下左都有中心块 |
| `Tile_Farm_UDR` | Farm_UDR | 上下右都有中心块 |
| `Tile_Farm_ULR` | Farm_ULR | 上左右都有中心块 |
| `Tile_Farm_DLR` | Farm_DLR | 下左右都有中心块 |
| `Tile_Farm_UDLR` | Farm_UDLR | 四周都有中心块 |

### Center（2 个）

| Tile 资产 | 对应 Sprite | 说明 |
|-----------|-------------|------|
| `Tile_Farm_C0` | Farm_C0 | 中心块 - 未施肥 |
| `Tile_Farm_C1` | Farm_C1 | 中心块 - 已施肥 |

### Shadow（4 个）

| Tile 资产 | 对应 Sprite | 说明 |
|-----------|-------------|------|
| `Tile_Farm_SLU` | Farm_SLU | 左上角阴影 |
| `Tile_Farm_SRU` | Farm_SRU | 右上角阴影 |
| `Tile_Farm_SLD` | Farm_SLD | 左下角阴影 |
| `Tile_Farm_SRD` | Farm_SRD | 右下角阴影 |

### Water（3 个）

| Tile 资产 | 对应 Sprite | 说明 |
|-----------|-------------|------|
| `Tile_Water_A` | Water_A | 水渍样式 A |
| `Tile_Water_B` | Water_B | 水渍样式 B |
| `Tile_Water_C` | Water_C | 水渍样式 C |

---

## 第一步：配置 Tilemap 层级 ✅ 已通过 MCP 自动完成

### 1.1 场景层级结构

以下 Tilemap 已自动创建：

```
─── LAYER 1 ───
└── Tilemaps/
    ├── GroundBase           ← 已存在
    ├── Farmland_Center      ✅ 已创建 (Order: 1)
    ├── Farmland_Border      ✅ 已创建 (Order: 2)
    └── WaterPuddle          ← 已存在或新建
```

同样的结构已在 LAYER 2 和 LAYER 3 中创建。

### 1.2 ~~创建 Tilemap 步骤~~ ✅ 已完成

~~1. 在 Hierarchy 中选中 `─── LAYER 1 ───/Tilemaps`~~
~~2. 右键 → **2D Object → Tilemap → Rectangular**~~
~~3. 重命名为 `Farmland_Center`~~
~~4. 重复步骤 2-3，创建 `Farmland_Border`~~

### 1.3 ~~配置 Tilemap Renderer~~ ✅ 已完成

所有 Tilemap Renderer 已配置：

| Tilemap | Sorting Layer | Order in Layer |
|---------|---------------|----------------|
| GroundBase | Ground | 0 |
| Farmland_Center | Ground | 1 ✅ |
| Farmland_Border | Ground | 2 ✅ |
| WaterPuddle | Ground | 3 |

---

## 第二步：配置 FarmlandBorderManager ⚠️ 需要手动拖拽

### 2.1 ~~创建 Manager GameObject~~ ✅ 已完成

`FarmlandBorderManager` GameObject 和组件已自动创建在 `─── MANAGERS ───` 下。

### 2.2 配置 Tile 引用 ⚠️ 需要手动拖拽

选中 `─── MANAGERS ───/FarmlandBorderManager`，在 Inspector 中将 Tile 资产拖到对应字段：

**Tile 资产位置**: `Assets/ZZZ_999_Package/000_Tile/Farmland/`

#### 中心块
- **Center Tile Unfertilized**: `Tile_Farm_C0`（未施肥）
- **Center Tile Fertilized**: `Tile_Farm_C1`（已施肥）

#### 单方向边界
- **Border U**: `Tile_Farm_U`
- **Border D**: `Tile_Farm_D`
- **Border L**: `Tile_Farm_L`
- **Border R**: `Tile_Farm_R`

#### 双方向边界 - 对边
- **Border UD**: `Tile_Farm_UD`
- **Border LR**: `Tile_Farm_LR`

#### 双方向边界 - 相邻
- **Border UL**: `Tile_Farm_UL`
- **Border UR**: `Tile_Farm_UR`
- **Border DL**: `Tile_Farm_DL`
- **Border DR**: `Tile_Farm_DR`

#### 三方向边界
- **Border UDL**: `Tile_Farm_UDL`
- **Border UDR**: `Tile_Farm_UDR`
- **Border ULR**: `Tile_Farm_ULR`
- **Border DLR**: `Tile_Farm_DLR`

#### 四方向边界
- **Border UDLR**: `Tile_Farm_UDLR`

#### 角落阴影
- **Shadow LU**: `Tile_Farm_SLU`
- **Shadow RU**: `Tile_Farm_SRU`
- **Shadow LD**: `Tile_Farm_SLD`
- **Shadow RD**: `Tile_Farm_SRD`

---

## 第三步：配置 LayerTilemaps ⚠️ 需要手动拖拽

### 3.1 找到 FarmTileManager

在 `─── MANAGERS ───` 下找到 `FarmTileManager` 组件。

### 3.2 配置每个楼层的 Tilemap ⚠️ 需要手动拖拽

在 **Layer Tilemaps** 数组中，为每个楼层配置新增的两个字段：

| 楼层 | Farmland Center Tilemap | Farmland Border Tilemap |
|------|------------------------|------------------------|
| LAYER 1 | `─── LAYER 1 ───/Tilemaps/Farmland_Center` | `─── LAYER 1 ───/Tilemaps/Farmland_Border` |
| LAYER 2 | `─── LAYER 2 ───/Tilemaps/Farmland_Center` | `─── LAYER 2 ───/Tilemaps/Farmland_Border` |
| LAYER 3 | `─── LAYER 3 ───/Tilemaps/Farmland_Center` | `─── LAYER 3 ───/Tilemaps/Farmland_Border` |

其他字段保持原有配置不变。

---

## 第四步：验证配置

### 4.1 运行时验证

1. 进入 Play 模式
2. 使用锄头工具点击地面
3. 观察是否正确显示：
   - 中心块 (C) 在点击位置
   - 周围 8 格显示正确的边界/阴影

### 4.2 检查清单

- [x] 所有 24 个 Tile 资产已创建（已自动完成）
- [x] 每个 LAYER 下有 `Farmland_Center` 和 `Farmland_Border` Tilemap（已自动完成）
- [x] Tilemap 的 Sorting Layer 和 Order 正确（已自动完成）
- [x] `FarmlandBorderManager` GameObject 和组件已创建（已自动完成）
- [ ] `FarmlandBorderManager` 的所有 Tile 引用已配置（需要手动拖拽）
- [ ] `FarmTileManager` 的 `LayerTilemaps` 已配置新字段（需要手动拖拽）

---

## 常见问题

### Q1: 边界显示不正确

**检查**：
1. 确认 Tile 资产的 Sprite 引用正确
2. 确认 `FarmlandBorderManager` 的 Tile 引用正确
3. 确认 `LayerTilemaps` 的 `farmlandCenterTilemap` 和 `farmlandBorderTilemap` 已配置

### Q2: 阴影不显示

**检查**：
1. 确认 `shadowLU`、`shadowRU`、`shadowLD`、`shadowRD` 已配置
2. 阴影只在对角线方向有中心块且四个正方向都没有中心块时显示

### Q3: 锄地后没有任何显示

**检查**：
1. 确认 `FarmlandBorderManager` 组件存在且启用
2. 确认 `FarmTileManager` 的 `layerTilemaps` 数组已配置
3. 检查 Console 是否有错误日志

---

## 调试工具

### 启用调试日志

在 `FarmlandBorderManager` 和 `FarmTileManager` 组件中：
- 勾选 **Show Debug Info**

### 验证 Tile 资源配置

在运行时调用：
```csharp
FarmlandBorderManager.Instance.ValidateTileResources();
```

### 刷新所有边界

在运行时调用：
```csharp
FarmlandBorderManager.Instance.RefreshAllLayersBorders();
```

---

**文档维护者**: Kiro  
**最后更新**: 2026-01-25
