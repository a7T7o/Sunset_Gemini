# 耕地 Tile 系统设计 - 需求文档

**创建日期**: 2026-01-25  
**版本**: 1.0  
**状态**: 待用户审核

---

## 背景

用户设计了一套独特的耕地 Tile 系统，核心特点是：
- 耕地由"中心块"和"边界装饰"组成
- 边界不是耕地，只是视觉装饰
- 边界可以随时被玩家锄成新的中心块
- 阴影合并到边界 Sprite 中，四个角落单独处理

---

## 核心概念定义

### 中心块 (C)

- **定义**：玩家使用锄头创建的"真正的耕地"
- **功能**：可以种植作物、浇水
- **尺寸**：16×16 像素
- **创建方式**：玩家锄地时由代码放置

### 边界 Tile

- **定义**：围绕中心块的视觉装饰
- **功能**：纯视觉效果，不是耕地
- **特性**：玩家可以在边界上锄地，将其变成新的中心块
- **更新方式**：每次放置/移除中心块后，代码自动更新周围边界

### 阴影 Tile

- **定义**：四个角落的阴影效果
- **功能**：增加耕地的立体感
- **位置**：只出现在对角线方向有中心块的格子

---

## 命名规则

### 边界命名规则

边界名称表示**"该格子周围哪些方向有中心块"**。

边界内容**贴着有中心块的那一侧**（中心块在哪边，边界就贴着哪边）。

| 名称 | 含义 | 边界内容位置 |
|------|------|-------------|
| **U** | 上方有中心块 | 贴着格子**顶部** |
| **D** | 下方有中心块 | 贴着格子**底部** |
| **L** | 左方有中心块 | 贴着格子**左侧** |
| **R** | 右方有中心块 | 贴着格子**右侧** |

### 组合命名

| 名称 | 含义 | 视觉效果 |
|------|------|---------|
| **UD** | 上下都有中心块 | 左右贯通（上下都有边界线） |
| **LR** | 左右都有中心块 | 上下贯通（左右都有边界线） |
| **UL** | 上方和左方有中心块 | 右下角有边界 |
| **UR** | 上方和右方有中心块 | 左下角有边界 |
| **DL** | 下方和左方有中心块 | 右上角有边界 |
| **DR** | 下方和右方有中心块 | 左上角有边界 |
| **UDL** | 上下左都有中心块 | 只有右侧有边界线 |
| **UDR** | 上下右都有中心块 | 只有左侧有边界线 |
| **ULR** | 上左右都有中心块 | 只有底部有边界线 |
| **DLR** | 下左右都有中心块 | 只有顶部有边界线 |
| **UDLR** | 四周都有中心块 | 无边界线（纯耕地纹理） |

### 阴影命名

| 名称 | 含义 | 位置 |
|------|------|------|
| **SLU** | Shadow_LeftUp | 左上角阴影 |
| **SRU** | Shadow_RightUp | 右上角阴影 |
| **SLD** | Shadow_LeftDown | 左下角阴影 |
| **SRD** | Shadow_RightDown | 右下角阴影 |

---

## 用户需要提供的 Sprite 清单

### 中心块（1 个）

| 编号 | 名称 | 尺寸 | 描述 |
|------|------|------|------|
| 1 | **C** | 16×16 | 耕地中心块，翻耕过的土壤纹理 |

### 单方向边界（4 个）

| 编号 | 名称 | 尺寸 | 描述 |
|------|------|------|------|
| 2 | **U** | 16×16 | 上方有中心块，边界贴着顶部 |
| 3 | **D** | 16×16 | 下方有中心块，边界贴着底部 |
| 4 | **L** | 16×16 | 左方有中心块，边界贴着左侧 |
| 5 | **R** | 16×16 | 右方有中心块，边界贴着右侧 |

### 双方向边界 - 对边（2 个）

| 编号 | 名称 | 尺寸 | 描述 |
|------|------|------|------|
| 6 | **UD** | 16×16 | 上下都有中心块，左右贯通 |
| 7 | **LR** | 16×16 | 左右都有中心块，上下贯通 |

### 双方向边界 - 相邻（4 个）

| 编号 | 名称 | 尺寸 | 描述 |
|------|------|------|------|
| 8 | **UL** | 16×16 | 上方和左方有中心块，右下角有边界 |
| 9 | **UR** | 16×16 | 上方和右方有中心块，左下角有边界 |
| 10 | **DL** | 16×16 | 下方和左方有中心块，右上角有边界 |
| 11 | **DR** | 16×16 | 下方和右方有中心块，左上角有边界 |

### 三方向边界（4 个）

| 编号 | 名称 | 尺寸 | 描述 |
|------|------|------|------|
| 12 | **UDL** | 16×16 | 上下左都有中心块，只有右侧有边界线 |
| 13 | **UDR** | 16×16 | 上下右都有中心块，只有左侧有边界线 |
| 14 | **ULR** | 16×16 | 上左右都有中心块，只有底部有边界线 |
| 15 | **DLR** | 16×16 | 下左右都有中心块，只有顶部有边界线 |

### 四方向边界（1 个）

| 编号 | 名称 | 尺寸 | 描述 |
|------|------|------|------|
| 16 | **UDLR** | 16×16 | 四周都有中心块，无边界线（纯耕地纹理，可与 C 相同） |

### 角落阴影（4 个）

| 编号 | 名称 | 尺寸 | 描述 |
|------|------|------|------|
| 17 | **SLU** | 16×16 | 左上角阴影（左上方有中心块时显示） |
| 18 | **SRU** | 16×16 | 右上角阴影（右上方有中心块时显示） |
| 19 | **SLD** | 16×16 | 左下角阴影（左下方有中心块时显示） |
| 20 | **SRD** | 16×16 | 右下角阴影（右下方有中心块时显示） |

### 水渍（3 个）

| 编号 | 名称 | 尺寸 | 描述 |
|------|------|------|------|
| 21 | **Water_A** | 16×16 | 水渍样式 A |
| 22 | **Water_B** | 16×16 | 水渍样式 B |
| 23 | **Water_C** | 16×16 | 水渍样式 C |

---

## Sprite 总计

| 类别 | 数量 |
|------|------|
| 中心块 | 1 |
| 单方向边界 | 4 |
| 双方向边界（对边） | 2 |
| 双方向边界（相邻） | 4 |
| 三方向边界 | 4 |
| 四方向边界 | 1 |
| 角落阴影 | 4 |
| 水渍 | 3 |
| **总计** | **23** |

---

## 视觉示例

### 孤立的单个耕地

```
[SLU][D][SRU]     ← 第一行：左上阴影、下方有中心块的边界、右上阴影
[R]  [C][L]       ← 第二行：右方有中心块的边界、中心块、左方有中心块的边界
[SLD][U][SRD]     ← 第三行：左下阴影、上方有中心块的边界、右下阴影
```

### 两个横向相邻的耕地

```
[SLU][D] [D] [SRU]
[R]  [C] [C] [L]
[SLD][U] [U] [SRD]
```

### L 形耕地（两个中心块呈 L 形）

```
[SLU][D]  [SRU][   ]
[R]  [C]  [DL] [SRD]
[   ][UR] [C]  [L]
[   ][SLD][U]  [SRD]
```

### 田字形耕地（四个中心块）

```
[SLU][D]   [D]   [SRU]
[R]  [C]   [C]   [L]
[R]  [C]   [C]   [L]
[SLD][U]   [U]   [SRD]
```

---

## 技术架构

### Tilemap 层级结构

```
─── LAYER N ───
└── Tilemaps/
    ├── GroundBase        ← 地面基础（已存在）
    ├── Farmland_Center   ← 耕地中心块（新建）
    ├── Farmland_Border   ← 耕地边界（新建）
    └── WaterPuddle       ← 水渍（新建）
```

### 实现方式

1. **中心块放置**：玩家锄地 → 代码在 `Farmland_Center` 放置中心块 C
2. **边界更新**：放置中心块后 → 代码遍历周围 3×3 范围 → 根据中心块分布计算边界 → 在 `Farmland_Border` 放置对应边界 Tile
3. **阴影处理**：阴影 Tile 只在对角线方向有中心块时放置

---

## 用户前置工作清单

### 美术资源制作

- [ ] 制作中心块 Sprite (C)
- [ ] 制作 4 个单方向边界 Sprite (U, D, L, R)
- [ ] 制作 2 个对边双方向边界 Sprite (UD, LR)
- [ ] 制作 4 个相邻双方向边界 Sprite (UL, UR, DL, DR)
- [ ] 制作 4 个三方向边界 Sprite (UDL, UDR, ULR, DLR)
- [ ] 制作 1 个四方向边界 Sprite (UDLR)
- [ ] 制作 4 个角落阴影 Sprite (SLU, SRU, SLD, SRD)
- [ ] 确认 3 个水渍 Sprite (Water_A, Water_B, Water_C)

### Unity 配置

- [ ] 在每个 LAYER 下创建 `Farmland_Center` Tilemap
- [ ] 在每个 LAYER 下创建 `Farmland_Border` Tilemap
- [ ] 在每个 LAYER 下创建 `WaterPuddle` Tilemap
- [ ] 为每个 Sprite 创建对应的 Tile 资产
- [ ] 配置 Tilemap 的 Sorting Layer 和 Order in Layer

---

## 验收标准

### 美术资源验收

1. 所有 23 个 Sprite 已制作完成
2. 每个 Sprite 尺寸为 16×16 像素
3. 边界 Sprite 的边界内容位置正确（贴着有中心块的那一侧）
4. 阴影 Sprite 的阴影位置正确（在对应的角落）

### 功能验收

1. 玩家锄地后，中心块正确显示
2. 中心块周围的边界自动正确显示
3. 在边界上锄地，边界变成新的中心块，周围边界自动更新
4. 多个中心块相邻时，边界正确合并
5. 角落阴影在正确位置显示

---

## 附录：边界选择逻辑参考

```
对于每个非中心块的格子 (x, y)：

1. 检查四个方向是否有中心块：
   - hasU = 上方 (x, y+1) 有中心块
   - hasD = 下方 (x, y-1) 有中心块
   - hasL = 左方 (x-1, y) 有中心块
   - hasR = 右方 (x+1, y) 有中心块

2. 检查四个对角线是否有中心块：
   - hasLU = 左上 (x-1, y+1) 有中心块
   - hasRU = 右上 (x+1, y+1) 有中心块
   - hasLD = 左下 (x-1, y-1) 有中心块
   - hasRD = 右下 (x+1, y-1) 有中心块

3. 根据四个方向的组合选择边界 Sprite：
   - 只有 U → 使用 U
   - 只有 D → 使用 D
   - U + D → 使用 UD
   - U + L → 使用 UL
   - ... 以此类推

4. 如果四个方向都没有中心块，但对角线有：
   - hasLU → 放置 SLU
   - hasRU → 放置 SRU
   - hasLD → 放置 SLD
   - hasRD → 放置 SRD
```

---

**文档维护者**: Kiro  
**最后更新**: 2026-01-25

