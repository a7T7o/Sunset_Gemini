# è€•åœ°ç³»ç»Ÿæ­£ç¡®è®¾è®¡æ–¹æ¡ˆ

**åˆ›å»ºæ—¥æœŸ**: 2026-01-25  
**çŠ¶æ€**: è®¾è®¡ç¡®è®¤ä¸­

---

## ğŸ¯ æ ¸å¿ƒç†è§£

### ä½ çš„èµ„æºï¼ˆ5 ä¸ª Spriteï¼Œæ¯ä¸ª 16Ã—16ï¼‰

| Sprite | ç”¨é€” | ä½ç½® |
|--------|------|------|
| ä¸Šè¾¹ç•Œ | è€•åœ°ä¸Šæ–¹çš„è¾¹æ¡† | ä¸­å¿ƒæ ¼çš„ä¸Šæ–¹ |
| ä¸‹è¾¹ç•Œ | è€•åœ°ä¸‹æ–¹çš„è¾¹æ¡† | ä¸­å¿ƒæ ¼çš„ä¸‹æ–¹ |
| å·¦è¾¹ç•Œ | è€•åœ°å·¦ä¾§çš„è¾¹æ¡† | ä¸­å¿ƒæ ¼çš„å·¦ä¾§ |
| å³è¾¹ç•Œ | è€•åœ°å³ä¾§çš„è¾¹æ¡† | ä¸­å¿ƒæ ¼çš„å³ä¾§ |
| ä¸­å¿ƒ | å¯ç§æ¤çš„è€•åœ°åŒºåŸŸ | ç©å®¶ç‚¹å‡»çš„ä½ç½® |

### ä¸€ä¸ªå®Œæ•´è€•åœ° = 3Ã—3 åŒºåŸŸï¼ˆ5 ä¸ª Tileï¼‰

```
[    ] [ä¸Šè¾¹ç•Œ] [    ]
[å·¦è¾¹ç•Œ] [ä¸­å¿ƒ] [å³è¾¹ç•Œ]
[    ] [ä¸‹è¾¹ç•Œ] [    ]
```

- ç©å®¶ç”¨é”„å¤´ç‚¹å‡»ä½ç½® â†’ åˆ›å»º**ä¸­å¿ƒ** Tile
- ä»£ç è‡ªåŠ¨åœ¨å››å‘¨åˆ›å»º**ä¸Šä¸‹å·¦å³è¾¹ç•Œ** Tile
- å››ä¸ªè§’è½**ä¸æ”¾ç½®** Tileï¼ˆä¿æŒç©ºç™½ï¼‰

---

## ğŸ”´ ä¸ºä»€ä¹ˆ Rule Tile ä¸é€‚ç”¨

ä¼ ç»Ÿ Rule Tile çš„è®¾è®¡æ€è·¯ï¼š
- 1 ä¸ª Tilemap æ ¼å­ = 1 ä¸ª Sprite
- æ ¹æ®é‚»å±…è‡ªåŠ¨åˆ‡æ¢ Sprite

ä½ çš„è®¾è®¡æ€è·¯ï¼š
- 1 ä¸ªè€•åœ° = 5 ä¸ª Tilemap æ ¼å­ï¼ˆ3Ã—3 åŒºåŸŸï¼‰
- éœ€è¦ä»£ç æ§åˆ¶è¾¹ç•Œçš„æ˜¾ç¤º/éšè—

**ç»“è®º**ï¼šéœ€è¦**ä»£ç æ§åˆ¶** + **æ™®é€š Tile**ï¼Œä¸ä½¿ç”¨ Rule Tileã€‚

---

## âœ… æ­£ç¡®çš„å®ç°æ–¹æ¡ˆ

### æ–¹æ¡ˆæ¦‚è¿°

1. **åˆ›å»º 5 ä¸ªæ™®é€š Tile**ï¼ˆä¸æ˜¯ Rule Tileï¼‰
2. **ä»£ç æ§åˆ¶**è€•åœ°çš„åˆ›å»ºå’Œè¾¹ç•Œç®¡ç†
3. **å½“ä¸¤ä¸ªè€•åœ°ç›¸é‚»æ—¶**ï¼Œä»£ç ç§»é™¤ä¸­é—´é‡å çš„è¾¹ç•Œ

### Tile èµ„æºå‡†å¤‡

åœ¨ `Assets/ZZZ_999_Package/000_Tile/` ä¸‹åˆ›å»º 5 ä¸ªæ™®é€š Tileï¼š

| Tile åç§° | å¯¹åº” Sprite |
|-----------|-------------|
| `Farmland_Center` | ä¸­å¿ƒæ ·å¼ |
| `Farmland_Border_Top` | ä¸Šè¾¹ç•Œ |
| `Farmland_Border_Bottom` | ä¸‹è¾¹ç•Œ |
| `Farmland_Border_Left` | å·¦è¾¹ç•Œ |
| `Farmland_Border_Right` | å³è¾¹ç•Œ |

### ä»£ç é€»è¾‘

#### åˆ›å»ºè€•åœ°

```csharp
public void CreateFarmland(Vector3Int centerPos)
{
    // 1. æ”¾ç½®ä¸­å¿ƒ Tile
    farmlandTilemap.SetTile(centerPos, centerTile);
    
    // 2. æ£€æŸ¥å¹¶æ”¾ç½®/æ›´æ–°å››å‘¨è¾¹ç•Œ
    UpdateBordersAround(centerPos);
    
    // 3. æ£€æŸ¥å¹¶æ›´æ–°ç›¸é‚»è€•åœ°çš„è¾¹ç•Œ
    UpdateNeighborBorders(centerPos);
}
```

#### è¾¹ç•Œæ›´æ–°é€»è¾‘

```csharp
private void UpdateBordersAround(Vector3Int centerPos)
{
    // ä¸Šè¾¹ç•Œï¼šå¦‚æœä¸Šæ–¹æ²¡æœ‰è€•åœ°ä¸­å¿ƒï¼Œåˆ™æ”¾ç½®ä¸Šè¾¹ç•Œ
    Vector3Int topPos = centerPos + Vector3Int.up;
    if (!HasFarmlandCenter(topPos))
    {
        farmlandTilemap.SetTile(topPos, topBorderTile);
    }
    else
    {
        // ä¸Šæ–¹æœ‰è€•åœ°ï¼Œç§»é™¤ä¸Šè¾¹ç•Œï¼ˆå› ä¸ºä¼šè¢«ä¸Šæ–¹è€•åœ°çš„ä¸‹è¾¹ç•Œè¦†ç›–ï¼‰
        farmlandTilemap.SetTile(topPos, null);
    }
    
    // ä¸‹è¾¹ç•Œï¼šå¦‚æœä¸‹æ–¹æ²¡æœ‰è€•åœ°ä¸­å¿ƒï¼Œåˆ™æ”¾ç½®ä¸‹è¾¹ç•Œ
    Vector3Int bottomPos = centerPos + Vector3Int.down;
    if (!HasFarmlandCenter(bottomPos))
    {
        farmlandTilemap.SetTile(bottomPos, bottomBorderTile);
    }
    else
    {
        farmlandTilemap.SetTile(bottomPos, null);
    }
    
    // å·¦è¾¹ç•Œã€å³è¾¹ç•ŒåŒç†...
}
```

#### ç›¸é‚»è€•åœ°è¾¹ç•Œæ›´æ–°

```csharp
private void UpdateNeighborBorders(Vector3Int centerPos)
{
    // æ£€æŸ¥ä¸Šæ–¹æ˜¯å¦æœ‰è€•åœ°
    Vector3Int topCenter = centerPos + Vector3Int.up * 2; // æ³¨æ„æ˜¯ 2 æ ¼ï¼Œå› ä¸ºä¸­é—´éš”äº†è¾¹ç•Œ
    if (HasFarmlandCenter(topCenter))
    {
        // ç§»é™¤å½“å‰è€•åœ°çš„ä¸Šè¾¹ç•Œ
        farmlandTilemap.SetTile(centerPos + Vector3Int.up, null);
        // ç§»é™¤ä¸Šæ–¹è€•åœ°çš„ä¸‹è¾¹ç•Œ
        farmlandTilemap.SetTile(topCenter + Vector3Int.down, null);
    }
    
    // ä¸‹æ–¹ã€å·¦æ–¹ã€å³æ–¹åŒç†...
}
```

---

## ğŸ“ åæ ‡ç³»ç»Ÿè¯´æ˜

### å•ä¸ªè€•åœ°çš„ Tile å¸ƒå±€

å‡è®¾ç©å®¶ç‚¹å‡»ä½ç½®ä¸º `(0, 0)`ï¼š

```
ä½ç½® (0, 1)  â†’ ä¸Šè¾¹ç•Œ
ä½ç½® (-1, 0) â†’ å·¦è¾¹ç•Œ
ä½ç½® (0, 0)  â†’ ä¸­å¿ƒï¼ˆç©å®¶ç‚¹å‡»ä½ç½®ï¼‰
ä½ç½® (1, 0)  â†’ å³è¾¹ç•Œ
ä½ç½® (0, -1) â†’ ä¸‹è¾¹ç•Œ
```

### ä¸¤ä¸ªç›¸é‚»è€•åœ°ï¼ˆä¸Šä¸‹ç›¸é‚»ï¼‰

è€•åœ° A ä¸­å¿ƒåœ¨ `(0, 0)`ï¼Œè€•åœ° B ä¸­å¿ƒåœ¨ `(0, 2)`ï¼š

```
ä½ç½® (0, 3)  â†’ B çš„ä¸Šè¾¹ç•Œ
ä½ç½® (0, 2)  â†’ B çš„ä¸­å¿ƒ
ä½ç½® (0, 1)  â†’ ã€ç§»é™¤ã€‘åŸæœ¬æ˜¯ A çš„ä¸Šè¾¹ç•Œ å’Œ B çš„ä¸‹è¾¹ç•Œ
ä½ç½® (0, 0)  â†’ A çš„ä¸­å¿ƒ
ä½ç½® (0, -1) â†’ A çš„ä¸‹è¾¹ç•Œ
```

**å…³é”®**ï¼šå½“ä¸¤ä¸ªè€•åœ°ä¸­å¿ƒç›¸è· 2 æ ¼æ—¶ï¼Œä¸­é—´çš„è¾¹ç•Œéœ€è¦ç§»é™¤ã€‚

---

## ğŸ”§ æ•°æ®ç»“æ„

### FarmTileDataï¼ˆæ¯ä¸ªè€•åœ°çš„æ•°æ®ï¼‰

```csharp
public class FarmTileData
{
    public Vector3Int CenterPosition;  // ä¸­å¿ƒä½ç½®
    public bool HasTopBorder;          // æ˜¯å¦æ˜¾ç¤ºä¸Šè¾¹ç•Œ
    public bool HasBottomBorder;       // æ˜¯å¦æ˜¾ç¤ºä¸‹è¾¹ç•Œ
    public bool HasLeftBorder;         // æ˜¯å¦æ˜¾ç¤ºå·¦è¾¹ç•Œ
    public bool HasRightBorder;        // æ˜¯å¦æ˜¾ç¤ºå³è¾¹ç•Œ
    
    // å…¶ä»–æ•°æ®...
    public bool WateredToday;
    public CropInstance Crop;
}
```

### FarmingManager æ ¸å¿ƒå­—æ®µ

```csharp
public class FarmingManager : MonoBehaviour
{
    [Header("Tilemap")]
    [SerializeField] private Tilemap farmlandTilemap;
    
    [Header("Tiles")]
    [SerializeField] private TileBase centerTile;
    [SerializeField] private TileBase topBorderTile;
    [SerializeField] private TileBase bottomBorderTile;
    [SerializeField] private TileBase leftBorderTile;
    [SerializeField] private TileBase rightBorderTile;
    
    // å­˜å‚¨æ‰€æœ‰è€•åœ°æ•°æ®ï¼ŒKey = ä¸­å¿ƒä½ç½®
    private Dictionary<Vector3Int, FarmTileData> farmTiles = new();
}
```

---

## ğŸ“ ç”¨æˆ·æ“ä½œæ­¥éª¤

### æ­¥éª¤ 1ï¼šåˆ›å»º 5 ä¸ªæ™®é€š Tile

1. åœ¨ Project çª—å£ï¼Œå¯¼èˆªåˆ° `Assets/ZZZ_999_Package/000_Tile/`
2. å³é”® â†’ **Create** â†’ **2D** â†’ **Tiles** â†’ **Tile**ï¼ˆæ™®é€š Tileï¼Œä¸æ˜¯ Rule Tileï¼‰
3. åˆ›å»º 5 ä¸ª Tileï¼Œåˆ†åˆ«å‘½åä¸ºï¼š
   - `Farmland_Center`
   - `Farmland_Border_Top`
   - `Farmland_Border_Bottom`
   - `Farmland_Border_Left`
   - `Farmland_Border_Right`
4. ä¸ºæ¯ä¸ª Tile è®¾ç½®å¯¹åº”çš„ Sprite

### æ­¥éª¤ 2ï¼šåˆ›å»º Farmland Tilemap

1. åœ¨ Hierarchy ä¸­ï¼Œæ‰¾åˆ° `â”€â”€â”€ LAYER 1 â”€â”€â”€/Tilemaps/`
2. å³é”® â†’ **2D Object** â†’ **Tilemap** â†’ **Rectangular**
3. å‘½åä¸º `Farmland`
4. è®¾ç½® Sorting Layer å’Œ Order in Layer

### æ­¥éª¤ 3ï¼šé…ç½® FarmingManager

1. åœ¨ Hierarchy ä¸­æ‰¾åˆ°æˆ–åˆ›å»º `FarmingManager`
2. å°† 5 ä¸ª Tile æ‹–å…¥å¯¹åº”å­—æ®µ
3. å°† `Farmland` Tilemap æ‹–å…¥ `farmlandTilemap` å­—æ®µ

### æ­¥éª¤ 4ï¼šç­‰å¾…ä»£ç å®ç°

ä»£ç éƒ¨åˆ†éœ€è¦å¼€å‘è€…å®ç°ï¼ŒåŒ…æ‹¬ï¼š
- åˆ›å»ºè€•åœ°é€»è¾‘
- è¾¹ç•Œæ›´æ–°é€»è¾‘
- ç›¸é‚»è€•åœ°è¾¹ç•Œåˆå¹¶é€»è¾‘

---

## ğŸ® é¢„æœŸæ•ˆæœ

### åœºæ™¯ 1ï¼šåˆ›å»ºå•ä¸ªè€•åœ°

ç©å®¶ç‚¹å‡»ä½ç½® `(5, 5)`ï¼š

```
[    ] [ä¸Š] [    ]
[å·¦]  [ä¸­]  [å³]
[    ] [ä¸‹] [    ]
```

### åœºæ™¯ 2ï¼šåœ¨å³ä¾§åˆ›å»ºç¬¬äºŒä¸ªè€•åœ°

ç©å®¶ç‚¹å‡»ä½ç½® `(7, 5)`ï¼ˆä¸ç¬¬ä¸€ä¸ªè€•åœ°ç›¸è· 2 æ ¼ï¼‰ï¼š

```
[    ] [ä¸Š] [    ] [    ] [ä¸Š] [    ]
[å·¦]  [ä¸­]  [    ] [    ] [ä¸­]  [å³]
[    ] [ä¸‹] [    ] [    ] [ä¸‹] [    ]
```

**æ³¨æ„**ï¼šç¬¬ä¸€ä¸ªè€•åœ°çš„å³è¾¹ç•Œå’Œç¬¬äºŒä¸ªè€•åœ°çš„å·¦è¾¹ç•Œéƒ½è¢«ç§»é™¤äº†ã€‚

### åœºæ™¯ 3ï¼šåœ¨ä¸Šæ–¹åˆ›å»ºç¬¬ä¸‰ä¸ªè€•åœ°

ç©å®¶ç‚¹å‡»ä½ç½® `(5, 7)`ï¼š

```
[    ] [ä¸Š] [    ]
[å·¦]  [ä¸­]  [å³]
[    ] [    ] [    ]  â† åŸæœ¬çš„ä¸‹è¾¹ç•Œè¢«ç§»é™¤
[    ] [    ] [    ]  â† åŸæœ¬çš„ä¸Šè¾¹ç•Œè¢«ç§»é™¤
[å·¦]  [ä¸­]  [å³]
[    ] [ä¸‹] [    ]
```

---

## â“ å¾…ç¡®è®¤é—®é¢˜

1. **æ°´æ¸ Tile å¦‚ä½•å¤„ç†ï¼Ÿ**
   - æ°´æ¸æ˜¯è¦†ç›–åœ¨ä¸­å¿ƒ Tile ä¸Šï¼Œè¿˜æ˜¯å•ç‹¬çš„ Tilemapï¼Ÿ
   - å»ºè®®ï¼šä½¿ç”¨å•ç‹¬çš„ `WaterPuddle` Tilemapï¼Œåªåœ¨ä¸­å¿ƒä½ç½®æ”¾ç½®æ°´æ¸

2. **è¾¹ç•Œæ˜¯å¦éœ€è¦ç¢°æ’ä½“ï¼Ÿ**
   - å¦‚æœè¾¹ç•Œåªæ˜¯è§†è§‰æ•ˆæœï¼Œä¸éœ€è¦ç¢°æ’ä½“
   - å¦‚æœè¾¹ç•Œéœ€è¦é˜»æŒ¡ç©å®¶ï¼Œéœ€è¦é…ç½® Tilemap Collider2D

3. **è€•åœ°æ˜¯å¦å¯ä»¥è¢«ç ´åï¼Ÿ**
   - å¦‚æœå¯ä»¥ï¼Œéœ€è¦å®ç° `DestroyFarmland()` æ–¹æ³•
   - ç§»é™¤ä¸­å¿ƒå’Œå››å‘¨è¾¹ç•Œï¼Œå¹¶æ›´æ–°ç›¸é‚»è€•åœ°çš„è¾¹ç•Œ

---

## ğŸ“š ä¸‹ä¸€æ­¥

1. **ç¡®è®¤è®¾è®¡æ–¹æ¡ˆ**ï¼šè¯·ç¡®è®¤ä»¥ä¸Šç†è§£æ˜¯å¦æ­£ç¡®
2. **åˆ›å»º Tile èµ„æº**ï¼šæŒ‰ç…§æ­¥éª¤ 1 åˆ›å»º 5 ä¸ªæ™®é€š Tile
3. **ç­‰å¾…ä»£ç å®ç°**ï¼šå¼€å‘è€…å®ç° FarmingManager çš„æ ¸å¿ƒé€»è¾‘

---

**æ–‡æ¡£ç»´æŠ¤è€…**: Kiro  
**æœ€åæ›´æ–°**: 2026-01-25
