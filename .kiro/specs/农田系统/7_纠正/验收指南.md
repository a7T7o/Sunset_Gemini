# 农田系统彻底解耦 - 验收指南

**创建日期**: 2026-01-27  
**状态**: ✅ 代码实现完成，待用户验收

---

## 核心验收标准

**删掉场景里的 FarmingManagerNew 物体时，整个农田系统（锄地、浇水、干涸、生长、收获）依然能完美运行。**

---

## 验收步骤

### 步骤 1：移除 FarmingManagerNew

1. 打开 Unity 编辑器
2. 在 Hierarchy 中找到 `FarmingManagerNew` 物体
3. **删除或禁用**该物体
4. 保存场景

### 步骤 2：验证锄地功能

- [ ] 装备锄头
- [ ] 右键点击地面
- [ ] 确认耕地 Tile 正确生成
- [ ] 确认边界 Tile 正确生成

### 步骤 3：验证浇水功能

- [ ] 装备水壶
- [ ] 右键点击已耕作的土地
- [ ] 确认水渍 Tile 正确显示
- [ ] 确认 FarmTileData.moistureState 变为 WetWithPuddle

### 步骤 4：验证水渍干涸（需要时间流逝）

- [ ] 浇水后等待 2 小时（游戏内时间）
- [ ] 确认水渍状态从 WetWithPuddle 变为 WetDark
- [ ] 等待到第二天
- [ ] 确认水渍状态重置为 Dry

### 步骤 5：验证种植功能

- [ ] 背包中有种子
- [ ] 装备种子
- [ ] 右键点击已耕作的土地
- [ ] 确认作物 GameObject 正确生成
- [ ] 确认背包中种子数量减少

### 步骤 6：验证作物生长（需要时间流逝）

- [ ] 种植作物后浇水
- [ ] 等待到第二天
- [ ] 确认作物生长阶段增加
- [ ] 确认作物 Sprite 正确切换

### 步骤 7：验证收获功能

- [ ] 等待作物成熟
- [ ] 右键点击成熟的作物
- [ ] 确认收获物品正确掉落
- [ ] 确认作物 GameObject 正确销毁（或重置为可重复收获状态）

---

## 架构验证

### 确认 FarmTileManager 自治

打开 `FarmTileManager.cs`，确认：
- [x] OnEnable() 订阅 TimeManager.OnDayChanged 和 OnHourChanged
- [x] OnDisable() 取消订阅
- [x] OnDayChanged() 调用 ResetDailyWaterState()
- [x] OnHourChanged() 处理水渍状态变化

### 确认 CropController 自治

打开 `CropController.cs`，确认：
- [x] OnEnable() 订阅 TimeManager.OnDayChanged
- [x] OnDisable() 取消订阅
- [x] OnDayChanged() 自己检查土地湿润状态，自己决定是否生长

### 确认 GameInputManager 无 FarmingManagerNew 引用

打开 `GameInputManager.cs`，搜索 `FarmingManagerNew`：
- [x] 应该没有任何引用
- [x] TryPlantSeed() 直接调用 CropManager.CreateCrop()
- [x] TryHarvestCropAtMouse() 直接访问 FarmTileManager 和 CropManager

---

## 已知限制

1. **需要用户配置 Tile 资源**
   - FarmTileManager 需要配置 centerTile、waterPuddleTiles
   - FarmlandBorderManager 需要配置边界 Tiles

2. **需要用户配置 CropManager**
   - CropManager 需要配置 cropPrefab

3. **作物 Prefab 需要正确配置**
   - 需要有 CropController 组件
   - 需要有 SpriteRenderer 组件

---

## 问题排查

### 锄地无反应
- 检查 FarmTileManager.Instance 是否存在
- 检查 LayerTilemaps 是否正确配置
- 检查 centerTile 是否已赋值

### 浇水无反应
- 检查 FarmTileData 是否存在于该位置
- 检查 waterPuddleTiles 是否已赋值

### 作物不生长
- 检查 CropController.OnEnable() 是否正确订阅事件
- 检查 TimeManager.OnDayChanged 是否正常触发
- 检查 FarmTileManager.GetTileData() 是否返回正确数据

### 收获无反应
- 检查作物是否已成熟（currentGrowthStage >= maxGrowthStage）
- 检查 CropManager.Instance 是否存在

---

## 完成确认

当以上所有步骤都通过后，农田系统彻底解耦验收完成。

**签字确认**: ________________  
**日期**: ________________
