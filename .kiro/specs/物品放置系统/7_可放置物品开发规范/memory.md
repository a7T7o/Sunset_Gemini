# 可放置物品开发规范 - 开发记忆

## 模块概述

定义所有可放置物品（树苗、箱子、工作台、装饰物等）的统一开发规范，确保放置系统能够以一致的方式处理所有物品类型。

**核心目标**：
- 统一底部对齐机制
- 统一预制体结构规范
- 统一 Collider 配置规范
- 简化放置系统的位置计算逻辑

## 当前状态

- **完成度**: 30%（规范制定阶段）
- **最后更新**: 2026-01-21
- **状态**: 🔄 进行中

---

## 规范文档索引

| 文档 | 说明 | 状态 |
|------|------|------|
| [可放置物品开发规范.md](./可放置物品开发规范.md) | 核心规范文档 | ✅ 已创建 |
| [现有物品合规检查.md](./现有物品合规检查.md) | 现有物品的合规性检查 | 📋 待创建 |

---

## 关键决策

| 决策 | 原因 | 日期 |
|------|------|------|
| 统一底部对齐机制 | 简化放置系统位置计算，避免特殊处理 | 2026-01-21 |
| 底部对齐在 Start/Initialize 执行 | 确保放置后立即生效 | 2026-01-21 |
| 使用子物体 localPosition 对齐 | 与 TreeControllerV2 保持一致 | 2026-01-21 |

---

## 跨工作区索引

| 相关系统 | 工作区 | 关联内容 |
|---------|--------|---------|
| 放置系统 | `.kiro/specs/物品放置系统/` | 放置逻辑、预览、验证 |
| 箱子系统 | `.kiro/specs/箱子系统/` | ChestController 需要修改 |
| SO设计系统 | `.kiro/specs/SO设计系统/` | 可放置物品 SO 设计 |

---

## 会话记录

### 会话 1 - 2026-01-21（规范制定）

**背景**:
在修复预览与放置位置对齐问题时，发现 TreeControllerV2 和 ChestController 的底部对齐机制不一致，导致放置系统需要特殊处理不同类型的物品。

**用户需求**:
> 增加一个规则，在所有的可放置物品设计和创建的时候都去遵守，初始化的时候就要进行同步对齐，通过规范开发来对代码的逻辑简化

**完成任务**:
1. 创建子工作区 `7_可放置物品开发规范`
2. 制定可放置物品开发规范
3. 创建 steering 规则文件

**核心规范**:
- 所有可放置物品必须在 `Start()` 或 `Initialize()` 时执行底部对齐
- 底部对齐统一使用 `localPosition.y = -sprite.bounds.min.y`
- 预制体结构：根物体 + 子物体（SpriteRenderer + Collider）

**待办事项**:
- [ ] 检查其他现有可放置物品的合规性
- [ ] 为后续新增物品（种子、工作台）提供模板

**已完成**:
- [x] 创建 steering 规则文件 `.kiro/steering/placeable-items.md`
- [x] 更新 steering README 索引
- [x] 更新 `物品放置系统/memory.md` 添加子工作区 7 索引
- [x] 更新 `6_预览与放置位置对齐修复/问题分析报告-V2.md` 推荐方案
- [x] 修改 ChestController 使其符合规范（AlignSpriteBottom 方法）

---

**文档维护者**: Kiro  
**创建日期**: 2026-01-21
