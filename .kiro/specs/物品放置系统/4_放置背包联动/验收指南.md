# 验收指南 - 放置系统与背包联动

## 功能验收清单

### 基础放置测试

- [ ] **放置成功扣除物品** - 放置树苗成功后，背包中树苗数量 -1
- [ ] **放置失败不扣除** - 放置到红色格子时，背包物品数量不变
- [ ] **物品用完退出** - 最后一个物品放置后，自动退出放置模式
- [ ] **连续放置** - 放置成功后如果还有物品，继续 Preview 状态

### 中断测试

- [ ] **手持物品切换中断** - 放置过程中按 1-8 切换槽位，放置取消
- [ ] **背包打开中断** - 放置过程中按 Tab 打开背包，放置取消
- [ ] **右键/ESC 取消** - 放置过程中按右键或 ESC，放置取消
- [ ] **再次左键重新开始** - 导航中再次左键点击有效位置，重新锁定新位置

### 边界情况测试

- [ ] **物品被移动** - 放置过程中物品被移动到其他槽位，放置取消
- [ ] **物品被消耗** - 放置过程中物品被其他方式消耗，放置取消

## 测试步骤

### 测试 1: 基础放置流程

1. 确保背包中有 3 个树苗
2. 选中树苗槽位，进入放置模式
3. 移动鼠标到有效位置（绿色格子）
4. 左键点击锁定位置
5. 等待玩家走到目标位置
6. 确认放置成功，背包树苗数量变为 2
7. 继续放置第 2 个和第 3 个
8. 第 3 个放置后，确认自动退出放置模式

### 测试 2: 手持物品切换中断

1. 选中树苗槽位，进入放置模式
2. 左键点击锁定位置
3. 在玩家走向目标的过程中，按数字键切换到其他槽位
4. 确认放置取消，背包物品数量不变

### 测试 3: 背包打开中断

1. 选中树苗槽位，进入放置模式
2. 左键点击锁定位置
3. 在玩家走向目标的过程中，按 Tab 打开背包
4. 确认放置取消，背包物品数量不变

### 测试 4: 再次左键重新开始

1. 选中树苗槽位，进入放置模式
2. 左键点击锁定位置 A
3. 在玩家走向目标的过程中，左键点击另一个有效位置 B
4. 确认玩家改为走向位置 B
5. 到达后放置成功

## 预期结果

| 操作 | 预期结果 |
|------|---------|
| 放置成功 | 背包物品 -1，播放成功音效 |
| 放置失败 | 背包物品不变，播放失败音效 |
| 手持切换 | 取消放置，退出放置模式 |
| 背包打开 | 取消放置，隐藏预览 |
| 右键/ESC | 取消放置，返回 Preview 状态 |
| 再次左键 | 重新锁定新位置 |

## 已知限制

1. **受击中断** - 当前版本未实现受击检测，需要后续添加
2. **NPC 交互中断** - 当前版本未实现 NPC 交互检测，需要后续添加
3. **撤销功能** - 撤销会返还物品到背包，但不会检查背包是否已满

## 调试方法

如果遇到问题，可以在 PlacementManagerV3 的 Inspector 中勾选 `Show Debug Info`，查看控制台日志：

- `[PlacementManagerV3] 状态变化: X → Y` - 状态机转换
- `[PlacementManagerV3] 快照验证失败` - 物品数据不匹配
- `[PlacementManagerV3] DeductItemFromInventory` - 背包扣除结果
- `[PlacementManagerV3] HasMoreItems` - 剩余物品检查

