---
inclusion: always
priority: P0
isCanonical: true
canonicalDomain: [specs目录结构, memory.md规范, 工作区命名规则]
lastUpdated: 2025-01-09
---

# 工作区记忆规范

## 核心原则

每个开发专题都必须有独立的 specs 区域，用于记录开发过程中的所有重要信息。

## Specs 目录结构（新规则 v2.0）

```
.kiro/specs/
├── memory.md                    # ★ 全局记忆文档（工作区级别）
├── last/                        # 历史工作区归档
│   ├── 砍树系统/
│   ├── 物品掉落拾取/
│   └── ...
├── 0_摄像头死区同步/            # 当前工作区（按编号排序）
│   ├── memory.md
│   ├── requirements.md
│   ├── design.md
│   └── tasks.md
├── 1_下一个功能/
│   └── ...
└── 2_再下一个功能/
    └── ...
```

### 命名规则

1. **工作区文件夹命名**：
   - 使用中文命名
   - 格式：`{编号}_{功能名称}`
   - 编号从 0 开始递增
   - 示例：`0_摄像头死区同步`、`1_摄像头抖动动画`

2. **历史归档**：
   - 旧工作区统一移入 `last/` 文件夹
   - `last/` 内保持原有文件夹名称
   - 不需要编号

3. **memory.md 位置**：
   - 每个工作区内有独立的 `memory.md`
   - 与编号文件夹和 `last/` 同级

## Memory 文档规范

### 文档优先级
- **memory.md** 是最核心的文档，每次对话任务完成后必须先更新
- 没有 memory.md 的更新，不能结束当前对话
- 其他文档（design, requirements, tasks）是可选的

### Memory 文档必须包含

1. **模块概述** - 简述该模块的功能和目标
2. **当前状态** - 模块完成度、最后更新时间
3. **会话记录** - 每次对话的详细记录
   - 会话时间
   - 用户需求原文
   - 完成的任务
   - 修改的文件
   - 解决方案思路
   - 遗留问题
4. **关键决策** - 重要的设计决策和原因
5. **相关文件** - 涉及的代码文件清单

### Memory 文档格式

```markdown
# {模块名称} - 开发记忆

## 模块概述
[简述模块功能]

## 当前状态
- **完成度**: XX%
- **最后更新**: YYYY-MM-DD
- **状态**: 进行中/已完成/待验证

## 会话记录

### 会话 N - YYYY-MM-DD

**用户需求**:
> [引用用户原话]

**完成任务**:
1. [任务1]
2. [任务2]

**修改文件**:
- `path/to/file1.cs` - [修改说明]
- `path/to/file2.cs` - [修改说明]

**解决方案**:
[详细描述解决思路]

**遗留问题**:
- [ ] [问题1]
- [ ] [问题2]

---

## 关键决策

| 决策 | 原因 | 日期 |
|------|------|------|
| [决策内容] | [原因] | YYYY-MM-DD |

## 相关文件

| 文件 | 说明 |
|------|------|
| `path/to/file.cs` | [说明] |
```

## 工作流程

### 开始新专题
1. 用户说"新建工作区，开始XXX工作"
2. 确定当前最大编号，新编号 = 最大编号 + 1
3. 创建 `.kiro/specs/{编号}_{功能名称}/` 目录
4. 创建 `memory.md` 文件
5. 记录第一次会话内容

### 每次对话结束前
1. 更新 `memory.md` 添加本次会话记录
2. 记录所有修改的文件
3. 记录解决方案和遗留问题
4. 确认 memory 更新完成后才能结束对话

### 继续已有专题
1. 先读取 `memory.md` 了解历史
2. 继续开发
3. 更新 `memory.md`

### 归档旧工作区
1. 将旧工作区文件夹移入 `last/`
2. 保持原有文件夹名称
3. 更新 README.md 中的状态

## 已有模块处理

对于已完成的模块（在 Docx/分类 中有总结文档的）：
- 创建对应的 specs 目录
- 从总结文档提取信息创建 memory.md
- 记录完成状态和关键决策
- 不需要详细的会话记录

## 新模块处理

对于新开始的模块：
- 详细记录每次会话的需求和完成情况
- 记录设计思路和解决方案
- 记录所有修改的文件
- 确保任何时候都能继续开发


---

## 🔴🔴🔴 最高优先级规则（2025-12-25 新增）🔴🔴🔴

### 绝对禁止事项

1. **禁止覆盖任何文档** - 所有 requirements.md、design.md、tasks.md 只允许新增，不允许覆盖
2. **禁止删除任何文档** - 任何情况下都不允许删除已有文档
3. **禁止修改 memory.md 历史记录** - memory.md 只允许追加新会话记录，不允许修改或删除已有记录

### 工作区内部结构（v2.1 修正）

每个工作区内部结构如下：

```
.kiro/specs/砍树系统/           # 一个工作区
├── memory.md                   # ★ 核心记忆文档，与 old 同级
├── old/                        # 旧内容归档
│   ├── requirements.md
│   ├── design.md
│   └── tasks.md
├── 0_第一个任务/               # 编号任务文件夹
│   ├── requirements.md
│   ├── design.md
│   └── tasks.md
└── 1_第二个任务/               # 后续任务
    ├── requirements.md
    ├── design.md
    └── tasks.md
```

### 新任务处理流程

1. 在工作区内创建新的编号文件夹（如 `0_摄像头死区同步/`）
2. 在新文件夹内创建 requirements.md、design.md、tasks.md
3. 更新工作区的 memory.md（追加新会话记录）
4. **绝对不触碰 old/ 内的任何文件**

### 文档堆积原则

- 每次新任务都创建新的编号文件夹
- 旧文档永久保留在 old/ 或原编号文件夹中
- memory.md 是日志式记录，只追加不修改
- 这是用户的项目日志，必须完整保留历史
